<html><head><title>magic/xml vs XML Query</title><style><style type='text/css'>
.CodeRay {
  background-color: #f8f8f8;
  border: 1px solid silver;
  font-family: 'Courier New', 'Terminal', monospace;
  color: #100;
}
.CodeRay pre { margin: 0px }

div.CodeRay { }

span.CodeRay { white-space: pre; border: 0px; padding: 2px }

table.CodeRay { border-collapse: collapse; width: 100%; padding: 2px }
table.CodeRay td { padding: 2px 4px; vertical-align: top }

.CodeRay .line_numbers, .CodeRay .no {
  background-color: #def;
  color: gray;
  text-align: right;
}
.CodeRay .line_numbers tt { font-weight: bold }
.CodeRay .no { padding: 0px 4px }
.CodeRay .code { width: 100% }

ol.CodeRay { font-size: 10pt }
ol.CodeRay li { white-space: pre }

.CodeRay .code pre { overflow: auto }

.CodeRay .af { color:#00C }
.CodeRay .an { color:#007 }
.CodeRay .av { color:#700 }
.CodeRay .aw { color:#C00 }
.CodeRay .bi { color:#509; font-weight:bold }
.CodeRay .c  { color:#888 }

.CodeRay .ch { color:#04D }
.CodeRay .ch .k { color:#04D }
.CodeRay .ch .dl { color:#039 }

.CodeRay .cl { color:#B06; font-weight:bold }
.CodeRay .co { color:#036; font-weight:bold }
.CodeRay .cr { color:#0A0 }
.CodeRay .cv { color:#369 }
.CodeRay .df { color:#099; font-weight:bold }
.CodeRay .di { color:#088; font-weight:bold }
.CodeRay .dl { color:black }
.CodeRay .do { color:#970 }
.CodeRay .ds { color:#D42; font-weight:bold }
.CodeRay .e  { color:#666; font-weight:bold }
.CodeRay .en { color:#800; font-weight:bold }
.CodeRay .er { color:#F00; background-color:#FAA }
.CodeRay .ex { color:#F00; font-weight:bold }
.CodeRay .fl { color:#60E; font-weight:bold }
.CodeRay .fu { color:#06B; font-weight:bold }
.CodeRay .gv { color:#d70; font-weight:bold }
.CodeRay .hx { color:#058; font-weight:bold }
.CodeRay .i  { color:#00D; font-weight:bold }
.CodeRay .ic { color:#B44; font-weight:bold }

.CodeRay .il { background: #eee }
.CodeRay .il .il { background: #ddd }
.CodeRay .il .il .il { background: #ccc }
.CodeRay .il .idl { font-weight: bold; color: #888 }

.CodeRay .in { color:#B2B; font-weight:bold }
.CodeRay .iv { color:#33B }
.CodeRay .la { color:#970; font-weight:bold }
.CodeRay .lv { color:#963 }
.CodeRay .oc { color:#40E; font-weight:bold }
.CodeRay .on { color:#000; font-weight:bold }
.CodeRay .op { }
.CodeRay .pc { color:#038; font-weight:bold }
.CodeRay .pd { color:#369; font-weight:bold }
.CodeRay .pp { color:#579 }
.CodeRay .pt { color:#339; font-weight:bold }
.CodeRay .r  { color:#080; font-weight:bold }

.CodeRay .rx { background-color:#fff0ff }
.CodeRay .rx .k { color:#808 }
.CodeRay .rx .dl { color:#404 }
.CodeRay .rx .mod { color:#C2C }
.CodeRay .rx .fu  { color:#404; font-weight: bold }

.CodeRay .s  { background-color:#fff0f0 }
.CodeRay .s  .s { background-color:#ffe0e0 }
.CodeRay .s  .s  .s { background-color:#ffd0d0 }
.CodeRay .s  .k { color:#D20 }
.CodeRay .s  .dl { color:#710 }

.CodeRay .sh { background-color:#f0fff0 }
.CodeRay .sh .k { color:#2B2 }
.CodeRay .sh .dl { color:#161 }

.CodeRay .sy { color:#A60 }
.CodeRay .sy .k { color:#A60 }
.CodeRay .sy .dl { color:#630 }

.CodeRay .ta { color:#070 }
.CodeRay .tf { color:#070; font-weight:bold }
.CodeRay .ts { color:#D70; font-weight:bold }
.CodeRay .ty { color:#339; font-weight:bold }
.CodeRay .v  { color:#036 }
.CodeRay .xt { color:#444 }

  </style></style></head><body><h3><a name='toc'>Table of contents</a></h3><p>If you want to run the examples yourself, they are included in the magic/xml package. Whitespace has been changed for easier reading. The original use cases are available <a href='http://www.w3.org/TR/xquery-use-cases/'>on W3C website</a>.</p><ul><li><a href='#parts-partlist.xml'>Input for PARTS - partlist.xml</a></li><li><a href='#parts-q1'>PARTS - Q1</a></li><li><a href='#rdb-bids.xml'>Input for RDB - bids.xml</a></li><li><a href='#rdb-items.xml'>Input for RDB - items.xml</a></li><li><a href='#rdb-users.xml'>Input for RDB - users.xml</a></li><li><a href='#rdb-q1'>RDB - Q1</a></li><li><a href='#rdb-q2'>RDB - Q2</a></li><li><a href='#rdb-q3'>RDB - Q3</a></li><li><a href='#rdb-q4'>RDB - Q4</a></li><li><a href='#rdb-q5'>RDB - Q5</a></li><li><a href='#rdb-q6'>RDB - Q6</a></li><li><a href='#rdb-q7'>RDB - Q7</a></li><li><a href='#rdb-q8'>RDB - Q8</a></li><li><a href='#rdb-q9'>RDB - Q9</a></li><li><a href='#rdb-q10'>RDB - Q10</a></li><li><a href='#rdb-q11'>RDB - Q11</a></li><li><a href='#rdb-q12'>RDB - Q12</a></li><li><a href='#rdb-q13'>RDB - Q13</a></li><li><a href='#rdb-q14'>RDB - Q14</a></li><li><a href='#rdb-q15'>RDB - Q15</a></li><li><a href='#rdb-q16'>RDB - Q16</a></li><li><a href='#rdb-q17'>RDB - Q17</a></li><li><a href='#rdb-q18'>RDB - Q18</a></li><li><a href='#seq-report1.xml'>Input for SEQ - report1.xml</a></li><li><a href='#seq-q1'>SEQ - Q1</a></li><li><a href='#seq-q2'>SEQ - Q2</a></li><li><a href='#seq-q3'>SEQ - Q3</a></li><li><a href='#seq-q4'>SEQ - Q4</a></li><li><a href='#seq-q5'>SEQ - Q5</a></li><li><a href='#sgml-sgml.xml'>Input for SGML - sgml.xml</a></li><li><a href='#sgml-q1'>SGML - Q1</a></li><li><a href='#sgml-q2'>SGML - Q2</a></li><li><a href='#sgml-q3'>SGML - Q3</a></li><li><a href='#sgml-q4'>SGML - Q4</a></li><li><a href='#sgml-q5'>SGML - Q5</a></li><li><a href='#sgml-q6'>SGML - Q6</a></li><li><a href='#sgml-q7'>SGML - Q7</a></li><li><a href='#sgml-q8a'>SGML - Q8a</a></li><li><a href='#sgml-q8b'>SGML - Q8b</a></li><li><a href='#sgml-q9'>SGML - Q9</a></li><li><a href='#sgml-q10'>SGML - Q10</a></li><li><a href='#string-company-data.xml'>Input for STRING - company-data.xml</a></li><li><a href='#string-string.xml'>Input for STRING - string.xml</a></li><li><a href='#string-q1'>STRING - Q1</a></li><li><a href='#string-q2'>STRING - Q2</a></li><li><a href='#string-q4'>STRING - Q4</a></li><li><a href='#string-q5'>STRING - Q5</a></li><li><a href='#tree-book.xml'>Input for TREE - book.xml</a></li><li><a href='#tree-q1'>TREE - Q1</a></li><li><a href='#tree-q2'>TREE - Q2</a></li><li><a href='#tree-q3'>TREE - Q3</a></li><li><a href='#tree-q4'>TREE - Q4</a></li><li><a href='#tree-q5'>TREE - Q5</a></li><li><a href='#tree-q6'>TREE - Q6</a></li><li><a href='#xmp-bib.xml'>Input for XMP - bib.xml</a></li><li><a href='#xmp-books.xml'>Input for XMP - books.xml</a></li><li><a href='#xmp-prices.xml'>Input for XMP - prices.xml</a></li><li><a href='#xmp-reviews.xml'>Input for XMP - reviews.xml</a></li><li><a href='#xmp-q1'>XMP - Q1</a></li><li><a href='#xmp-q2'>XMP - Q2</a></li><li><a href='#xmp-q3'>XMP - Q3</a></li><li><a href='#xmp-q4'>XMP - Q4</a></li><li><a href='#xmp-q5'>XMP - Q5</a></li><li><a href='#xmp-q6'>XMP - Q6</a></li><li><a href='#xmp-q7'>XMP - Q7</a></li><li><a href='#xmp-q8'>XMP - Q8</a></li><li><a href='#xmp-q9'>XMP - Q9</a></li><li><a href='#xmp-q10'>XMP - Q10</a></li><li><a href='#xmp-q11'>XMP - Q11</a></li><li><a href='#xmp-q12'>XMP - Q12</a></li></ul><div><h3><a name='parts-partlist.xml'>Input for PARTS - partlist.xml</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='pp'>&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class='no'> 2</span> <span class='ta'>&lt;partlist&gt;</span>
<span class='no'> 3</span>   <span class='ta'>&lt;part</span> <span class='an'>partid</span>=<span class='s'><span class='dl'>"</span><span class='k'>0</span><span class='dl'>"</span></span> <span class='an'>name</span>=<span class='s'><span class='dl'>"</span><span class='k'>car</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>
<span class='no'> 4</span>   <span class='ta'>&lt;part</span> <span class='an'>partid</span>=<span class='s'><span class='dl'>"</span><span class='k'>1</span><span class='dl'>"</span></span> <span class='an'>partof</span>=<span class='s'><span class='dl'>"</span><span class='k'>0</span><span class='dl'>"</span></span> <span class='an'>name</span>=<span class='s'><span class='dl'>"</span><span class='k'>engine</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>
<span class='no'> 5</span>   <span class='ta'>&lt;part</span> <span class='an'>partid</span>=<span class='s'><span class='dl'>"</span><span class='k'>2</span><span class='dl'>"</span></span> <span class='an'>partof</span>=<span class='s'><span class='dl'>"</span><span class='k'>0</span><span class='dl'>"</span></span> <span class='an'>name</span>=<span class='s'><span class='dl'>"</span><span class='k'>door</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>
<span class='no'> 6</span>   <span class='ta'>&lt;part</span> <span class='an'>partid</span>=<span class='s'><span class='dl'>"</span><span class='k'>3</span><span class='dl'>"</span></span> <span class='an'>partof</span>=<span class='s'><span class='dl'>"</span><span class='k'>1</span><span class='dl'>"</span></span> <span class='an'>name</span>=<span class='s'><span class='dl'>"</span><span class='k'>piston</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>
<span class='no'> 7</span>   <span class='ta'>&lt;part</span> <span class='an'>partid</span>=<span class='s'><span class='dl'>"</span><span class='k'>4</span><span class='dl'>"</span></span> <span class='an'>partof</span>=<span class='s'><span class='dl'>"</span><span class='k'>2</span><span class='dl'>"</span></span> <span class='an'>name</span>=<span class='s'><span class='dl'>"</span><span class='k'>window</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>
<span class='no'> 8</span>   <span class='ta'>&lt;part</span> <span class='an'>partid</span>=<span class='s'><span class='dl'>"</span><span class='k'>5</span><span class='dl'>"</span></span> <span class='an'>partof</span>=<span class='s'><span class='dl'>"</span><span class='k'>2</span><span class='dl'>"</span></span> <span class='an'>name</span>=<span class='s'><span class='dl'>"</span><span class='k'>lock</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>
<span class='no'> 9</span>   <span class='ta'>&lt;part</span> <span class='an'>partid</span>=<span class='s'><span class='dl'>"</span><span class='k'>10</span><span class='dl'>"</span></span> <span class='an'>name</span>=<span class='s'><span class='dl'>"</span><span class='k'>skateboard</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>
<span class='no'><strong>10</strong></span>   <span class='ta'>&lt;part</span> <span class='an'>partid</span>=<span class='s'><span class='dl'>"</span><span class='k'>11</span><span class='dl'>"</span></span> <span class='an'>partof</span>=<span class='s'><span class='dl'>"</span><span class='k'>10</span><span class='dl'>"</span></span> <span class='an'>name</span>=<span class='s'><span class='dl'>"</span><span class='k'>board</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>
<span class='no'>11</span>   <span class='ta'>&lt;part</span> <span class='an'>partid</span>=<span class='s'><span class='dl'>"</span><span class='k'>12</span><span class='dl'>"</span></span> <span class='an'>partof</span>=<span class='s'><span class='dl'>"</span><span class='k'>10</span><span class='dl'>"</span></span> <span class='an'>name</span>=<span class='s'><span class='dl'>"</span><span class='k'>wheel</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>
<span class='no'>12</span>   <span class='ta'>&lt;part</span> <span class='an'>partid</span>=<span class='s'><span class='dl'>"</span><span class='k'>20</span><span class='dl'>"</span></span> <span class='an'>name</span>=<span class='s'><span class='dl'>"</span><span class='k'>canoe</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>
<span class='no'>13</span> <span class='ta'>&lt;/partlist&gt;</span>
</pre></div>
</div></div><div><h3><a name='parts-q1'>PARTS - Q1</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>Convert the sample document from "partlist"
     format to "parttree" format (see DTD section
     for definitions). In the result document,
     part containment is represented by containment
     of one &lt;part&gt; element inside another. Each part
     that is not part of any other part should appear
     as a separate top-level element in the output document.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='r'>def</span> <span class='fu'>parts_of</span>(parts, partid)
<span class='no'> 2</span>     res = []
<span class='no'> 3</span>     parts.each{|p|
<span class='no'> 4</span>         <span class='r'>if</span> p[<span class='sy'>:partof</span>] == partid
<span class='no'> 5</span>             a = p.attrs.dup
<span class='no'> 6</span>             a.delete <span class='sy'>:partof</span>
<span class='no'> 7</span>             res &lt;&lt; xml(<span class='sy'>:part</span>, a, parts_of(parts, p[<span class='sy'>:partid</span>]))
<span class='no'> 8</span>         <span class='r'>end</span>
<span class='no'> 9</span>     }
<span class='no'><strong>10</strong></span>     res
<span class='no'>11</span> <span class='r'>end</span>
<span class='no'>12</span> 
<span class='no'>13</span> <span class='co'>XML</span>.parttree! {
<span class='no'>14</span>     parts = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>partlist.xml</span><span class='dl'>'</span></span>).children(<span class='sy'>:part</span>)
<span class='no'>15</span>     add! parts_of(parts, <span class='pc'>nil</span>)
<span class='no'>16</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>declare function local:one_level($p as element()) as element()
{
    &lt;part partid="{ $p/@partid }"
          name="{ $p/@name }" &gt;
        {
            for $s in doc("partlist.xml")//part
            where $s/@partof = $p/@partid
            return local:one_level($s)
        }
    &lt;/part&gt;
};

&lt;parttree&gt;
  {
    for $p in doc("partlist.xml")//part[empty(@partof)]
    return local:one_level($p)
  }
&lt;/parttree&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;parttree&gt;</span>
<span class='no'> 2</span>     <span class='ta'>&lt;part</span> <span class='an'>partid</span>=<span class='s'><span class='dl'>"</span><span class='k'>0</span><span class='dl'>"</span></span> <span class='an'>name</span>=<span class='s'><span class='dl'>"</span><span class='k'>car</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'> 3</span>         <span class='ta'>&lt;part</span> <span class='an'>partid</span>=<span class='s'><span class='dl'>"</span><span class='k'>1</span><span class='dl'>"</span></span> <span class='an'>name</span>=<span class='s'><span class='dl'>"</span><span class='k'>engine</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'> 4</span>             <span class='ta'>&lt;part</span> <span class='an'>partid</span>=<span class='s'><span class='dl'>"</span><span class='k'>3</span><span class='dl'>"</span></span> <span class='an'>name</span>=<span class='s'><span class='dl'>"</span><span class='k'>piston</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>
<span class='no'> 5</span>         <span class='ta'>&lt;/part&gt;</span>
<span class='no'> 6</span>         <span class='ta'>&lt;part</span> <span class='an'>partid</span>=<span class='s'><span class='dl'>"</span><span class='k'>2</span><span class='dl'>"</span></span> <span class='an'>name</span>=<span class='s'><span class='dl'>"</span><span class='k'>door</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'> 7</span>             <span class='ta'>&lt;part</span> <span class='an'>partid</span>=<span class='s'><span class='dl'>"</span><span class='k'>4</span><span class='dl'>"</span></span> <span class='an'>name</span>=<span class='s'><span class='dl'>"</span><span class='k'>window</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>
<span class='no'> 8</span>             <span class='ta'>&lt;part</span> <span class='an'>partid</span>=<span class='s'><span class='dl'>"</span><span class='k'>5</span><span class='dl'>"</span></span> <span class='an'>name</span>=<span class='s'><span class='dl'>"</span><span class='k'>lock</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>
<span class='no'> 9</span>         <span class='ta'>&lt;/part&gt;</span>
<span class='no'><strong>10</strong></span>     <span class='ta'>&lt;/part&gt;</span>
<span class='no'>11</span>     <span class='ta'>&lt;part</span> <span class='an'>partid</span>=<span class='s'><span class='dl'>"</span><span class='k'>10</span><span class='dl'>"</span></span> <span class='an'>name</span>=<span class='s'><span class='dl'>"</span><span class='k'>skateboard</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'>12</span>         <span class='ta'>&lt;part</span> <span class='an'>partid</span>=<span class='s'><span class='dl'>"</span><span class='k'>11</span><span class='dl'>"</span></span> <span class='an'>name</span>=<span class='s'><span class='dl'>"</span><span class='k'>board</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>
<span class='no'>13</span>         <span class='ta'>&lt;part</span> <span class='an'>partid</span>=<span class='s'><span class='dl'>"</span><span class='k'>12</span><span class='dl'>"</span></span> <span class='an'>name</span>=<span class='s'><span class='dl'>"</span><span class='k'>wheel</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>
<span class='no'>14</span>     <span class='ta'>&lt;/part&gt;</span>
<span class='no'>15</span>     <span class='ta'>&lt;part</span> <span class='an'>partid</span>=<span class='s'><span class='dl'>"</span><span class='k'>20</span><span class='dl'>"</span></span> <span class='an'>name</span>=<span class='s'><span class='dl'>"</span><span class='k'>canoe</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>
<span class='no'>16</span> <span class='ta'>&lt;/parttree&gt;</span>
</pre></div>
</div></div><div><h3><a name='rdb-bids.xml'>Input for RDB - bids.xml</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;bids&gt;</span>
<span class='no'> 2</span> <span class='ta'>&lt;bid_tuple&gt;</span>
<span class='no'> 3</span> <span class='ta'>&lt;userid&gt;</span>U02<span class='ta'>&lt;/userid&gt;</span>
<span class='no'> 4</span> <span class='ta'>&lt;itemno&gt;</span>1001<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'> 5</span> <span class='ta'>&lt;bid&gt;</span>35<span class='ta'>&lt;/bid&gt;</span>
<span class='no'> 6</span> <span class='ta'>&lt;bid_date&gt;</span>1999-01-07<span class='ta'>&lt;/bid_date&gt;</span><span class='ta'>&lt;/bid_tuple&gt;</span>
<span class='no'> 7</span> <span class='ta'>&lt;bid_tuple&gt;</span>
<span class='no'> 8</span> <span class='ta'>&lt;userid&gt;</span>U04<span class='ta'>&lt;/userid&gt;</span>
<span class='no'> 9</span> <span class='ta'>&lt;itemno&gt;</span>1001<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'><strong>10</strong></span> <span class='ta'>&lt;bid&gt;</span>40<span class='ta'>&lt;/bid&gt;</span>
<span class='no'>11</span> <span class='ta'>&lt;bid_date&gt;</span>1999-01-08<span class='ta'>&lt;/bid_date&gt;</span><span class='ta'>&lt;/bid_tuple&gt;</span>
<span class='no'>12</span> <span class='ta'>&lt;bid_tuple&gt;</span>
<span class='no'>13</span> <span class='ta'>&lt;userid&gt;</span>U02<span class='ta'>&lt;/userid&gt;</span>
<span class='no'>14</span> <span class='ta'>&lt;itemno&gt;</span>1001<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'>15</span> <span class='ta'>&lt;bid&gt;</span>45<span class='ta'>&lt;/bid&gt;</span>
<span class='no'>16</span> <span class='ta'>&lt;bid_date&gt;</span>1999-01-11<span class='ta'>&lt;/bid_date&gt;</span><span class='ta'>&lt;/bid_tuple&gt;</span>
<span class='no'>17</span> <span class='ta'>&lt;bid_tuple&gt;</span>
<span class='no'>18</span> <span class='ta'>&lt;userid&gt;</span>U04<span class='ta'>&lt;/userid&gt;</span>
<span class='no'>19</span> <span class='ta'>&lt;itemno&gt;</span>1001<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'><strong>20</strong></span> <span class='ta'>&lt;bid&gt;</span>50<span class='ta'>&lt;/bid&gt;</span>
<span class='no'>21</span> <span class='ta'>&lt;bid_date&gt;</span>1999-01-13<span class='ta'>&lt;/bid_date&gt;</span><span class='ta'>&lt;/bid_tuple&gt;</span>
<span class='no'>22</span> <span class='ta'>&lt;bid_tuple&gt;</span>
<span class='no'>23</span> <span class='ta'>&lt;userid&gt;</span>U02<span class='ta'>&lt;/userid&gt;</span>
<span class='no'>24</span> <span class='ta'>&lt;itemno&gt;</span>1001<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'>25</span> <span class='ta'>&lt;bid&gt;</span>55<span class='ta'>&lt;/bid&gt;</span>
<span class='no'>26</span> <span class='ta'>&lt;bid_date&gt;</span>1999-01-15<span class='ta'>&lt;/bid_date&gt;</span><span class='ta'>&lt;/bid_tuple&gt;</span>
<span class='no'>27</span> <span class='ta'>&lt;bid_tuple&gt;</span>
<span class='no'>28</span> <span class='ta'>&lt;userid&gt;</span>U01<span class='ta'>&lt;/userid&gt;</span>
<span class='no'>29</span> <span class='ta'>&lt;itemno&gt;</span>1002<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'><strong>30</strong></span> <span class='ta'>&lt;bid&gt;</span>400<span class='ta'>&lt;/bid&gt;</span>
<span class='no'>31</span> <span class='ta'>&lt;bid_date&gt;</span>1999-02-14<span class='ta'>&lt;/bid_date&gt;</span><span class='ta'>&lt;/bid_tuple&gt;</span>
<span class='no'>32</span> <span class='ta'>&lt;bid_tuple&gt;</span>
<span class='no'>33</span> <span class='ta'>&lt;userid&gt;</span>U02<span class='ta'>&lt;/userid&gt;</span>
<span class='no'>34</span> <span class='ta'>&lt;itemno&gt;</span>1002<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'>35</span> <span class='ta'>&lt;bid&gt;</span>600<span class='ta'>&lt;/bid&gt;</span>
<span class='no'>36</span> <span class='ta'>&lt;bid_date&gt;</span>1999-02-16<span class='ta'>&lt;/bid_date&gt;</span><span class='ta'>&lt;/bid_tuple&gt;</span>
<span class='no'>37</span> <span class='ta'>&lt;bid_tuple&gt;</span>
<span class='no'>38</span> <span class='ta'>&lt;userid&gt;</span>U03<span class='ta'>&lt;/userid&gt;</span>
<span class='no'>39</span> <span class='ta'>&lt;itemno&gt;</span>1002<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'><strong>40</strong></span> <span class='ta'>&lt;bid&gt;</span>800<span class='ta'>&lt;/bid&gt;</span>
<span class='no'>41</span> <span class='ta'>&lt;bid_date&gt;</span>1999-02-17<span class='ta'>&lt;/bid_date&gt;</span><span class='ta'>&lt;/bid_tuple&gt;</span>
<span class='no'>42</span> <span class='ta'>&lt;bid_tuple&gt;</span>
<span class='no'>43</span> <span class='ta'>&lt;userid&gt;</span>U04<span class='ta'>&lt;/userid&gt;</span>
<span class='no'>44</span> <span class='ta'>&lt;itemno&gt;</span>1002<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'>45</span> <span class='ta'>&lt;bid&gt;</span>1000<span class='ta'>&lt;/bid&gt;</span>
<span class='no'>46</span> <span class='ta'>&lt;bid_date&gt;</span>1999-02-25<span class='ta'>&lt;/bid_date&gt;</span><span class='ta'>&lt;/bid_tuple&gt;</span>
<span class='no'>47</span> <span class='ta'>&lt;bid_tuple&gt;</span>
<span class='no'>48</span> <span class='ta'>&lt;userid&gt;</span>U02<span class='ta'>&lt;/userid&gt;</span>
<span class='no'>49</span> <span class='ta'>&lt;itemno&gt;</span>1002<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'><strong>50</strong></span> <span class='ta'>&lt;bid&gt;</span>1200<span class='ta'>&lt;/bid&gt;</span>
<span class='no'>51</span> <span class='ta'>&lt;bid_date&gt;</span>1999-03-02<span class='ta'>&lt;/bid_date&gt;</span><span class='ta'>&lt;/bid_tuple&gt;</span>
<span class='no'>52</span> <span class='ta'>&lt;bid_tuple&gt;</span>
<span class='no'>53</span> <span class='ta'>&lt;userid&gt;</span>U04<span class='ta'>&lt;/userid&gt;</span>
<span class='no'>54</span> <span class='ta'>&lt;itemno&gt;</span>1003<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'>55</span> <span class='ta'>&lt;bid&gt;</span>15<span class='ta'>&lt;/bid&gt;</span>
<span class='no'>56</span> <span class='ta'>&lt;bid_date&gt;</span>1999-01-22<span class='ta'>&lt;/bid_date&gt;</span><span class='ta'>&lt;/bid_tuple&gt;</span>
<span class='no'>57</span> <span class='ta'>&lt;bid_tuple&gt;</span>
<span class='no'>58</span> <span class='ta'>&lt;userid&gt;</span>U05<span class='ta'>&lt;/userid&gt;</span>
<span class='no'>59</span> <span class='ta'>&lt;itemno&gt;</span>1003<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'><strong>60</strong></span> <span class='ta'>&lt;bid&gt;</span>20<span class='ta'>&lt;/bid&gt;</span>
<span class='no'>61</span> <span class='ta'>&lt;bid_date&gt;</span>1999-02-03<span class='ta'>&lt;/bid_date&gt;</span><span class='ta'>&lt;/bid_tuple&gt;</span>
<span class='no'>62</span> <span class='ta'>&lt;bid_tuple&gt;</span>
<span class='no'>63</span> <span class='ta'>&lt;userid&gt;</span>U01<span class='ta'>&lt;/userid&gt;</span>
<span class='no'>64</span> <span class='ta'>&lt;itemno&gt;</span>1004<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'>65</span> <span class='ta'>&lt;bid&gt;</span>40<span class='ta'>&lt;/bid&gt;</span>
<span class='no'>66</span> <span class='ta'>&lt;bid_date&gt;</span>1999-03-05<span class='ta'>&lt;/bid_date&gt;</span><span class='ta'>&lt;/bid_tuple&gt;</span>
<span class='no'>67</span> <span class='ta'>&lt;bid_tuple&gt;</span>
<span class='no'>68</span> <span class='ta'>&lt;userid&gt;</span>U03<span class='ta'>&lt;/userid&gt;</span>
<span class='no'>69</span> <span class='ta'>&lt;itemno&gt;</span>1007<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'><strong>70</strong></span> <span class='ta'>&lt;bid&gt;</span>175<span class='ta'>&lt;/bid&gt;</span>
<span class='no'>71</span> <span class='ta'>&lt;bid_date&gt;</span>1999-01-25<span class='ta'>&lt;/bid_date&gt;</span><span class='ta'>&lt;/bid_tuple&gt;</span>
<span class='no'>72</span> <span class='ta'>&lt;bid_tuple&gt;</span>
<span class='no'>73</span> <span class='ta'>&lt;userid&gt;</span>U05<span class='ta'>&lt;/userid&gt;</span>
<span class='no'>74</span> <span class='ta'>&lt;itemno&gt;</span>1007<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'>75</span> <span class='ta'>&lt;bid&gt;</span>200<span class='ta'>&lt;/bid&gt;</span>
<span class='no'>76</span> <span class='ta'>&lt;bid_date&gt;</span>1999-02-08<span class='ta'>&lt;/bid_date&gt;</span><span class='ta'>&lt;/bid_tuple&gt;</span>
<span class='no'>77</span> <span class='ta'>&lt;bid_tuple&gt;</span>
<span class='no'>78</span> <span class='ta'>&lt;userid&gt;</span>U04<span class='ta'>&lt;/userid&gt;</span>
<span class='no'>79</span> <span class='ta'>&lt;itemno&gt;</span>1007<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'><strong>80</strong></span> <span class='ta'>&lt;bid&gt;</span>225<span class='ta'>&lt;/bid&gt;</span>
<span class='no'>81</span> <span class='ta'>&lt;bid_date&gt;</span>1999-02-12<span class='ta'>&lt;/bid_date&gt;</span><span class='ta'>&lt;/bid_tuple&gt;</span><span class='ta'>&lt;/bids&gt;</span>
</pre></div>
</div></div><div><h3><a name='rdb-items.xml'>Input for RDB - items.xml</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;items&gt;</span>
<span class='no'> 2</span> <span class='ta'>&lt;item_tuple&gt;</span>
<span class='no'> 3</span> <span class='ta'>&lt;itemno&gt;</span>1001<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'> 4</span> <span class='ta'>&lt;description&gt;</span>Red Bicycle<span class='ta'>&lt;/description&gt;</span>
<span class='no'> 5</span> <span class='ta'>&lt;offered_by&gt;</span>U01<span class='ta'>&lt;/offered_by&gt;</span>
<span class='no'> 6</span> <span class='ta'>&lt;start_day&gt;</span>1999-01-05<span class='ta'>&lt;/start_day&gt;</span>
<span class='no'> 7</span> <span class='ta'>&lt;end_day&gt;</span>1999-01-20<span class='ta'>&lt;/end_day&gt;</span>
<span class='no'> 8</span> <span class='ta'>&lt;reserve_price&gt;</span>40<span class='ta'>&lt;/reserve_price&gt;</span><span class='ta'>&lt;/item_tuple&gt;</span>
<span class='no'> 9</span> <span class='ta'>&lt;item_tuple&gt;</span>
<span class='no'><strong>10</strong></span> <span class='ta'>&lt;itemno&gt;</span>1002<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'>11</span> <span class='ta'>&lt;description&gt;</span>Motorcycle<span class='ta'>&lt;/description&gt;</span>
<span class='no'>12</span> <span class='ta'>&lt;offered_by&gt;</span>U02<span class='ta'>&lt;/offered_by&gt;</span>
<span class='no'>13</span> <span class='ta'>&lt;start_day&gt;</span>1999-02-11<span class='ta'>&lt;/start_day&gt;</span>
<span class='no'>14</span> <span class='ta'>&lt;end_day&gt;</span>1999-03-15<span class='ta'>&lt;/end_day&gt;</span>
<span class='no'>15</span> <span class='ta'>&lt;reserve_price&gt;</span>500<span class='ta'>&lt;/reserve_price&gt;</span><span class='ta'>&lt;/item_tuple&gt;</span>
<span class='no'>16</span> <span class='ta'>&lt;item_tuple&gt;</span>
<span class='no'>17</span> <span class='ta'>&lt;itemno&gt;</span>1003<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'>18</span> <span class='ta'>&lt;description&gt;</span>Old Bicycle<span class='ta'>&lt;/description&gt;</span>
<span class='no'>19</span> <span class='ta'>&lt;offered_by&gt;</span>U02<span class='ta'>&lt;/offered_by&gt;</span>
<span class='no'><strong>20</strong></span> <span class='ta'>&lt;start_day&gt;</span>1999-01-10<span class='ta'>&lt;/start_day&gt;</span>
<span class='no'>21</span> <span class='ta'>&lt;end_day&gt;</span>1999-02-20<span class='ta'>&lt;/end_day&gt;</span>
<span class='no'>22</span> <span class='ta'>&lt;reserve_price&gt;</span>25<span class='ta'>&lt;/reserve_price&gt;</span><span class='ta'>&lt;/item_tuple&gt;</span>
<span class='no'>23</span> <span class='ta'>&lt;item_tuple&gt;</span>
<span class='no'>24</span> <span class='ta'>&lt;itemno&gt;</span>1004<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'>25</span> <span class='ta'>&lt;description&gt;</span>Tricycle<span class='ta'>&lt;/description&gt;</span>
<span class='no'>26</span> <span class='ta'>&lt;offered_by&gt;</span>U01<span class='ta'>&lt;/offered_by&gt;</span>
<span class='no'>27</span> <span class='ta'>&lt;start_day&gt;</span>1999-02-25<span class='ta'>&lt;/start_day&gt;</span>
<span class='no'>28</span> <span class='ta'>&lt;end_day&gt;</span>1999-03-08<span class='ta'>&lt;/end_day&gt;</span>
<span class='no'>29</span> <span class='ta'>&lt;reserve_price&gt;</span>15<span class='ta'>&lt;/reserve_price&gt;</span><span class='ta'>&lt;/item_tuple&gt;</span>
<span class='no'><strong>30</strong></span> <span class='ta'>&lt;item_tuple&gt;</span>
<span class='no'>31</span> <span class='ta'>&lt;itemno&gt;</span>1005<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'>32</span> <span class='ta'>&lt;description&gt;</span>Tennis Racket<span class='ta'>&lt;/description&gt;</span>
<span class='no'>33</span> <span class='ta'>&lt;offered_by&gt;</span>U03<span class='ta'>&lt;/offered_by&gt;</span>
<span class='no'>34</span> <span class='ta'>&lt;start_day&gt;</span>1999-03-19<span class='ta'>&lt;/start_day&gt;</span>
<span class='no'>35</span> <span class='ta'>&lt;end_day&gt;</span>1999-04-30<span class='ta'>&lt;/end_day&gt;</span>
<span class='no'>36</span> <span class='ta'>&lt;reserve_price&gt;</span>20<span class='ta'>&lt;/reserve_price&gt;</span><span class='ta'>&lt;/item_tuple&gt;</span>
<span class='no'>37</span> <span class='ta'>&lt;item_tuple&gt;</span>
<span class='no'>38</span> <span class='ta'>&lt;itemno&gt;</span>1006<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'>39</span> <span class='ta'>&lt;description&gt;</span>Helicopter<span class='ta'>&lt;/description&gt;</span>
<span class='no'><strong>40</strong></span> <span class='ta'>&lt;offered_by&gt;</span>U03<span class='ta'>&lt;/offered_by&gt;</span>
<span class='no'>41</span> <span class='ta'>&lt;start_day&gt;</span>1999-05-05<span class='ta'>&lt;/start_day&gt;</span>
<span class='no'>42</span> <span class='ta'>&lt;end_day&gt;</span>1999-05-25<span class='ta'>&lt;/end_day&gt;</span>
<span class='no'>43</span> <span class='ta'>&lt;reserve_price&gt;</span>50000<span class='ta'>&lt;/reserve_price&gt;</span><span class='ta'>&lt;/item_tuple&gt;</span>
<span class='no'>44</span> <span class='ta'>&lt;item_tuple&gt;</span>
<span class='no'>45</span> <span class='ta'>&lt;itemno&gt;</span>1007<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'>46</span> <span class='ta'>&lt;description&gt;</span>Racing Bicycle<span class='ta'>&lt;/description&gt;</span>
<span class='no'>47</span> <span class='ta'>&lt;offered_by&gt;</span>U04<span class='ta'>&lt;/offered_by&gt;</span>
<span class='no'>48</span> <span class='ta'>&lt;start_day&gt;</span>1999-01-20<span class='ta'>&lt;/start_day&gt;</span>
<span class='no'>49</span> <span class='ta'>&lt;end_day&gt;</span>1999-02-20<span class='ta'>&lt;/end_day&gt;</span>
<span class='no'><strong>50</strong></span> <span class='ta'>&lt;reserve_price&gt;</span>200<span class='ta'>&lt;/reserve_price&gt;</span><span class='ta'>&lt;/item_tuple&gt;</span>
<span class='no'>51</span> <span class='ta'>&lt;item_tuple&gt;</span>
<span class='no'>52</span> <span class='ta'>&lt;itemno&gt;</span>1008<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'>53</span> <span class='ta'>&lt;description&gt;</span>Broken Bicycle<span class='ta'>&lt;/description&gt;</span>
<span class='no'>54</span> <span class='ta'>&lt;offered_by&gt;</span>U01<span class='ta'>&lt;/offered_by&gt;</span>
<span class='no'>55</span> <span class='ta'>&lt;start_day&gt;</span>1999-02-05<span class='ta'>&lt;/start_day&gt;</span>
<span class='no'>56</span> <span class='ta'>&lt;end_day&gt;</span>1999-03-06<span class='ta'>&lt;/end_day&gt;</span>
<span class='no'>57</span> <span class='ta'>&lt;reserve_price&gt;</span>25<span class='ta'>&lt;/reserve_price&gt;</span><span class='ta'>&lt;/item_tuple&gt;</span><span class='ta'>&lt;/items&gt;</span>
</pre></div>
</div></div><div><h3><a name='rdb-users.xml'>Input for RDB - users.xml</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;users&gt;</span>
<span class='no'> 2</span> <span class='ta'>&lt;user_tuple&gt;</span>
<span class='no'> 3</span> <span class='ta'>&lt;userid&gt;</span>U01<span class='ta'>&lt;/userid&gt;</span>
<span class='no'> 4</span> <span class='ta'>&lt;name&gt;</span>Tom Jones<span class='ta'>&lt;/name&gt;</span>
<span class='no'> 5</span> <span class='ta'>&lt;rating&gt;</span>B<span class='ta'>&lt;/rating&gt;</span><span class='ta'>&lt;/user_tuple&gt;</span>
<span class='no'> 6</span> <span class='ta'>&lt;user_tuple&gt;</span>
<span class='no'> 7</span> <span class='ta'>&lt;userid&gt;</span>U02<span class='ta'>&lt;/userid&gt;</span>
<span class='no'> 8</span> <span class='ta'>&lt;name&gt;</span>Mary Doe<span class='ta'>&lt;/name&gt;</span>
<span class='no'> 9</span> <span class='ta'>&lt;rating&gt;</span>A<span class='ta'>&lt;/rating&gt;</span><span class='ta'>&lt;/user_tuple&gt;</span>
<span class='no'><strong>10</strong></span> <span class='ta'>&lt;user_tuple&gt;</span>
<span class='no'>11</span> <span class='ta'>&lt;userid&gt;</span>U03<span class='ta'>&lt;/userid&gt;</span>
<span class='no'>12</span> <span class='ta'>&lt;name&gt;</span>Dee Linquent<span class='ta'>&lt;/name&gt;</span>
<span class='no'>13</span> <span class='ta'>&lt;rating&gt;</span>D<span class='ta'>&lt;/rating&gt;</span><span class='ta'>&lt;/user_tuple&gt;</span>
<span class='no'>14</span> <span class='ta'>&lt;user_tuple&gt;</span>
<span class='no'>15</span> <span class='ta'>&lt;userid&gt;</span>U04<span class='ta'>&lt;/userid&gt;</span>
<span class='no'>16</span> <span class='ta'>&lt;name&gt;</span>Roger Smith<span class='ta'>&lt;/name&gt;</span>
<span class='no'>17</span> <span class='ta'>&lt;rating&gt;</span>C<span class='ta'>&lt;/rating&gt;</span><span class='ta'>&lt;/user_tuple&gt;</span>
<span class='no'>18</span> <span class='ta'>&lt;user_tuple&gt;</span>
<span class='no'>19</span> <span class='ta'>&lt;userid&gt;</span>U05<span class='ta'>&lt;/userid&gt;</span>
<span class='no'><strong>20</strong></span> <span class='ta'>&lt;name&gt;</span>Jack Sprat<span class='ta'>&lt;/name&gt;</span>
<span class='no'>21</span> <span class='ta'>&lt;rating&gt;</span>B<span class='ta'>&lt;/rating&gt;</span><span class='ta'>&lt;/user_tuple&gt;</span>
<span class='no'>22</span> <span class='ta'>&lt;user_tuple&gt;</span>
<span class='no'>23</span> <span class='ta'>&lt;userid&gt;</span>U06<span class='ta'>&lt;/userid&gt;</span>
<span class='no'>24</span> <span class='ta'>&lt;name&gt;</span>Rip Van Winkle<span class='ta'>&lt;/name&gt;</span>
<span class='no'>25</span> <span class='ta'>&lt;rating&gt;</span>B<span class='ta'>&lt;/rating&gt;</span><span class='ta'>&lt;/user_tuple&gt;</span><span class='ta'>&lt;/users&gt;</span>
</pre></div>
</div></div><div><h3><a name='rdb-q1'>RDB - Q1</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>List the item number and description of all bicycles that
     currently have an auction in progress, ordered by item number.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> current_day = <span class='s'><span class='dl'>"</span><span class='k'>1999-01-31</span><span class='dl'>"</span></span>
<span class='no'> 2</span> 
<span class='no'> 3</span> items = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>items.xml</span><span class='dl'>'</span></span>).sort_by{|i| i[<span class='sy'>:@itemno</span>].to_i}
<span class='no'> 4</span> <span class='co'>XML</span>.result! {
<span class='no'> 5</span>     items.each(<span class='co'>XML</span>) {|i|
<span class='no'> 6</span>         <span class='r'>next</span> <span class='r'>unless</span> current_day.between?(i[<span class='sy'>:@start_day</span>], i[<span class='sy'>:@end_day</span>]) <span class='r'>and</span> i[<span class='sy'>:@description</span>] =~ <span class='rx'><span class='dl'>/</span><span class='k'>Bicycle</span><span class='dl'>/</span></span>
<span class='no'> 7</span>         item_tuple!(i.children(<span class='sy'>:itemno</span>), i.children(<span class='sy'>:description</span>))
<span class='no'> 8</span>     }
<span class='no'> 9</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;result&gt;
  {
    for $i in doc("items.xml")//item_tuple
    where $i/start_date &lt;= current-date()
      and $i/end_date &gt;= current-date() 
      and contains($i/description, "Bicycle")
    order by $i/itemno
    return
        &lt;item_tuple&gt;
            { $i/itemno }
            { $i/description }
        &lt;/item_tuple&gt;
  }
&lt;/result&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;result&gt;</span>
<span class='no'> 2</span>     <span class='ta'>&lt;item_tuple&gt;</span>
<span class='no'> 3</span>         <span class='ta'>&lt;itemno&gt;</span>1003<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'> 4</span>         <span class='ta'>&lt;description&gt;</span>Old Bicycle<span class='ta'>&lt;/description&gt;</span>
<span class='no'> 5</span>     <span class='ta'>&lt;/item_tuple&gt;</span>
<span class='no'> 6</span>     <span class='ta'>&lt;item_tuple&gt;</span>
<span class='no'> 7</span>         <span class='ta'>&lt;itemno&gt;</span>1007<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'> 8</span>         <span class='ta'>&lt;description&gt;</span>Racing Bicycle<span class='ta'>&lt;/description&gt;</span>
<span class='no'> 9</span>     <span class='ta'>&lt;/item_tuple&gt;</span>
<span class='no'><strong>10</strong></span> <span class='ta'>&lt;/result&gt;</span>
</pre></div>
</div></div><div><h3><a name='rdb-q2'>RDB - Q2</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>For all bicycles, list the item number, description,
     and highest bid (if any), ordered by item number.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> items = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>items.xml</span><span class='dl'>'</span></span>).sort_by{|i| i[<span class='sy'>:@itemno</span>].to_i}
<span class='no'> 2</span> bids  = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>bids.xml</span><span class='dl'>'</span></span>)
<span class='no'> 3</span> 
<span class='no'> 4</span> <span class='co'>XML</span>.result! {
<span class='no'> 5</span>     items.each({<span class='sy'>:@description</span> =&gt; <span class='rx'><span class='dl'>/</span><span class='k'>Bicycle</span><span class='dl'>/</span></span>}){|i|
<span class='no'> 6</span>         item_tuple! {
<span class='no'> 7</span>             add! i.children(<span class='sy'>:itemno</span>)
<span class='no'> 8</span>             add! i.children(<span class='sy'>:description</span>)
<span class='no'> 9</span> 
<span class='no'><strong>10</strong></span>             item_bids = bids.find_all{|b| b.is_a? <span class='co'>XML</span> <span class='r'>and</span> b[<span class='sy'>:@itemno</span>] == i[<span class='sy'>:@itemno</span>] }
<span class='no'>11</span>             high_bid! item_bids.map{|b| b[<span class='sy'>:@bid</span>].to_i}.max
<span class='no'>12</span>         }
<span class='no'>13</span>     }
<span class='no'>14</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;result&gt;
  {
    for $i in doc("items.xml")//item_tuple
    let $b := doc("bids.xml")//bid_tuple[itemno = $i/itemno]
    where contains($i/description, "Bicycle")
    order by $i/itemno
    return
        &lt;item_tuple&gt;
            { $i/itemno }
            { $i/description }
            &lt;high_bid&gt;{ max($b/bid) }&lt;/high_bid&gt;
        &lt;/item_tuple&gt;
  }
&lt;/result&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;result&gt;</span>
<span class='no'> 2</span>   <span class='ta'>&lt;item_tuple&gt;</span>
<span class='no'> 3</span>     <span class='ta'>&lt;itemno&gt;</span>1001<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'> 4</span>     <span class='ta'>&lt;description&gt;</span>Red Bicycle<span class='ta'>&lt;/description&gt;</span>
<span class='no'> 5</span>     <span class='ta'>&lt;high_bid&gt;</span>55<span class='ta'>&lt;/high_bid&gt;</span>
<span class='no'> 6</span>   <span class='ta'>&lt;/item_tuple&gt;</span>
<span class='no'> 7</span>   <span class='ta'>&lt;item_tuple&gt;</span>
<span class='no'> 8</span>     <span class='ta'>&lt;itemno&gt;</span>1003<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'> 9</span>     <span class='ta'>&lt;description&gt;</span>Old Bicycle<span class='ta'>&lt;/description&gt;</span>
<span class='no'><strong>10</strong></span>     <span class='ta'>&lt;high_bid&gt;</span>20<span class='ta'>&lt;/high_bid&gt;</span>
<span class='no'>11</span>   <span class='ta'>&lt;/item_tuple&gt;</span>
<span class='no'>12</span>   <span class='ta'>&lt;item_tuple&gt;</span>
<span class='no'>13</span>     <span class='ta'>&lt;itemno&gt;</span>1007<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'>14</span>     <span class='ta'>&lt;description&gt;</span>Racing Bicycle<span class='ta'>&lt;/description&gt;</span>
<span class='no'>15</span>     <span class='ta'>&lt;high_bid&gt;</span>225<span class='ta'>&lt;/high_bid&gt;</span>
<span class='no'>16</span>   <span class='ta'>&lt;/item_tuple&gt;</span>
<span class='no'>17</span>   <span class='ta'>&lt;item_tuple&gt;</span>
<span class='no'>18</span>     <span class='ta'>&lt;itemno&gt;</span>1008<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'>19</span>     <span class='ta'>&lt;description&gt;</span>Broken Bicycle<span class='ta'>&lt;/description&gt;</span>
<span class='no'><strong>20</strong></span>     <span class='ta'>&lt;high_bid&gt;</span><span class='ta'>&lt;/high_bid&gt;</span>
<span class='no'>21</span>   <span class='ta'>&lt;/item_tuple&gt;</span>
<span class='no'>22</span> <span class='ta'>&lt;/result&gt;</span>
</pre></div>
</div></div><div><h3><a name='rdb-q3'>RDB - Q3</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>Find cases where a user with a rating worse
     (alphabetically, greater) than "C" is offering an item
     with a reserve price of more than 1000.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> items = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>items.xml</span><span class='dl'>'</span></span>)
<span class='no'> 2</span> users = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>users.xml</span><span class='dl'>'</span></span>)
<span class='no'> 3</span> 
<span class='no'> 4</span> <span class='co'>XML</span>.result! {
<span class='no'> 5</span>     users.each(<span class='co'>XML</span>){|u|
<span class='no'> 6</span>         <span class='r'>next</span> <span class='r'>unless</span> u[<span class='sy'>:@rating</span>] &gt; <span class='s'><span class='dl'>"</span><span class='k'>C</span><span class='dl'>"</span></span>
<span class='no'> 7</span>         items.each(<span class='co'>XML</span>){|i|
<span class='no'> 8</span>             <span class='r'>next</span> <span class='r'>unless</span> i[<span class='sy'>:@reserve_price</span>].to_i &gt; <span class='i'>1000</span>
<span class='no'> 9</span>             warning!(u.child(<span class='sy'>:name</span>), u.child(<span class='sy'>:rating</span>), i.child(<span class='sy'>:description</span>), i.child(<span class='sy'>:reserve_price</span>))
<span class='no'><strong>10</strong></span>         }
<span class='no'>11</span>     }
<span class='no'>12</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;result&gt;
  {
    for $u in doc("users.xml")//user_tuple
    for $i in doc("items.xml")//item_tuple
    where $u/rating &gt; "C" 
       and $i/reserve_price &gt; 1000 
       and $i/offered_by = $u/userid
    return
        &lt;warning&gt;
            { $u/name }
            { $u/rating }
            { $i/description }
            { $i/reserve_price }
        &lt;/warning&gt;
  }
&lt;/result&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='ta'>&lt;result&gt;</span>
<span class='no'>2</span>     <span class='ta'>&lt;warning&gt;</span>
<span class='no'>3</span>         <span class='ta'>&lt;name&gt;</span>Dee Linquent<span class='ta'>&lt;/name&gt;</span>
<span class='no'>4</span>         <span class='ta'>&lt;rating&gt;</span>D<span class='ta'>&lt;/rating&gt;</span>
<span class='no'>5</span>         <span class='ta'>&lt;description&gt;</span>Helicopter<span class='ta'>&lt;/description&gt;</span>
<span class='no'>6</span>         <span class='ta'>&lt;reserve_price&gt;</span>50000<span class='ta'>&lt;/reserve_price&gt;</span>
<span class='no'>7</span>     <span class='ta'>&lt;/warning&gt;</span>
<span class='no'>8</span> <span class='ta'>&lt;/result&gt;</span></pre></div>
</div></div><div><h3><a name='rdb-q4'>RDB - Q4</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>List item numbers and descriptions of items that have no bids.
     For bicycle(s) offered by Tom Jones that have received a bid,
     list the item number, description, highest bid, and name
     of the highest bidder, ordered by item number.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> items = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>items.xml</span><span class='dl'>'</span></span>)
<span class='no'> 2</span> bids = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>bids.xml</span><span class='dl'>'</span></span>)
<span class='no'> 3</span> 
<span class='no'> 4</span> <span class='co'>XML</span>.result!{
<span class='no'> 5</span>     items.each(<span class='co'>XML</span>){|i|
<span class='no'> 6</span>         <span class='r'>next</span> <span class='r'>if</span> bids.any?{|b| b.is_a? <span class='co'>XML</span> <span class='r'>and</span> b[<span class='sy'>:@itemno</span>] == i[<span class='sy'>:@itemno</span>]}
<span class='no'> 7</span>         no_bid_item!(i.child(<span class='sy'>:itemno</span>), i.child(<span class='sy'>:description</span>))
<span class='no'> 8</span>     }
<span class='no'> 9</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;result&gt;
  {
    for $i in doc("items.xml")//item_tuple
    where empty(doc("bids.xml")//bid_tuple[itemno = $i/itemno])
    return
        &lt;no_bid_item&gt;
            { $i/itemno }
            { $i/description }
        &lt;/no_bid_item&gt;
  }
&lt;/result&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;result&gt;</span>
<span class='no'> 2</span>     <span class='ta'>&lt;no_bid_item&gt;</span>
<span class='no'> 3</span>         <span class='ta'>&lt;itemno&gt;</span>1005<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'> 4</span>         <span class='ta'>&lt;description&gt;</span>Tennis Racket<span class='ta'>&lt;/description&gt;</span>
<span class='no'> 5</span>     <span class='ta'>&lt;/no_bid_item&gt;</span>
<span class='no'> 6</span>     <span class='ta'>&lt;no_bid_item&gt;</span>
<span class='no'> 7</span>         <span class='ta'>&lt;itemno&gt;</span>1006<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'> 8</span>         <span class='ta'>&lt;description&gt;</span>Helicopter<span class='ta'>&lt;/description&gt;</span>
<span class='no'> 9</span>     <span class='ta'>&lt;/no_bid_item&gt;</span>
<span class='no'><strong>10</strong></span>     <span class='ta'>&lt;no_bid_item&gt;</span>
<span class='no'>11</span>         <span class='ta'>&lt;itemno&gt;</span>1008<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'>12</span>         <span class='ta'>&lt;description&gt;</span>Broken Bicycle<span class='ta'>&lt;/description&gt;</span>
<span class='no'>13</span>     <span class='ta'>&lt;/no_bid_item&gt;</span>
<span class='no'>14</span> <span class='ta'>&lt;/result&gt;</span>
</pre></div>
</div></div><div><h3><a name='rdb-q5'>RDB - Q5</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p/><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> items = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>items.xml</span><span class='dl'>'</span></span>).sort_by{|i| i[<span class='sy'>:@itemno</span>].to_i}
<span class='no'> 2</span> users = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>users.xml</span><span class='dl'>'</span></span>)
<span class='no'> 3</span> bids  = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>bids.xml</span><span class='dl'>'</span></span>)
<span class='no'> 4</span> 
<span class='no'> 5</span> <span class='co'>XML</span>.result! {
<span class='no'> 6</span>     users.each({<span class='sy'>:@name</span> =&gt; <span class='s'><span class='dl'>"</span><span class='k'>Tom Jones</span><span class='dl'>"</span></span>}) {|seller|
<span class='no'> 7</span>         items.each({<span class='sy'>:@offered_by</span> =&gt; seller[<span class='sy'>:@userid</span>], <span class='sy'>:@description</span> =&gt; <span class='rx'><span class='dl'>/</span><span class='k'>Bicycle</span><span class='dl'>/</span></span>}) {|item|
<span class='no'> 8</span>             bids.each({<span class='sy'>:@itemno</span> =&gt; item[<span class='sy'>:@itemno</span>]}) {|highbid|
<span class='no'> 9</span>                 users.each({<span class='sy'>:@userid</span> =&gt; highbid[<span class='sy'>:@userid</span>]}) {|buyer|
<span class='no'><strong>10</strong></span>                     best_bid = bids.find_all{|b| b.is_a? <span class='co'>XML</span> <span class='r'>and</span> b[<span class='sy'>:@itemno</span>] == item[<span class='sy'>:@itemno</span>]}.map{|b| b[<span class='sy'>:@bid</span>].to_i}.max
<span class='no'>11</span>                     <span class='r'>next</span> <span class='r'>unless</span> highbid[<span class='sy'>:@bid</span>].to_i == best_bid
<span class='no'>12</span>                     
<span class='no'>13</span>                     jones_bike! {
<span class='no'>14</span>                         add! item.child(<span class='sy'>:itemno</span>)
<span class='no'>15</span>                         add! item.child(<span class='sy'>:description</span>)
<span class='no'>16</span>                         high_bid! highbid.child(<span class='sy'>:bid</span>)
<span class='no'>17</span>                         high_bidder! buyer.child(<span class='sy'>:name</span>)
<span class='no'>18</span>                     }
<span class='no'>19</span>                 }
<span class='no'><strong>20</strong></span>             }
<span class='no'>21</span>         }
<span class='no'>22</span>     }
<span class='no'>23</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;result&gt;
  {
    for $seller in doc("users.xml")//user_tuple,
        $buyer in  doc("users.xml")//user_tuple,
        $item in  doc("items.xml")//item_tuple,
        $highbid in  doc("bids.xml")//bid_tuple
    where $seller/name = "Tom Jones"
      and $seller/userid  = $item/offered_by
      and contains($item/description , "Bicycle")
      and $item/itemno  = $highbid/itemno
      and $highbid/userid  = $buyer/userid
      and $highbid/bid = max(
                              doc("bids.xml")//bid_tuple
                                [itemno = $item/itemno]/bid
                         )
    order by ($item/itemno)
    return
        &lt;jones_bike&gt;
            { $item/itemno }
            { $item/description }
            &lt;high_bid&gt;{ $highbid/bid }&lt;/high_bid&gt;
            &lt;high_bidder&gt;{ $buyer/name }&lt;/high_bidder&gt;
        &lt;/jones_bike&gt;
  }
&lt;/result&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;result&gt;</span>
<span class='no'> 2</span>     <span class='ta'>&lt;jones_bike&gt;</span>
<span class='no'> 3</span>         <span class='ta'>&lt;itemno&gt;</span>1001<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'> 4</span>         <span class='ta'>&lt;description&gt;</span>Red Bicycle<span class='ta'>&lt;/description&gt;</span>
<span class='no'> 5</span>         <span class='ta'>&lt;high_bid&gt;</span>
<span class='no'> 6</span>             <span class='ta'>&lt;bid&gt;</span>55<span class='ta'>&lt;/bid&gt;</span>
<span class='no'> 7</span>         <span class='ta'>&lt;/high_bid&gt;</span>
<span class='no'> 8</span>         <span class='ta'>&lt;high_bidder&gt;</span>
<span class='no'> 9</span>             <span class='ta'>&lt;name&gt;</span>Mary Doe<span class='ta'>&lt;/name&gt;</span>
<span class='no'><strong>10</strong></span>         <span class='ta'>&lt;/high_bidder&gt;</span>
<span class='no'>11</span>     <span class='ta'>&lt;/jones_bike&gt;</span>
<span class='no'>12</span> <span class='ta'>&lt;/result&gt;</span>
</pre></div>
</div></div><div><h3><a name='rdb-q6'>RDB - Q6</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>For each item whose highest bid is more than twice its
     reserve price, list the item number, description,
     reserve price, and highest bid.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> items = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>items.xml</span><span class='dl'>'</span></span>)
<span class='no'> 2</span> bids  = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>bids.xml</span><span class='dl'>'</span></span>)
<span class='no'> 3</span> 
<span class='no'> 4</span> <span class='co'>XML</span>.result! {
<span class='no'> 5</span>     items.each(<span class='co'>XML</span>){|item|
<span class='no'> 6</span> z = bids.find_all{|b| b.is_a? <span class='co'>XML</span> <span class='r'>and</span> b[<span class='sy'>:@itemno</span>] == item[<span class='sy'>:@itemno</span>]}.map{|b| b[<span class='sy'>:@bid</span>].to_i}.max
<span class='no'> 7</span>         <span class='r'>next</span> <span class='r'>unless</span> z <span class='r'>and</span> item[<span class='sy'>:@reserve_price</span>].to_i * <span class='i'>2</span> &lt; z
<span class='no'> 8</span>         successful_item! {
<span class='no'> 9</span>             add! item.child(<span class='sy'>:itemno</span>)
<span class='no'><strong>10</strong></span>             add! item.child(<span class='sy'>:description</span>)
<span class='no'>11</span>             add! item.child(<span class='sy'>:reserve_price</span>)
<span class='no'>12</span>             high_bid! z
<span class='no'>13</span>         }
<span class='no'>14</span>     }
<span class='no'>15</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;result&gt;
  {
    for $item in doc("items.xml")//item_tuple
    let $b := doc("bids.xml")//bid_tuple[itemno = $item/itemno]
    let $z := max($b/bid)
    where $item/reserve_price * 2 &lt; $z
    return
        &lt;successful_item&gt;
            { $item/itemno }
            { $item/description }
            { $item/reserve_price }
            &lt;high_bid&gt;{$z }&lt;/high_bid&gt;
         &lt;/successful_item&gt;
  }
&lt;/result&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;result&gt;</span>
<span class='no'> 2</span>     <span class='ta'>&lt;successful_item&gt;</span>
<span class='no'> 3</span>         <span class='ta'>&lt;itemno&gt;</span>1002<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'> 4</span>         <span class='ta'>&lt;description&gt;</span>Motorcycle<span class='ta'>&lt;/description&gt;</span>
<span class='no'> 5</span>         <span class='ta'>&lt;reserve_price&gt;</span>500<span class='ta'>&lt;/reserve_price&gt;</span>
<span class='no'> 6</span>         <span class='ta'>&lt;high_bid&gt;</span>1200<span class='ta'>&lt;/high_bid&gt;</span>
<span class='no'> 7</span>     <span class='ta'>&lt;/successful_item&gt;</span>
<span class='no'> 8</span>     <span class='ta'>&lt;successful_item&gt;</span>
<span class='no'> 9</span>         <span class='ta'>&lt;itemno&gt;</span>1004<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'><strong>10</strong></span>         <span class='ta'>&lt;description&gt;</span>Tricycle<span class='ta'>&lt;/description&gt;</span>
<span class='no'>11</span>         <span class='ta'>&lt;reserve_price&gt;</span>15<span class='ta'>&lt;/reserve_price&gt;</span>
<span class='no'>12</span>         <span class='ta'>&lt;high_bid&gt;</span>40<span class='ta'>&lt;/high_bid&gt;</span>
<span class='no'>13</span>     <span class='ta'>&lt;/successful_item&gt;</span>
<span class='no'>14</span> <span class='ta'>&lt;/result&gt;</span>
</pre></div>
</div></div><div><h3><a name='rdb-q7'>RDB - Q7</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>Find the highest bid ever made for a bicycle or tricycle.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> items = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>items.xml</span><span class='dl'>'</span></span>)
<span class='no'>2</span> bids  = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>bids.xml</span><span class='dl'>'</span></span>)
<span class='no'>3</span> 
<span class='no'>4</span> allbikes = items.children({<span class='sy'>:@description</span> =&gt; <span class='rx'><span class='dl'>/</span><span class='k'>Bicycle|Tricycle</span><span class='dl'>/</span></span>}).map{|item| item[<span class='sy'>:@itemno</span>]}
<span class='no'>5</span> 
<span class='no'>6</span> <span class='co'>XML</span>.high_bid! {
<span class='no'>7</span>     add! bids.find_all{|b| b.is_a? <span class='co'>XML</span> <span class='r'>and</span> allbikes.include? b[<span class='sy'>:@itemno</span>]}.map{|b| b[<span class='sy'>:@bid</span>].to_i}.max
<span class='no'>8</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>let $allbikes := doc("items.xml")//item_tuple
                    [contains(description, "Bicycle") 
                     or contains(description, "Tricycle")]
let $bikebids := doc("bids.xml")//bid_tuple[itemno = $allbikes/itemno]
return
    &lt;high_bid&gt;
      { 
        max($bikebids/bid) 
      }
    &lt;/high_bid&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='ta'>&lt;high_bid&gt;</span>225<span class='ta'>&lt;/high_bid&gt;</span>
</pre></div>
</div></div><div><h3><a name='rdb-q8'>RDB - Q8</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>How many items were actioned (auction ended) in March 1999?
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='co'>XML</span>.item_count! <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>items.xml</span><span class='dl'>'</span></span>).find_all{|item| item.is_a? <span class='co'>XML</span> <span class='r'>and</span> item[<span class='sy'>:@end_day</span>] =~ <span class='rx'><span class='dl'>/</span><span class='k'>^1999-03</span><span class='dl'>/</span></span>}.size
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>let $item := doc("items.xml")//item_tuple
  [end_date &gt;= xs:date("1999-03-01") and end_date &lt;= xs:date("1999-03-31")]
return
    &lt;item_count&gt;
      { 
        count($item) 
      }
    &lt;/item_count&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='ta'>&lt;item_count&gt;</span>3<span class='ta'>&lt;/item_count&gt;</span>
</pre></div>
</div></div><div><h3><a name='rdb-q9'>RDB - Q9</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>List the number of items auctioned each month in 1999 for
     which data is available, ordered by month.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> items = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>items.xml</span><span class='dl'>'</span></span>).children(<span class='sy'>:item_tuple</span>)
<span class='no'> 2</span> 
<span class='no'> 3</span> <span class='co'>XML</span>.result! {
<span class='no'> 4</span>     items.map{|item| item[<span class='sy'>:@end_day</span>] =~ <span class='rx'><span class='dl'>/</span><span class='k'>^1999-(</span><span class='ch'>\d</span><span class='k'>+)</span><span class='dl'>/</span></span>; <span class='gv'>$1</span>.to_i}.sort.uniq.each{|m|
<span class='no'> 5</span>         monthly_result! {
<span class='no'> 6</span>             month! m
<span class='no'> 7</span>             item_count!(items.find_all{|item| item[<span class='sy'>:@end_day</span>] =~ <span class='rx'><span class='dl'>/</span><span class='k'>1999-(</span><span class='ch'>\d</span><span class='k'>+)</span><span class='dl'>/</span></span>; <span class='gv'>$1</span>.to_i==m}.size)
<span class='no'> 8</span>         }
<span class='no'> 9</span>     }
<span class='no'><strong>10</strong></span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;result&gt;
  {
    let $end_dates := doc("items.xml")//item_tuple/end_date
    for $m in distinct-values(for $e in $end_dates 
                              return month-from-date($e))
    let $item := doc("items.xml")
        //item_tuple[year-from-date(end_date) = 1999 
                     and month-from-date(end_date) = $m]
    order by $m
    return
        &lt;monthly_result&gt;
            &lt;month&gt;{ $m }&lt;/month&gt;
            &lt;item_count&gt;{ count($item) }&lt;/item_count&gt;
        &lt;/monthly_result&gt;
  }
&lt;/result&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;result&gt;</span>
<span class='no'> 2</span>     <span class='ta'>&lt;monthly_result&gt;</span>
<span class='no'> 3</span>         <span class='ta'>&lt;month&gt;</span>1<span class='ta'>&lt;/month&gt;</span>
<span class='no'> 4</span>         <span class='ta'>&lt;item_count&gt;</span>1<span class='ta'>&lt;/item_count&gt;</span>
<span class='no'> 5</span>     <span class='ta'>&lt;/monthly_result&gt;</span>
<span class='no'> 6</span>     <span class='ta'>&lt;monthly_result&gt;</span>
<span class='no'> 7</span>         <span class='ta'>&lt;month&gt;</span>2<span class='ta'>&lt;/month&gt;</span>
<span class='no'> 8</span>         <span class='ta'>&lt;item_count&gt;</span>2<span class='ta'>&lt;/item_count&gt;</span>
<span class='no'> 9</span>     <span class='ta'>&lt;/monthly_result&gt;</span>
<span class='no'><strong>10</strong></span>     <span class='ta'>&lt;monthly_result&gt;</span>
<span class='no'>11</span>         <span class='ta'>&lt;month&gt;</span>3<span class='ta'>&lt;/month&gt;</span>
<span class='no'>12</span>         <span class='ta'>&lt;item_count&gt;</span>3<span class='ta'>&lt;/item_count&gt;</span>
<span class='no'>13</span>     <span class='ta'>&lt;/monthly_result&gt;</span>
<span class='no'>14</span>     <span class='ta'>&lt;monthly_result&gt;</span>
<span class='no'>15</span>         <span class='ta'>&lt;month&gt;</span>4<span class='ta'>&lt;/month&gt;</span>
<span class='no'>16</span>         <span class='ta'>&lt;item_count&gt;</span>1<span class='ta'>&lt;/item_count&gt;</span>
<span class='no'>17</span>     <span class='ta'>&lt;/monthly_result&gt;</span>
<span class='no'>18</span>     <span class='ta'>&lt;monthly_result&gt;</span>
<span class='no'>19</span>         <span class='ta'>&lt;month&gt;</span>5<span class='ta'>&lt;/month&gt;</span>
<span class='no'><strong>20</strong></span>         <span class='ta'>&lt;item_count&gt;</span>1<span class='ta'>&lt;/item_count&gt;</span>
<span class='no'>21</span>     <span class='ta'>&lt;/monthly_result&gt;</span>
<span class='no'>22</span> <span class='ta'>&lt;/result&gt;</span>
</pre></div>
</div></div><div><h3><a name='rdb-q10'>RDB - Q10</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>For each item that has received a bid, list the item
      number, the highest bid, and the name of the highest
      bidder, ordered by item number.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> users = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>users.xml</span><span class='dl'>'</span></span>)
<span class='no'> 2</span> bids  = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>bids.xml</span><span class='dl'>'</span></span>).sort_by{|b| b[<span class='sy'>:@itemno</span>].to_i}
<span class='no'> 3</span> 
<span class='no'> 4</span> <span class='co'>XML</span>.result! {
<span class='no'> 5</span>     bids.each{|highbid|
<span class='no'> 6</span>         <span class='r'>next</span> <span class='r'>if</span> bids.any?{|b| b[<span class='sy'>:@itemno</span>] == highbid[<span class='sy'>:@itemno</span>] <span class='r'>and</span> b[<span class='sy'>:@bid</span>].to_i &gt; highbid[<span class='sy'>:@bid</span>].to_i}
<span class='no'> 7</span>         users.children({<span class='sy'>:@userid</span> =&gt; highbid[<span class='sy'>:@userid</span>]}){|user|
<span class='no'> 8</span>             high_bid! {
<span class='no'> 9</span>                 add! highbid.child(<span class='sy'>:itemno</span>)
<span class='no'><strong>10</strong></span>                 add! highbid.child(<span class='sy'>:bid</span>)
<span class='no'>11</span>                 bidder! user[<span class='sy'>:@name</span>]
<span class='no'>12</span>             }
<span class='no'>13</span>         }
<span class='no'>14</span>     }
<span class='no'>15</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;result&gt;
 {
    for $highbid in doc("bids.xml")//bid_tuple,
        $user in doc("users.xml")//user_tuple
    where $user/userid = $highbid/userid 
      and $highbid/bid = max(doc("bids.xml")//bid_tuple[itemno=$highbid/itemno]/bid)
    order by $highbid/itemno
    return
        &lt;high_bid&gt;
            { $highbid/itemno }
            { $highbid/bid }
            &lt;bidder&gt;{ $user/name/text() }&lt;/bidder&gt;
        &lt;/high_bid&gt;
  }
&lt;/result&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;result&gt;</span>
<span class='no'> 2</span>     <span class='ta'>&lt;high_bid&gt;</span>
<span class='no'> 3</span>         <span class='ta'>&lt;itemno&gt;</span>1001<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'> 4</span>         <span class='ta'>&lt;bid&gt;</span>55<span class='ta'>&lt;/bid&gt;</span>
<span class='no'> 5</span>         <span class='ta'>&lt;bidder&gt;</span>Mary Doe<span class='ta'>&lt;/bidder&gt;</span>
<span class='no'> 6</span>     <span class='ta'>&lt;/high_bid&gt;</span>
<span class='no'> 7</span>     <span class='ta'>&lt;high_bid&gt;</span>
<span class='no'> 8</span>         <span class='ta'>&lt;itemno&gt;</span>1002<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'> 9</span>         <span class='ta'>&lt;bid&gt;</span>1200<span class='ta'>&lt;/bid&gt;</span>
<span class='no'><strong>10</strong></span>         <span class='ta'>&lt;bidder&gt;</span>Mary Doe<span class='ta'>&lt;/bidder&gt;</span>
<span class='no'>11</span>     <span class='ta'>&lt;/high_bid&gt;</span>
<span class='no'>12</span>     <span class='ta'>&lt;high_bid&gt;</span>
<span class='no'>13</span>         <span class='ta'>&lt;itemno&gt;</span>1003<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'>14</span>         <span class='ta'>&lt;bid&gt;</span>20<span class='ta'>&lt;/bid&gt;</span>
<span class='no'>15</span>         <span class='ta'>&lt;bidder&gt;</span>Jack Sprat<span class='ta'>&lt;/bidder&gt;</span>
<span class='no'>16</span>     <span class='ta'>&lt;/high_bid&gt;</span>
<span class='no'>17</span>     <span class='ta'>&lt;high_bid&gt;</span>
<span class='no'>18</span>         <span class='ta'>&lt;itemno&gt;</span>1004<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'>19</span>         <span class='ta'>&lt;bid&gt;</span>40<span class='ta'>&lt;/bid&gt;</span>
<span class='no'><strong>20</strong></span>         <span class='ta'>&lt;bidder&gt;</span>Tom Jones<span class='ta'>&lt;/bidder&gt;</span>
<span class='no'>21</span>     <span class='ta'>&lt;/high_bid&gt;</span>
<span class='no'>22</span>     <span class='ta'>&lt;high_bid&gt;</span>
<span class='no'>23</span>         <span class='ta'>&lt;itemno&gt;</span>1007<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'>24</span>         <span class='ta'>&lt;bid&gt;</span>225<span class='ta'>&lt;/bid&gt;</span>
<span class='no'>25</span>         <span class='ta'>&lt;bidder&gt;</span>Roger Smith<span class='ta'>&lt;/bidder&gt;</span>
<span class='no'>26</span>     <span class='ta'>&lt;/high_bid&gt;</span>
<span class='no'>27</span> <span class='ta'>&lt;/result&gt;</span>
</pre></div>
</div></div><div><h3><a name='rdb-q11'>RDB - Q11</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>List the item number and description of the item(s)
      that received the highest bid ever recorded, and the
      amount of that bid.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> items = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>items.xml</span><span class='dl'>'</span></span>)
<span class='no'> 2</span> bids  = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>bids.xml</span><span class='dl'>'</span></span>)
<span class='no'> 3</span> 
<span class='no'> 4</span> highbid = bids.children.children(<span class='sy'>:bid</span>).map{|b| b.text.to_i}.max.to_s
<span class='no'> 5</span> 
<span class='no'> 6</span> <span class='co'>XML</span>.result! {
<span class='no'> 7</span>     items.each(<span class='co'>XML</span>){|item|
<span class='no'> 8</span>         bids.each({<span class='sy'>:@itemno</span> =&gt; item[<span class='sy'>:@itemno</span>], <span class='sy'>:@bid</span> =&gt; highbid}) {|b|
<span class='no'> 9</span>             expensive_item! {
<span class='no'><strong>10</strong></span>                 add! item.child(<span class='sy'>:itemno</span>)
<span class='no'>11</span>                 add! item.child(<span class='sy'>:description</span>)
<span class='no'>12</span>                 high_bid! highbid
<span class='no'>13</span>             }
<span class='no'>14</span>         }
<span class='no'>15</span>     }
<span class='no'>16</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>let $highbid := max(doc("bids.xml")//bid_tuple/bid)
return
    &lt;result&gt;
     {
        for $item in doc("items.xml")//item_tuple,
            $b in doc("bids.xml")//bid_tuple[itemno = $item/itemno]
        where $b/bid = $highbid
        return
            &lt;expensive_item&gt;
                { $item/itemno }
                { $item/description }
                &lt;high_bid&gt;{ $highbid }&lt;/high_bid&gt;
            &lt;/expensive_item&gt;
     }
    &lt;/result&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='ta'>&lt;result&gt;</span>
<span class='no'>2</span>     <span class='ta'>&lt;expensive_item&gt;</span>
<span class='no'>3</span>         <span class='ta'>&lt;itemno&gt;</span>1002<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'>4</span>         <span class='ta'>&lt;description&gt;</span>Motorcycle<span class='ta'>&lt;/description&gt;</span>
<span class='no'>5</span>         <span class='ta'>&lt;high_bid&gt;</span>1200<span class='ta'>&lt;/high_bid&gt;</span>
<span class='no'>6</span>     <span class='ta'>&lt;/expensive_item&gt;</span>
<span class='no'>7</span> <span class='ta'>&lt;/result&gt;</span>
</pre></div>
</div></div><div><h3><a name='rdb-q12'>RDB - Q12</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>List the item number and description of the item(s)
      that received the largest number of bids, and the
      number of bids it (or they) received.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> items = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>items.xml</span><span class='dl'>'</span></span>)
<span class='no'> 2</span> bids  = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>bids.xml</span><span class='dl'>'</span></span>).children(<span class='sy'>:bid_tuple</span>)
<span class='no'> 3</span> 
<span class='no'> 4</span> <span class='co'>XML</span>.result! {
<span class='no'> 5</span>     bids_per_item = <span class='co'>Hash</span>.new([])
<span class='no'> 6</span>     bids.each{|bid|
<span class='no'> 7</span>         bids_per_item[bid[<span class='sy'>:@itemno</span>]] += [bid]
<span class='no'> 8</span>     }
<span class='no'> 9</span>     max_bid_count = bids_per_item.map{|k,v| v.size}.max
<span class='no'><strong>10</strong></span> 
<span class='no'>11</span>     items.each(<span class='co'>XML</span>){|item|
<span class='no'>12</span>         <span class='r'>next</span> <span class='r'>unless</span> bids_per_item[item[<span class='sy'>:@itemno</span>]].size == max_bid_count
<span class='no'>13</span>         popular_item! {
<span class='no'>14</span>             add! item.child(<span class='sy'>:itemno</span>)
<span class='no'>15</span>             add! item.child(<span class='sy'>:description</span>)
<span class='no'>16</span>             bid_count! max_bid_count
<span class='no'>17</span>         }
<span class='no'>18</span>     }
<span class='no'>19</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>declare function local:bid_summary()
  as element()*
{
    for $i in distinct-values(doc("bids.xml")//itemno)
    let $b := doc("bids.xml")//bid_tuple[itemno = $i]
    return
        &lt;bid_count&gt;
            &lt;itemno&gt;{ $i }&lt;/itemno&gt;
            &lt;nbids&gt;{ count($b) }&lt;/nbids&gt;
        &lt;/bid_count&gt;
};

&lt;result&gt;
 {
    let $bid_counts := local:bid_summary(),
        $maxbids := max($bid_counts/nbids),
        $maxitemnos := $bid_counts[nbids = $maxbids]
    for $item in doc("items.xml")//item_tuple,
        $bc in $bid_counts
    where $bc/nbids =  $maxbids and $item/itemno = $bc/itemno
    return
        &lt;popular_item&gt;
            { $item/itemno }
            { $item/description }
            &lt;bid_count&gt;{ $bc/nbids/text() }&lt;/bid_count&gt;
        &lt;/popular_item&gt;
 }
&lt;/result&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;result&gt;</span>
<span class='no'> 2</span>     <span class='ta'>&lt;popular_item&gt;</span>
<span class='no'> 3</span>         <span class='ta'>&lt;itemno&gt;</span>1001<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'> 4</span>         <span class='ta'>&lt;description&gt;</span>Red Bicycle<span class='ta'>&lt;/description&gt;</span>
<span class='no'> 5</span>         <span class='ta'>&lt;bid_count&gt;</span>5<span class='ta'>&lt;/bid_count&gt;</span>
<span class='no'> 6</span>     <span class='ta'>&lt;/popular_item&gt;</span>
<span class='no'> 7</span>     <span class='ta'>&lt;popular_item&gt;</span>
<span class='no'> 8</span>         <span class='ta'>&lt;itemno&gt;</span>1002<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'> 9</span>         <span class='ta'>&lt;description&gt;</span>Motorcycle<span class='ta'>&lt;/description&gt;</span>
<span class='no'><strong>10</strong></span>         <span class='ta'>&lt;bid_count&gt;</span>5<span class='ta'>&lt;/bid_count&gt;</span>
<span class='no'>11</span>     <span class='ta'>&lt;/popular_item&gt;</span>
<span class='no'>12</span> <span class='ta'>&lt;/result&gt;</span>
</pre></div>
</div></div><div><h3><a name='rdb-q13'>RDB - Q13</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>For each user who has placed a bid, give the userid,
      name, number of bids, and average bid, in order by userid.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> users = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>users.xml</span><span class='dl'>'</span></span>)
<span class='no'> 2</span> bids  = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>bids.xml</span><span class='dl'>'</span></span>)
<span class='no'> 3</span> 
<span class='no'> 4</span> <span class='co'>XML</span>.result! {
<span class='no'> 5</span>     bids.descendants(<span class='sy'>:userid</span>).map{|uid| uid.text}.uniq.sort.each{|uid|
<span class='no'> 6</span>         users.each({<span class='sy'>:@userid</span> =&gt; uid}){|u|
<span class='no'> 7</span>             user_bids = bids.find_all{|b| b.is_a? <span class='co'>XML</span> <span class='r'>and</span> b[<span class='sy'>:@userid</span>] == uid}
<span class='no'> 8</span>             bidder! {
<span class='no'> 9</span>                 add! u.child(<span class='sy'>:userid</span>)
<span class='no'><strong>10</strong></span>                 add! u.child(<span class='sy'>:name</span>)
<span class='no'>11</span>                 bidcount! user_bids.size
<span class='no'>12</span>                 sum = <span class='fl'>0.0</span>
<span class='no'>13</span>                 user_bids.each{|b|
<span class='no'>14</span>                     sum += b[<span class='sy'>:@bid</span>].to_i
<span class='no'>15</span>                 }
<span class='no'>16</span>                 a = sum / user_bids.size
<span class='no'>17</span> a = a.to_i <span class='r'>if</span> a.to_i == a
<span class='no'>18</span>                 avgbid! a
<span class='no'>19</span>             }
<span class='no'><strong>20</strong></span>         }
<span class='no'>21</span>     }
<span class='no'>22</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;result&gt;
 {
    for $uid in distinct-values(doc("bids.xml")//userid),
        $u in doc("users.xml")//user_tuple[userid = $uid]
    let $b := doc("bids.xml")//bid_tuple[userid = $uid]
    order by $u/userid
    return
        &lt;bidder&gt;
            { $u/userid }
            { $u/name }
            &lt;bidcount&gt;{ count($b) }&lt;/bidcount&gt;
            &lt;avgbid&gt;{ avg($b/bid) }&lt;/avgbid&gt;
        &lt;/bidder&gt;
  }
&lt;/result&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;result&gt;</span>
<span class='no'> 2</span>     <span class='ta'>&lt;bidder&gt;</span>
<span class='no'> 3</span>         <span class='ta'>&lt;userid&gt;</span>U01<span class='ta'>&lt;/userid&gt;</span>
<span class='no'> 4</span>         <span class='ta'>&lt;name&gt;</span>Tom Jones<span class='ta'>&lt;/name&gt;</span>
<span class='no'> 5</span>         <span class='ta'>&lt;bidcount&gt;</span>2<span class='ta'>&lt;/bidcount&gt;</span>
<span class='no'> 6</span>         <span class='ta'>&lt;avgbid&gt;</span>220<span class='ta'>&lt;/avgbid&gt;</span>
<span class='no'> 7</span>     <span class='ta'>&lt;/bidder&gt;</span>
<span class='no'> 8</span>     <span class='ta'>&lt;bidder&gt;</span>
<span class='no'> 9</span>         <span class='ta'>&lt;userid&gt;</span>U02<span class='ta'>&lt;/userid&gt;</span>
<span class='no'><strong>10</strong></span>         <span class='ta'>&lt;name&gt;</span>Mary Doe<span class='ta'>&lt;/name&gt;</span>
<span class='no'>11</span>         <span class='ta'>&lt;bidcount&gt;</span>5<span class='ta'>&lt;/bidcount&gt;</span>
<span class='no'>12</span>         <span class='ta'>&lt;avgbid&gt;</span>387<span class='ta'>&lt;/avgbid&gt;</span>
<span class='no'>13</span>     <span class='ta'>&lt;/bidder&gt;</span>
<span class='no'>14</span>     <span class='ta'>&lt;bidder&gt;</span>
<span class='no'>15</span>         <span class='ta'>&lt;userid&gt;</span>U03<span class='ta'>&lt;/userid&gt;</span>
<span class='no'>16</span>         <span class='ta'>&lt;name&gt;</span>Dee Linquent<span class='ta'>&lt;/name&gt;</span>
<span class='no'>17</span>         <span class='ta'>&lt;bidcount&gt;</span>2<span class='ta'>&lt;/bidcount&gt;</span>
<span class='no'>18</span>         <span class='ta'>&lt;avgbid&gt;</span>487.5<span class='ta'>&lt;/avgbid&gt;</span>
<span class='no'>19</span>     <span class='ta'>&lt;/bidder&gt;</span>
<span class='no'><strong>20</strong></span>     <span class='ta'>&lt;bidder&gt;</span>
<span class='no'>21</span>         <span class='ta'>&lt;userid&gt;</span>U04<span class='ta'>&lt;/userid&gt;</span>
<span class='no'>22</span>         <span class='ta'>&lt;name&gt;</span>Roger Smith<span class='ta'>&lt;/name&gt;</span>
<span class='no'>23</span>         <span class='ta'>&lt;bidcount&gt;</span>5<span class='ta'>&lt;/bidcount&gt;</span>
<span class='no'>24</span>         <span class='ta'>&lt;avgbid&gt;</span>266<span class='ta'>&lt;/avgbid&gt;</span>
<span class='no'>25</span>     <span class='ta'>&lt;/bidder&gt;</span>
<span class='no'>26</span>     <span class='ta'>&lt;bidder&gt;</span>
<span class='no'>27</span>         <span class='ta'>&lt;userid&gt;</span>U05<span class='ta'>&lt;/userid&gt;</span>
<span class='no'>28</span>         <span class='ta'>&lt;name&gt;</span>Jack Sprat<span class='ta'>&lt;/name&gt;</span>
<span class='no'>29</span>         <span class='ta'>&lt;bidcount&gt;</span>2<span class='ta'>&lt;/bidcount&gt;</span>
<span class='no'><strong>30</strong></span>         <span class='ta'>&lt;avgbid&gt;</span>110<span class='ta'>&lt;/avgbid&gt;</span>
<span class='no'>31</span>     <span class='ta'>&lt;/bidder&gt;</span>
<span class='no'>32</span> <span class='ta'>&lt;/result&gt;</span>
</pre></div>
</div></div><div><h3><a name='rdb-q14'>RDB - Q14</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>List item numbers and average bids for items that have
      received three or more bids, in descending order by average bid.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> bids = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>bids.xml</span><span class='dl'>'</span></span>).children(<span class='sy'>:bid_tuple</span>)
<span class='no'> 2</span> 
<span class='no'> 3</span> <span class='co'>XML</span>.result! {
<span class='no'> 4</span>     bids_of_item = <span class='co'>Hash</span>.new([])
<span class='no'> 5</span>     sum_bids_of_item = <span class='co'>Hash</span>.new(<span class='fl'>0.0</span>)
<span class='no'> 6</span>     bids.each{|b|
<span class='no'> 7</span>         i = b[<span class='sy'>:@itemno</span>]
<span class='no'> 8</span>         bids_of_item[i] += [b]
<span class='no'> 9</span>         sum_bids_of_item[i] += b[<span class='sy'>:@bid</span>].to_i
<span class='no'><strong>10</strong></span>     }
<span class='no'>11</span>     bids_of_item.find_all{|i,b| b.size &gt;= <span class='i'>3</span>}.map{|i,b| [sum_bids_of_item[i] / b.size, i, b]}.sort.reverse.each{|a,i,b|
<span class='no'>12</span>         popular_item! {
<span class='no'>13</span>             itemno! i
<span class='no'>14</span> a = a.to_i <span class='r'>if</span> a.to_i == a
<span class='no'>15</span>             avgbid! a
<span class='no'>16</span>         }
<span class='no'>17</span>     
<span class='no'>18</span>     }
<span class='no'>19</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;result&gt;
 {
    for $i in distinct-values(doc("bids.xml")//itemno)
    let $b := doc("bids.xml")//bid_tuple[itemno = $i]
    let $avgbid := avg($b/bid)
    where count($b) &gt;= 3
    order by $avgbid descending
    return
        &lt;popular_item&gt;
            &lt;itemno&gt;{ $i }&lt;/itemno&gt;
            &lt;avgbid&gt;{ $avgbid }&lt;/avgbid&gt;
        &lt;/popular_item&gt;
  }
&lt;/result&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;result&gt;</span>
<span class='no'> 2</span>     <span class='ta'>&lt;popular_item&gt;</span>
<span class='no'> 3</span>         <span class='ta'>&lt;itemno&gt;</span>1002<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'> 4</span>         <span class='ta'>&lt;avgbid&gt;</span>800<span class='ta'>&lt;/avgbid&gt;</span>
<span class='no'> 5</span>     <span class='ta'>&lt;/popular_item&gt;</span>
<span class='no'> 6</span>     <span class='ta'>&lt;popular_item&gt;</span>
<span class='no'> 7</span>         <span class='ta'>&lt;itemno&gt;</span>1007<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'> 8</span>         <span class='ta'>&lt;avgbid&gt;</span>200<span class='ta'>&lt;/avgbid&gt;</span>
<span class='no'> 9</span>     <span class='ta'>&lt;/popular_item&gt;</span>
<span class='no'><strong>10</strong></span>     <span class='ta'>&lt;popular_item&gt;</span>
<span class='no'>11</span>         <span class='ta'>&lt;itemno&gt;</span>1001<span class='ta'>&lt;/itemno&gt;</span>
<span class='no'>12</span>         <span class='ta'>&lt;avgbid&gt;</span>45<span class='ta'>&lt;/avgbid&gt;</span>
<span class='no'>13</span>     <span class='ta'>&lt;/popular_item&gt;</span>
<span class='no'>14</span> <span class='ta'>&lt;/result&gt;</span>
</pre></div>
</div></div><div><h3><a name='rdb-q15'>RDB - Q15</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>List names of users who have placed multiple bids of
      at least $100 each.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> users = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>users.xml</span><span class='dl'>'</span></span>)
<span class='no'> 2</span> bids  = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>bids.xml</span><span class='dl'>'</span></span>)
<span class='no'> 3</span> 
<span class='no'> 4</span> <span class='co'>XML</span>.result! {
<span class='no'> 5</span>     users.each(<span class='co'>XML</span>){|u|
<span class='no'> 6</span>         <span class='r'>next</span> <span class='r'>unless</span> bids.find_all{|b| b.is_a? <span class='co'>XML</span> <span class='r'>and</span> b[<span class='sy'>:@userid</span>] == u[<span class='sy'>:@userid</span>] <span class='r'>and</span> b[<span class='sy'>:@bid</span>].to_i &gt;= <span class='i'>100</span> }.size &gt; <span class='i'>1</span>
<span class='no'> 7</span>         big_spender! u[<span class='sy'>:@name</span>]
<span class='no'> 8</span>     }
<span class='no'> 9</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;result&gt;
  {
    for $u in doc("users.xml")//user_tuple
    let $b := doc("bids.xml")//bid_tuple[userid=$u/userid and bid&gt;=100]
    where count($b) &gt; 1
    return
        &lt;big_spender&gt;{ $u/name/text() }&lt;/big_spender&gt;
  }
&lt;/result&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='ta'>&lt;result&gt;</span>
<span class='no'>2</span>     <span class='ta'>&lt;big_spender&gt;</span>Mary Doe<span class='ta'>&lt;/big_spender&gt;</span>
<span class='no'>3</span>     <span class='ta'>&lt;big_spender&gt;</span>Dee Linquent<span class='ta'>&lt;/big_spender&gt;</span>
<span class='no'>4</span>     <span class='ta'>&lt;big_spender&gt;</span>Roger Smith<span class='ta'>&lt;/big_spender&gt;</span>
<span class='no'>5</span> <span class='ta'>&lt;/result&gt;</span>
</pre></div>
</div></div><div><h3><a name='rdb-q16'>RDB - Q16</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>List all registered users in order by userid; for each user,
      include the userid, name, and an indication of whether the
      user is active (has at least one bid on record) or inactive
      (has no bid on record).
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> users = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>users.xml</span><span class='dl'>'</span></span>).sort_by{|i| i[<span class='sy'>:@userid</span>].to_i}
<span class='no'> 2</span> bids  = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>bids.xml</span><span class='dl'>'</span></span>)
<span class='no'> 3</span> 
<span class='no'> 4</span> <span class='co'>XML</span>.result! {
<span class='no'> 5</span>     users.each(<span class='co'>XML</span>){|u|
<span class='no'> 6</span>         user_bids = bids.children({<span class='sy'>:@userid</span> =&gt; u[<span class='sy'>:@userid</span>]})
<span class='no'> 7</span>         user! {
<span class='no'> 8</span>             add! u.child(<span class='sy'>:userid</span>)
<span class='no'> 9</span>             add! u.child(<span class='sy'>:name</span>)
<span class='no'><strong>10</strong></span>             status! (user_bids.empty? ? <span class='s'><span class='dl'>'</span><span class='k'>inactive</span><span class='dl'>'</span></span> : <span class='s'><span class='dl'>'</span><span class='k'>active</span><span class='dl'>'</span></span>)
<span class='no'>11</span>         }
<span class='no'>12</span>     }
<span class='no'>13</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;result&gt;
  {
    for $u in doc("users.xml")//user_tuple
    let $b := doc("bids.xml")//bid_tuple[userid = $u/userid]
    order by $u/userid
    return
        &lt;user&gt;
            { $u/userid }
            { $u/name }
            {
                if (empty($b))
                  then &lt;status&gt;inactive&lt;/status&gt;
                  else &lt;status&gt;active&lt;/status&gt;
            }
        &lt;/user&gt;
  }
&lt;/result&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> 
<span class='no'> 2</span> 
<span class='no'> 3</span> <span class='ta'>&lt;result&gt;</span>
<span class='no'> 4</span>     <span class='ta'>&lt;user&gt;</span>
<span class='no'> 5</span>         <span class='ta'>&lt;userid&gt;</span>U01<span class='ta'>&lt;/userid&gt;</span>
<span class='no'> 6</span>         <span class='ta'>&lt;name&gt;</span>Tom Jones<span class='ta'>&lt;/name&gt;</span>
<span class='no'> 7</span>         <span class='ta'>&lt;status&gt;</span>active<span class='ta'>&lt;/status&gt;</span>
<span class='no'> 8</span>     <span class='ta'>&lt;/user&gt;</span>
<span class='no'> 9</span>     <span class='ta'>&lt;user&gt;</span>
<span class='no'><strong>10</strong></span>         <span class='ta'>&lt;userid&gt;</span>U02<span class='ta'>&lt;/userid&gt;</span>
<span class='no'>11</span>         <span class='ta'>&lt;name&gt;</span>Mary Doe<span class='ta'>&lt;/name&gt;</span>
<span class='no'>12</span>         <span class='ta'>&lt;status&gt;</span>active<span class='ta'>&lt;/status&gt;</span>
<span class='no'>13</span>     <span class='ta'>&lt;/user&gt;</span>
<span class='no'>14</span>     <span class='ta'>&lt;user&gt;</span>
<span class='no'>15</span>         <span class='ta'>&lt;userid&gt;</span>U03<span class='ta'>&lt;/userid&gt;</span>
<span class='no'>16</span>         <span class='ta'>&lt;name&gt;</span>Dee Linquent<span class='ta'>&lt;/name&gt;</span>
<span class='no'>17</span>         <span class='ta'>&lt;status&gt;</span>active<span class='ta'>&lt;/status&gt;</span>
<span class='no'>18</span>     <span class='ta'>&lt;/user&gt;</span>
<span class='no'>19</span>     <span class='ta'>&lt;user&gt;</span>
<span class='no'><strong>20</strong></span>         <span class='ta'>&lt;userid&gt;</span>U04<span class='ta'>&lt;/userid&gt;</span>
<span class='no'>21</span>         <span class='ta'>&lt;name&gt;</span>Roger Smith<span class='ta'>&lt;/name&gt;</span>
<span class='no'>22</span>         <span class='ta'>&lt;status&gt;</span>active<span class='ta'>&lt;/status&gt;</span>
<span class='no'>23</span>     <span class='ta'>&lt;/user&gt;</span>
<span class='no'>24</span>     <span class='ta'>&lt;user&gt;</span>
<span class='no'>25</span>         <span class='ta'>&lt;userid&gt;</span>U05<span class='ta'>&lt;/userid&gt;</span>
<span class='no'>26</span>         <span class='ta'>&lt;name&gt;</span>Jack Sprat<span class='ta'>&lt;/name&gt;</span>
<span class='no'>27</span>         <span class='ta'>&lt;status&gt;</span>active<span class='ta'>&lt;/status&gt;</span>
<span class='no'>28</span>     <span class='ta'>&lt;/user&gt;</span>
<span class='no'>29</span>     <span class='ta'>&lt;user&gt;</span>
<span class='no'><strong>30</strong></span>         <span class='ta'>&lt;userid&gt;</span>U06<span class='ta'>&lt;/userid&gt;</span>
<span class='no'>31</span>         <span class='ta'>&lt;name&gt;</span>Rip Van Winkle<span class='ta'>&lt;/name&gt;</span>
<span class='no'>32</span>         <span class='ta'>&lt;status&gt;</span>inactive<span class='ta'>&lt;/status&gt;</span>
<span class='no'>33</span>     <span class='ta'>&lt;/user&gt;</span>
<span class='no'>34</span> <span class='ta'>&lt;/result&gt;</span>
<span class='no'>35</span> 
</pre></div>
</div></div><div><h3><a name='rdb-q17'>RDB - Q17</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>List the names of users, if any, who have bid on every item.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> users = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>users.xml</span><span class='dl'>'</span></span>)
<span class='no'> 2</span> items = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>items.xml</span><span class='dl'>'</span></span>)
<span class='no'> 3</span> bids  = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>bids.xml</span><span class='dl'>'</span></span>)
<span class='no'> 4</span> 
<span class='no'> 5</span> <span class='co'>XML</span>.frequent_bidder! {
<span class='no'> 6</span>     users.each(<span class='co'>XML</span>){|u|
<span class='no'> 7</span>         <span class='r'>next</span> <span class='r'>unless</span> items.all?{|item|
<span class='no'> 8</span>             (!item.is_a? <span class='co'>XML</span>) <span class='r'>or</span>
<span class='no'> 9</span>             bids.any?{|b| b.is_a? <span class='co'>XML</span> <span class='r'>and</span> item[<span class='sy'>:@itemno</span>] == b[<span class='sy'>:@itemno</span>] <span class='r'>and</span> u[<span class='sy'>:@userid</span>] == b[<span class='sy'>:@userid</span>]}
<span class='no'><strong>10</strong></span>         }
<span class='no'>11</span>         add! u.child(<span class='sy'>:name</span>)
<span class='no'>12</span>     }
<span class='no'>13</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;frequent_bidder&gt;
  {
    for $u in doc("users.xml")//user_tuple
    where 
      every $item in doc("items.xml")//item_tuple satisfies 
        some $b in doc("bids.xml")//bid_tuple satisfies 
          ($item/itemno = $b/itemno and $u/userid = $b/userid)
    return
        $u/name
  }
&lt;/frequent_bidder&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='ta'>&lt;frequent_bidder</span> <span class='ta'>/&gt;</span>
</pre></div>
</div></div><div><h3><a name='rdb-q18'>RDB - Q18</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>List all users in alphabetic order by name. For each user,
      include descriptions of all the items (if any) that were
      bid on by that user, in alphabetic order.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> users = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>users.xml</span><span class='dl'>'</span></span>).children(<span class='sy'>:user_tuple</span>).sort_by{|i| i[<span class='sy'>:@name</span>]}
<span class='no'> 2</span> items = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>items.xml</span><span class='dl'>'</span></span>)
<span class='no'> 3</span> bids  = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>bids.xml</span><span class='dl'>'</span></span>)
<span class='no'> 4</span> 
<span class='no'> 5</span> <span class='co'>XML</span>.result! {
<span class='no'> 6</span>     users.each{|u|
<span class='no'> 7</span>         user! {
<span class='no'> 8</span>             add! u.child(<span class='sy'>:name</span>)
<span class='no'> 9</span>             bids.find_all{|b|
<span class='no'><strong>10</strong></span>                 b.is_a? <span class='co'>XML</span> <span class='r'>and</span> b[<span class='sy'>:@userid</span>] == u[<span class='sy'>:@userid</span>]
<span class='no'>11</span>             }.map{|b| b[<span class='sy'>:@itemno</span>]}.uniq.map{|b|
<span class='no'>12</span>                 items.find{|i| i.is_a? <span class='co'>XML</span> <span class='r'>and</span> i[<span class='sy'>:@itemno</span>] == b}[<span class='sy'>:@description</span>]
<span class='no'>13</span>             }.sort.each{|dsc|
<span class='no'>14</span>                 bid_on_item! dsc
<span class='no'>15</span>             }
<span class='no'>16</span>         }
<span class='no'>17</span>     }
<span class='no'>18</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;result&gt;
  {
    for $u in doc("users.xml")//user_tuple
    order by $u/name
    return
        &lt;user&gt;
            { $u/name }
            {
                for $b in distinct-values(doc("bids.xml")//bid_tuple
                                             [userid = $u/userid]/itemno)
                for $i in doc("items.xml")//item_tuple[itemno = $b]
                let $descr := $i/description/text()
                order by $descr
                return
                    &lt;bid_on_item&gt;{ $descr }&lt;/bid_on_item&gt;
            }
        &lt;/user&gt;
  }
&lt;/result&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;result&gt;</span>
<span class='no'> 2</span>     <span class='ta'>&lt;user&gt;</span>
<span class='no'> 3</span>         <span class='ta'>&lt;name&gt;</span>Dee Linquent<span class='ta'>&lt;/name&gt;</span>
<span class='no'> 4</span>         <span class='ta'>&lt;bid_on_item&gt;</span>Motorcycle<span class='ta'>&lt;/bid_on_item&gt;</span>
<span class='no'> 5</span>         <span class='ta'>&lt;bid_on_item&gt;</span>Racing Bicycle<span class='ta'>&lt;/bid_on_item&gt;</span>
<span class='no'> 6</span>     <span class='ta'>&lt;/user&gt;</span>
<span class='no'> 7</span>     <span class='ta'>&lt;user&gt;</span>
<span class='no'> 8</span>         <span class='ta'>&lt;name&gt;</span>Jack Sprat<span class='ta'>&lt;/name&gt;</span>
<span class='no'> 9</span>         <span class='ta'>&lt;bid_on_item&gt;</span>Old Bicycle<span class='ta'>&lt;/bid_on_item&gt;</span>
<span class='no'><strong>10</strong></span>         <span class='ta'>&lt;bid_on_item&gt;</span>Racing Bicycle<span class='ta'>&lt;/bid_on_item&gt;</span>
<span class='no'>11</span>     <span class='ta'>&lt;/user&gt;</span>
<span class='no'>12</span>     <span class='ta'>&lt;user&gt;</span>
<span class='no'>13</span>         <span class='ta'>&lt;name&gt;</span>Mary Doe<span class='ta'>&lt;/name&gt;</span>
<span class='no'>14</span>         <span class='ta'>&lt;bid_on_item&gt;</span>Motorcycle<span class='ta'>&lt;/bid_on_item&gt;</span>
<span class='no'>15</span>         <span class='ta'>&lt;bid_on_item&gt;</span>Red Bicycle<span class='ta'>&lt;/bid_on_item&gt;</span>
<span class='no'>16</span>     <span class='ta'>&lt;/user&gt;</span>
<span class='no'>17</span>     <span class='ta'>&lt;user&gt;</span>
<span class='no'>18</span>         <span class='ta'>&lt;name&gt;</span>Rip Van Winkle<span class='ta'>&lt;/name&gt;</span>
<span class='no'>19</span>     <span class='ta'>&lt;/user&gt;</span>
<span class='no'><strong>20</strong></span>     <span class='ta'>&lt;user&gt;</span>
<span class='no'>21</span>         <span class='ta'>&lt;name&gt;</span>Roger Smith<span class='ta'>&lt;/name&gt;</span>
<span class='no'>22</span>         <span class='ta'>&lt;bid_on_item&gt;</span>Motorcycle<span class='ta'>&lt;/bid_on_item&gt;</span>
<span class='no'>23</span>         <span class='ta'>&lt;bid_on_item&gt;</span>Old Bicycle<span class='ta'>&lt;/bid_on_item&gt;</span>
<span class='no'>24</span>         <span class='ta'>&lt;bid_on_item&gt;</span>Racing Bicycle<span class='ta'>&lt;/bid_on_item&gt;</span>
<span class='no'>25</span>         <span class='ta'>&lt;bid_on_item&gt;</span>Red Bicycle<span class='ta'>&lt;/bid_on_item&gt;</span>
<span class='no'>26</span>     <span class='ta'>&lt;/user&gt;</span>
<span class='no'>27</span>     <span class='ta'>&lt;user&gt;</span>
<span class='no'>28</span>         <span class='ta'>&lt;name&gt;</span>Tom Jones<span class='ta'>&lt;/name&gt;</span>
<span class='no'>29</span>         <span class='ta'>&lt;bid_on_item&gt;</span>Motorcycle<span class='ta'>&lt;/bid_on_item&gt;</span>
<span class='no'><strong>30</strong></span>         <span class='ta'>&lt;bid_on_item&gt;</span>Tricycle<span class='ta'>&lt;/bid_on_item&gt;</span>
<span class='no'>31</span>     <span class='ta'>&lt;/user&gt;</span>
<span class='no'>32</span> <span class='ta'>&lt;/result&gt;</span>
</pre></div>
</div></div><div><h3><a name='seq-report1.xml'>Input for SEQ - report1.xml</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;report&gt;</span>
<span class='no'> 2</span>   <span class='ta'>&lt;section&gt;</span>
<span class='no'> 3</span>     <span class='ta'>&lt;section.title&gt;</span>Procedure<span class='ta'>&lt;/section.title&gt;</span>
<span class='no'> 4</span>      <span class='ta'>&lt;section.content&gt;</span>
<span class='no'> 5</span>       The patient was taken to the operating room where she was placed
<span class='no'> 6</span>       in supine position and
<span class='no'> 7</span>       <span class='ta'>&lt;anesthesia&gt;</span>induced under general anesthesia.<span class='ta'>&lt;/anesthesia&gt;</span>
<span class='no'> 8</span>       <span class='ta'>&lt;prep&gt;</span> 
<span class='no'> 9</span>         <span class='ta'>&lt;action&gt;</span>A Foley catheter was placed to decompress the bladder<span class='ta'>&lt;/action&gt;</span>
<span class='no'><strong>10</strong></span>         and the abdomen was then prepped and draped in sterile fashion.
<span class='no'>11</span>       <span class='ta'>&lt;/prep&gt;</span>  
<span class='no'>12</span>       <span class='ta'>&lt;incision&gt;</span>
<span class='no'>13</span>         A curvilinear incision was made
<span class='no'>14</span>         <span class='ta'>&lt;geography&gt;</span>in the midline immediately infraumbilical<span class='ta'>&lt;/geography&gt;</span>
<span class='no'>15</span>         and the subcutaneous tissue was divided
<span class='no'>16</span>         <span class='ta'>&lt;instrument&gt;</span>using electrocautery.<span class='ta'>&lt;/instrument&gt;</span>
<span class='no'>17</span>       <span class='ta'>&lt;/incision&gt;</span>
<span class='no'>18</span>       The fascia was identified and
<span class='no'>19</span>       <span class='ta'>&lt;action&gt;</span>#2 0 Maxon stay sutures were placed on each side of the midline.
<span class='no'><strong>20</strong></span>       <span class='ta'>&lt;/action&gt;</span>
<span class='no'>21</span>       <span class='ta'>&lt;incision&gt;</span>
<span class='no'>22</span>         The fascia was divided using
<span class='no'>23</span>         <span class='ta'>&lt;instrument&gt;</span>electrocautery<span class='ta'>&lt;/instrument&gt;</span>
<span class='no'>24</span>         and the peritoneum was entered.
<span class='no'>25</span>       <span class='ta'>&lt;/incision&gt;</span>
<span class='no'>26</span>       <span class='ta'>&lt;observation&gt;</span>The small bowel was identified.<span class='ta'>&lt;/observation&gt;</span>
<span class='no'>27</span>       and
<span class='no'>28</span>       <span class='ta'>&lt;action&gt;</span>
<span class='no'>29</span>         the
<span class='no'><strong>30</strong></span>         <span class='ta'>&lt;instrument&gt;</span>Hasson trocar<span class='ta'>&lt;/instrument&gt;</span>
<span class='no'>31</span>         was placed under direct visualization.
<span class='no'>32</span>       <span class='ta'>&lt;/action&gt;</span>
<span class='no'>33</span>       <span class='ta'>&lt;action&gt;</span>
<span class='no'>34</span>         The
<span class='no'>35</span>         <span class='ta'>&lt;instrument&gt;</span>trocar<span class='ta'>&lt;/instrument&gt;</span>
<span class='no'>36</span>         was secured to the fascia using the stay sutures.
<span class='no'>37</span>       <span class='ta'>&lt;/action&gt;</span>
<span class='no'>38</span>      <span class='ta'>&lt;/section.content&gt;</span>
<span class='no'>39</span>   <span class='ta'>&lt;/section&gt;</span>
<span class='no'><strong>40</strong></span> <span class='ta'>&lt;/report&gt;</span>
</pre></div>
</div></div><div><h3><a name='seq-q1'>SEQ - Q1</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>In the Procedure section of Report1, what Instruments were used in the second Incision?
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>report1.xml</span><span class='dl'>'</span></span>).descendants(<span class='sy'>:section</span>) {|s|
<span class='no'>2</span>     print s.descendants(<span class='sy'>:incision</span>)[<span class='i'>1</span>].child(<span class='sy'>:instrument</span>) <span class='r'>if</span> s[<span class='sy'><span class='sy'>:</span><span class='dl'>"</span><span class='k'>@section.title</span><span class='dl'>"</span></span>] == <span class='s'><span class='dl'>"</span><span class='k'>Procedure</span><span class='dl'>"</span></span>
<span class='no'>3</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>for $s in doc("report1.xml")//section[section.title = "Procedure"]
return ($s//incision)[2]/instrument
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='ta'>&lt;instrument&gt;</span>electrocautery<span class='ta'>&lt;/instrument&gt;</span>
</pre></div>
</div></div><div><h3><a name='seq-q2'>SEQ - Q2</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>In the Procedure section of Report1, what are the first two Instruments to be used?
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>report1.xml</span><span class='dl'>'</span></span>).descendants(<span class='sy'>:section</span>) {|s|
<span class='no'>2</span>     print s.descendants(<span class='sy'>:instrument</span>)[<span class='i'>0</span>,<span class='i'>2</span>] <span class='r'>if</span> s[<span class='sy'><span class='sy'>:</span><span class='dl'>"</span><span class='k'>@section.title</span><span class='dl'>"</span></span>] == <span class='s'><span class='dl'>"</span><span class='k'>Procedure</span><span class='dl'>"</span></span>
<span class='no'>3</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>for $s in doc("report1.xml")//section[section.title = "Procedure"]
return ($s//instrument)[position()&lt;=2]
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='ta'>&lt;instrument&gt;</span>using electrocautery.<span class='ta'>&lt;/instrument&gt;</span>
<span class='no'>2</span> <span class='ta'>&lt;instrument&gt;</span>electrocautery<span class='ta'>&lt;/instrument&gt;</span>
</pre></div>
</div></div><div><h3><a name='seq-q3'>SEQ - Q3</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>In Report1, what Instruments were used in the first two Actions after the second Incision?
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> doc = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>report1.xml</span><span class='dl'>'</span></span>)
<span class='no'>2</span> i2 = doc.descendants(<span class='sy'>:incision</span>)[<span class='i'>1</span>]
<span class='no'>3</span> 
<span class='no'>4</span> print doc.range(i2,<span class='pc'>nil</span>).descendants(<span class='sy'>:action</span>)[<span class='i'>0</span>,<span class='i'>2</span>].children(<span class='sy'>:instrument</span>)
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>let $i2 := (doc("report1.xml")//incision)[2]
for $a in (doc("report1.xml")//action)[. &gt;&gt; $i2][position()&lt;=2]
return $a//instrument
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='ta'>&lt;instrument&gt;</span>Hasson trocar<span class='ta'>&lt;/instrument&gt;</span>
<span class='no'>2</span> <span class='ta'>&lt;instrument&gt;</span>trocar<span class='ta'>&lt;/instrument&gt;</span>
</pre></div>
</div></div><div><h3><a name='seq-q4'>SEQ - Q4</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>In Report1, find "Procedure" sections where no Anesthesia element occurs before the first Incision
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>report1.xml</span><span class='dl'>'</span></span>).descendants(<span class='sy'>:section</span>) {|p|
<span class='no'>2</span>     <span class='r'>next</span> <span class='r'>unless</span> p[<span class='sy'><span class='sy'>:</span><span class='dl'>"</span><span class='k'>@section.title</span><span class='dl'>"</span></span>] == <span class='s'><span class='dl'>"</span><span class='k'>Procedure</span><span class='dl'>"</span></span>
<span class='no'>3</span>     i1 = p.descendants(<span class='sy'>:incision</span>)[<span class='i'>0</span>]
<span class='no'>4</span>     print p <span class='r'>if</span> p.range(<span class='pc'>nil</span>,i1).descendants(<span class='sy'>:anesthesia</span>).size == <span class='i'>0</span>
<span class='no'>5</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>for $p in doc("report1.xml")//section[section.title = "Procedure"]
where not(some $a in $p//anesthesia satisfies
        $a &lt;&lt; ($p//incision)[1] )
return $p
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> </pre></div>
</div></div><div><h3><a name='seq-q5'>SEQ - Q5</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>In Report1, what happened between the first Incision and the second Incision?
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='co'>XML</span>.critical_sequence! {
<span class='no'>2</span>    p = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>report1.xml</span><span class='dl'>'</span></span>).descendants(<span class='sy'>:section</span>).find {|p| p[<span class='sy'><span class='sy'>:</span><span class='dl'>"</span><span class='k'>@section.title</span><span class='dl'>"</span></span>] == <span class='s'><span class='dl'>"</span><span class='k'>Procedure</span><span class='dl'>"</span></span>}
<span class='no'>3</span>    i1,i2, = *p.descendants(<span class='sy'>:incision</span>)
<span class='no'>4</span> add! p.subsequence(i1,i2).map{|p| [p] + [p].descendants}
<span class='no'>5</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;critical_sequence&gt;
 {
  let $proc := doc("report1.xml")//section[section.title="Procedure"][1],
      $i1 :=  ($proc//incision)[1],
      $i2 :=  ($proc//incision)[2]
  for $n in $proc//node() except $i1//node()
  where $n &gt;&gt; $i1 and $n &lt;&lt; $i2
  return $n 
 }
&lt;/critical_sequence&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='ta'>&lt;critical_sequence&gt;</span>
<span class='no'>2</span>       The fascia was identified and
<span class='no'>3</span>       <span class='ta'>&lt;action&gt;</span>#2 0 Maxon stay sutures were placed on each side of the midline.
<span class='no'>4</span>       <span class='ta'>&lt;/action&gt;</span>#2 0 Maxon stay sutures were placed on each side of the midline.
<span class='no'>5</span> <span class='ta'>&lt;/critical_sequence&gt;</span>
</pre></div>
</div></div><div><h3><a name='sgml-sgml.xml'>Input for SGML - sgml.xml</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><div class='CodeRay'>
  <div class='code'><pre><span class='no'>  1</span> <span class='pp'>&lt;!DOCTYPE report SYSTEM "report.dtd"&gt;</span>
<span class='no'>  2</span> <span class='ta'>&lt;report&gt;</span>
<span class='no'>  3</span> <span class='ta'>&lt;title&gt;</span>Getting started with SGML<span class='ta'>&lt;/title&gt;</span>
<span class='no'>  4</span> <span class='ta'>&lt;chapter&gt;</span>
<span class='no'>  5</span> <span class='ta'>&lt;title&gt;</span>The business challenge<span class='ta'>&lt;/title&gt;</span>
<span class='no'>  6</span> <span class='ta'>&lt;intro&gt;</span>
<span class='no'>  7</span> <span class='ta'>&lt;para&gt;</span>With the ever-changing and growing global market, companies and
<span class='no'>  8</span> large organizations are searching for ways to become more viable and
<span class='no'>  9</span> competitive. Downsizing and other cost-cutting measures demand more
<span class='no'> <strong>10</strong></span> efficient use of corporate resources. One very important resource is
<span class='no'> 11</span> an organization's information.<span class='ta'>&lt;/para&gt;</span>
<span class='no'> 12</span> <span class='ta'>&lt;para&gt;</span>As part of the move toward integrated information management,
<span class='no'> 13</span> whole industries are developing and implementing standards for
<span class='no'> 14</span> exchanging technical information. This report describes how one such
<span class='no'> 15</span> standard, the Standard Generalized Markup Language (SGML), works as
<span class='no'> 16</span> part of an overall information management strategy.<span class='ta'>&lt;/para&gt;</span>
<span class='no'> 17</span> <span class='ta'>&lt;graphic</span> <span class='an'>graphname</span>=<span class='s'><span class='dl'>"</span><span class='k'>infoflow</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span><span class='ta'>&lt;/intro&gt;</span><span class='ta'>&lt;/chapter&gt;</span>
<span class='no'> 18</span> <span class='ta'>&lt;chapter&gt;</span>
<span class='no'> 19</span> <span class='ta'>&lt;title&gt;</span>Getting to know SGML<span class='ta'>&lt;/title&gt;</span>
<span class='no'> <strong>20</strong></span> <span class='ta'>&lt;intro&gt;</span>
<span class='no'> 21</span> <span class='ta'>&lt;para&gt;</span>While SGML is a fairly recent technology, the use of
<span class='no'> 22</span> <span class='ta'>&lt;emph&gt;</span>markup<span class='ta'>&lt;/emph&gt;</span> in computer-generated documents has existed for a
<span class='no'> 23</span> while.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;/intro&gt;</span>
<span class='no'> 24</span> <span class='ta'>&lt;section</span> <span class='an'>shorttitle</span>=<span class='s'><span class='dl'>"</span><span class='k'>What is markup?</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'> 25</span> <span class='ta'>&lt;title&gt;</span>What is markup, or everything you always wanted to know about
<span class='no'> 26</span> document preparation but were afraid to ask?<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 27</span> <span class='ta'>&lt;intro&gt;</span>
<span class='no'> 28</span> <span class='ta'>&lt;para&gt;</span>Markup is everything in a document that is not content. The
<span class='no'> 29</span> traditional meaning of markup is the manual <span class='ta'>&lt;emph&gt;</span>marking<span class='ta'>&lt;/emph&gt;</span> up
<span class='no'> <strong>30</strong></span> of typewritten text to give instructions for a typesetter or
<span class='no'> 31</span> compositor about how to fit the text on a page and what typefaces to
<span class='no'> 32</span> use. This kind of markup is known as <span class='ta'>&lt;emph&gt;</span>procedural markup<span class='ta'>&lt;/emph&gt;</span>.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;/intro&gt;</span>
<span class='no'> 33</span> <span class='ta'>&lt;topic</span> <span class='an'>topicid</span>=<span class='s'><span class='dl'>"</span><span class='k'>top1</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'> 34</span> <span class='ta'>&lt;title&gt;</span>Procedural markup<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 35</span> <span class='ta'>&lt;para&gt;</span>Most electronic publishing systems today use some form of
<span class='no'> 36</span> procedural markup. Procedural markup codes are good for one
<span class='no'> 37</span> presentation of the information.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;/topic&gt;</span>
<span class='no'> 38</span> <span class='ta'>&lt;topic</span> <span class='an'>topicid</span>=<span class='s'><span class='dl'>"</span><span class='k'>top2</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'> 39</span> <span class='ta'>&lt;title&gt;</span>Generic markup<span class='ta'>&lt;/title&gt;</span>
<span class='no'> <strong>40</strong></span> <span class='ta'>&lt;para&gt;</span>Generic markup (also known as descriptive markup) describes the
<span class='no'> 41</span> <span class='ta'>&lt;emph&gt;</span>purpose<span class='ta'>&lt;/emph&gt;</span> of the text in a document. A basic concept of
<span class='no'> 42</span> generic markup is that the content of a document must be separate from
<span class='no'> 43</span> the style. Generic markup allows for multiple presentations of the
<span class='no'> 44</span> information.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;/topic&gt;</span>
<span class='no'> 45</span> <span class='ta'>&lt;topic</span> <span class='an'>topicid</span>=<span class='s'><span class='dl'>"</span><span class='k'>top3</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'> 46</span> <span class='ta'>&lt;title&gt;</span>Drawbacks of procedural markup<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 47</span> <span class='ta'>&lt;para&gt;</span>Industries involved in technical documentation increasingly
<span class='no'> 48</span> prefer generic over procedural markup schemes. When a company changes
<span class='no'> 49</span> software or hardware systems, enormous data translation tasks arise,
<span class='no'> <strong>50</strong></span> often resulting in errors.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;/topic&gt;</span><span class='ta'>&lt;/section&gt;</span>
<span class='no'> 51</span> <span class='ta'>&lt;section</span> <span class='an'>shorttitle</span>=<span class='s'><span class='dl'>"</span><span class='k'>What is SGML?</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'> 52</span> <span class='ta'>&lt;title&gt;</span>What <span class='ta'>&lt;emph&gt;</span>is<span class='ta'>&lt;/emph&gt;</span> SGML in the grand scheme of the universe, anyway?<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 53</span> <span class='ta'>&lt;intro&gt;</span>
<span class='no'> 54</span> <span class='ta'>&lt;para&gt;</span>SGML defines a strict markup scheme with a syntax for defining
<span class='no'> 55</span> document data elements and an overall framework for marking up
<span class='no'> 56</span> documents.<span class='ta'>&lt;/para&gt;</span>
<span class='no'> 57</span> <span class='ta'>&lt;para&gt;</span>SGML can describe and create documents that are not dependent on
<span class='no'> 58</span> any hardware, software, formatter, or operating system. Since SGML documents
<span class='no'> 59</span> conform to an international standard, they are portable.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;/intro&gt;</span><span class='ta'>&lt;/section&gt;</span>
<span class='no'> <strong>60</strong></span> <span class='ta'>&lt;section</span> <span class='an'>shorttitle</span>=<span class='s'><span class='dl'>"</span><span class='k'>How does SGML work?</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'> 61</span> <span class='ta'>&lt;title&gt;</span>How is SGML and would you recommend it to your grandmother?<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 62</span> <span class='ta'>&lt;intro&gt;</span>
<span class='no'> 63</span> <span class='ta'>&lt;para&gt;</span>You can break a typical document into three layers: structure,
<span class='no'> 64</span> content, and style. SGML works by separating these three aspects and
<span class='no'> 65</span> deals mainly with the relationship between structure and content.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;/intro&gt;</span>
<span class='no'> 66</span> <span class='ta'>&lt;topic</span> <span class='an'>topicid</span>=<span class='s'><span class='dl'>"</span><span class='k'>top4</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'> 67</span> <span class='ta'>&lt;title&gt;</span>Structure<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 68</span> <span class='ta'>&lt;para&gt;</span>At the heart of an SGML application is a file called the DTD, or
<span class='no'> 69</span> Document Type Definition. The DTD sets up the structure of a document,
<span class='no'> <strong>70</strong></span> much like a database schema describes the types of information it
<span class='no'> 71</span> handles.<span class='ta'>&lt;/para&gt;</span>
<span class='no'> 72</span> <span class='ta'>&lt;para&gt;</span>A database schema also defines the relationships between the
<span class='no'> 73</span> various types of data. Similarly, a DTD specifies <span class='ta'>&lt;emph&gt;</span>rules<span class='ta'>&lt;/emph&gt;</span>
<span class='no'> 74</span> to help ensure documents have a consistent, logical structure.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;/topic&gt;</span>
<span class='no'> 75</span> <span class='ta'>&lt;topic</span> <span class='an'>topicid</span>=<span class='s'><span class='dl'>"</span><span class='k'>top5</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'> 76</span> <span class='ta'>&lt;title&gt;</span>Content<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 77</span> <span class='ta'>&lt;para&gt;</span>Content is the information itself. The method for identifying
<span class='no'> 78</span> the information and its meaning within this framework is called
<span class='no'> 79</span> <span class='ta'>&lt;emph&gt;</span>tagging<span class='ta'>&lt;/emph&gt;</span>. Tagging must
<span class='no'> <strong>80</strong></span> conform to the rules established in the DTD (see <span class='ta'>&lt;xref</span> <span class='an'>xrefid</span>=<span class='s'><span class='dl'>"</span><span class='k'>top4</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>).<span class='ta'>&lt;/para&gt;</span>
<span class='no'> 81</span> <span class='ta'>&lt;graphic</span> <span class='an'>graphname</span>=<span class='s'><span class='dl'>"</span><span class='k'>tagexamp</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span><span class='ta'>&lt;/topic&gt;</span>
<span class='no'> 82</span> <span class='ta'>&lt;topic</span> <span class='an'>topicid</span>=<span class='s'><span class='dl'>"</span><span class='k'>top6</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'> 83</span> <span class='ta'>&lt;title&gt;</span>Style<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 84</span> <span class='ta'>&lt;para&gt;</span>SGML does not standardize style or other processing methods for
<span class='no'> 85</span> information stored in SGML.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;/topic&gt;</span><span class='ta'>&lt;/section&gt;</span><span class='ta'>&lt;/chapter&gt;</span>
<span class='no'> 86</span> <span class='ta'>&lt;chapter&gt;</span>
<span class='no'> 87</span> <span class='ta'>&lt;title&gt;</span>Resources<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 88</span> <span class='ta'>&lt;section&gt;</span>
<span class='no'> 89</span> <span class='ta'>&lt;title&gt;</span>Conferences, tutorials, and training<span class='ta'>&lt;/title&gt;</span>
<span class='no'> <strong>90</strong></span> <span class='ta'>&lt;intro&gt;</span>
<span class='no'> 91</span> <span class='ta'>&lt;para&gt;</span>The Graphic Communications Association has been
<span class='no'> 92</span> instrumental in the development of SGML. GCA provides conferences,
<span class='no'> 93</span> tutorials, newsletters, and publication sales for both members and
<span class='no'> 94</span> non-members.<span class='ta'>&lt;/para&gt;</span>
<span class='no'> 95</span> <span class='ta'>&lt;para</span> <span class='an'>security</span>=<span class='s'><span class='dl'>"</span><span class='k'>c</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>Exiled members of the former Soviet Union's secret
<span class='no'> 96</span> police, the KGB, have infiltrated the upper ranks of the GCA and are
<span class='no'> 97</span> planning the Final Revolution as soon as DSSSL is completed.<span class='ta'>&lt;/para&gt;</span>
<span class='no'> 98</span> <span class='ta'>&lt;/intro&gt;</span>
<span class='no'> 99</span> <span class='ta'>&lt;/section&gt;</span>
<span class='no'><strong>100</strong></span> <span class='ta'>&lt;/chapter&gt;</span>
<span class='no'>101</span> <span class='ta'>&lt;/report&gt;</span>
</pre></div>
</div></div><div><h3><a name='sgml-q1'>SGML - Q1</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>Locate all paragraphs in the report (all "para"
     elements occurring anywhere within the "report" element).
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='co'>XML</span>.result!(<span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>sgml.xml</span><span class='dl'>'</span></span>).descendants(<span class='sy'>:para</span>))
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;result&gt;
  { 
    doc("sgml.xml")//report//para 
  }
&lt;/result&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;result&gt;</span><span class='ta'>&lt;para&gt;</span>With the ever-changing and growing global market, companies and
<span class='no'> 2</span> large organizations are searching for ways to become more viable and
<span class='no'> 3</span> competitive. Downsizing and other cost-cutting measures demand more
<span class='no'> 4</span> efficient use of corporate resources. One very important resource is
<span class='no'> 5</span> an organization's information.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;para&gt;</span>As part of the move toward integrated information management,
<span class='no'> 6</span> whole industries are developing and implementing standards for
<span class='no'> 7</span> exchanging technical information. This report describes how one such
<span class='no'> 8</span> standard, the Standard Generalized Markup Language (SGML), works as
<span class='no'> 9</span> part of an overall information management strategy.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;para&gt;</span>While SGML is a fairly recent technology, the use of
<span class='no'><strong>10</strong></span> <span class='ta'>&lt;emph&gt;</span>markup<span class='ta'>&lt;/emph&gt;</span> in computer-generated documents has existed for a
<span class='no'>11</span> while.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;para&gt;</span>Markup is everything in a document that is not content. The
<span class='no'>12</span> traditional meaning of markup is the manual <span class='ta'>&lt;emph&gt;</span>marking<span class='ta'>&lt;/emph&gt;</span> up
<span class='no'>13</span> of typewritten text to give instructions for a typesetter or
<span class='no'>14</span> compositor about how to fit the text on a page and what typefaces to
<span class='no'>15</span> use. This kind of markup is known as <span class='ta'>&lt;emph&gt;</span>procedural markup<span class='ta'>&lt;/emph&gt;</span>.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;para&gt;</span>Most electronic publishing systems today use some form of
<span class='no'>16</span> procedural markup. Procedural markup codes are good for one
<span class='no'>17</span> presentation of the information.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;para&gt;</span>Generic markup (also known as descriptive markup) describes the
<span class='no'>18</span> <span class='ta'>&lt;emph&gt;</span>purpose<span class='ta'>&lt;/emph&gt;</span> of the text in a document. A basic concept of
<span class='no'>19</span> generic markup is that the content of a document must be separate from
<span class='no'><strong>20</strong></span> the style. Generic markup allows for multiple presentations of the
<span class='no'>21</span> information.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;para&gt;</span>Industries involved in technical documentation increasingly
<span class='no'>22</span> prefer generic over procedural markup schemes. When a company changes
<span class='no'>23</span> software or hardware systems, enormous data translation tasks arise,
<span class='no'>24</span> often resulting in errors.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;para&gt;</span>SGML defines a strict markup scheme with a syntax for defining
<span class='no'>25</span> document data elements and an overall framework for marking up
<span class='no'>26</span> documents.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;para&gt;</span>SGML can describe and create documents that are not dependent on
<span class='no'>27</span> any hardware, software, formatter, or operating system. Since SGML documents
<span class='no'>28</span> conform to an international standard, they are portable.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;para&gt;</span>You can break a typical document into three layers: structure,
<span class='no'>29</span> content, and style. SGML works by separating these three aspects and
<span class='no'><strong>30</strong></span> deals mainly with the relationship between structure and content.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;para&gt;</span>At the heart of an SGML application is a file called the DTD, or
<span class='no'>31</span> Document Type Definition. The DTD sets up the structure of a document,
<span class='no'>32</span> much like a database schema describes the types of information it
<span class='no'>33</span> handles.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;para&gt;</span>A database schema also defines the relationships between the
<span class='no'>34</span> various types of data. Similarly, a DTD specifies <span class='ta'>&lt;emph&gt;</span>rules<span class='ta'>&lt;/emph&gt;</span>
<span class='no'>35</span> to help ensure documents have a consistent, logical structure.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;para&gt;</span>Content is the information itself. The method for identifying
<span class='no'>36</span> the information and its meaning within this framework is called
<span class='no'>37</span> <span class='ta'>&lt;emph&gt;</span>tagging<span class='ta'>&lt;/emph&gt;</span>. Tagging must
<span class='no'>38</span> conform to the rules established in the DTD (see <span class='ta'>&lt;xref</span> <span class='an'>xrefid</span>=<span class='s'><span class='dl'>'</span><span class='k'>top4</span><span class='dl'>'</span></span><span class='ta'>/&gt;</span>).<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;para&gt;</span>SGML does not standardize style or other processing methods for
<span class='no'>39</span> information stored in SGML.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;para&gt;</span>The Graphic Communications Association has been
<span class='no'><strong>40</strong></span> instrumental in the development of SGML. GCA provides conferences,
<span class='no'>41</span> tutorials, newsletters, and publication sales for both members and
<span class='no'>42</span> non-members.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;para</span> <span class='an'>security</span>=<span class='s'><span class='dl'>'</span><span class='k'>c</span><span class='dl'>'</span></span><span class='ta'>&gt;</span>Exiled members of the former Soviet Union's secret
<span class='no'>43</span> police, the KGB, have infiltrated the upper ranks of the GCA and are
<span class='no'>44</span> planning the Final Revolution as soon as DSSSL is completed.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;/result&gt;</span></pre></div>
</div></div><div><h3><a name='sgml-q2'>SGML - Q2</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>Locate all paragraph elements in an introduction
     (all "para" elements directly contained within
     an "intro" element).
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> puts <span class='co'>XML</span>.result(<span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>sgml.xml</span><span class='dl'>'</span></span>).descendants(<span class='sy'>:intro</span>, <span class='sy'>:para</span>))
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;result&gt;
  { 
    doc("sgml.xml")//intro/para 
  }
&lt;/result&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;result&gt;</span><span class='ta'>&lt;para&gt;</span>With the ever-changing and growing global market, companies and
<span class='no'> 2</span> large organizations are searching for ways to become more viable and
<span class='no'> 3</span> competitive. Downsizing and other cost-cutting measures demand more
<span class='no'> 4</span> efficient use of corporate resources. One very important resource is
<span class='no'> 5</span> an organization's information.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;para&gt;</span>As part of the move toward integrated information management,
<span class='no'> 6</span> whole industries are developing and implementing standards for
<span class='no'> 7</span> exchanging technical information. This report describes how one such
<span class='no'> 8</span> standard, the Standard Generalized Markup Language (SGML), works as
<span class='no'> 9</span> part of an overall information management strategy.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;para&gt;</span>While SGML is a fairly recent technology, the use of
<span class='no'><strong>10</strong></span> <span class='ta'>&lt;emph&gt;</span>markup<span class='ta'>&lt;/emph&gt;</span> in computer-generated documents has existed for a
<span class='no'>11</span> while.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;para&gt;</span>Markup is everything in a document that is not content. The
<span class='no'>12</span> traditional meaning of markup is the manual <span class='ta'>&lt;emph&gt;</span>marking<span class='ta'>&lt;/emph&gt;</span> up
<span class='no'>13</span> of typewritten text to give instructions for a typesetter or
<span class='no'>14</span> compositor about how to fit the text on a page and what typefaces to
<span class='no'>15</span> use. This kind of markup is known as <span class='ta'>&lt;emph&gt;</span>procedural markup<span class='ta'>&lt;/emph&gt;</span>.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;para&gt;</span>SGML defines a strict markup scheme with a syntax for defining
<span class='no'>16</span> document data elements and an overall framework for marking up
<span class='no'>17</span> documents.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;para&gt;</span>SGML can describe and create documents that are not dependent on
<span class='no'>18</span> any hardware, software, formatter, or operating system. Since SGML documents
<span class='no'>19</span> conform to an international standard, they are portable.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;para&gt;</span>You can break a typical document into three layers: structure,
<span class='no'><strong>20</strong></span> content, and style. SGML works by separating these three aspects and
<span class='no'>21</span> deals mainly with the relationship between structure and content.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;para&gt;</span>The Graphic Communications Association has been
<span class='no'>22</span> instrumental in the development of SGML. GCA provides conferences,
<span class='no'>23</span> tutorials, newsletters, and publication sales for both members and
<span class='no'>24</span> non-members.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;para</span> <span class='an'>security</span>=<span class='s'><span class='dl'>'</span><span class='k'>c</span><span class='dl'>'</span></span><span class='ta'>&gt;</span>Exiled members of the former Soviet Union's secret
<span class='no'>25</span> police, the KGB, have infiltrated the upper ranks of the GCA and are
<span class='no'>26</span> planning the Final Revolution as soon as DSSSL is completed.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;/result&gt;</span></pre></div>
</div></div><div><h3><a name='sgml-q3'>SGML - Q3</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>Locate all paragraphs in the introduction of a
     section that is in a chapter that has no
     introduction (all "para" elements directly
     contained within an "intro" element directly
     contained in a "section" element directly
     contained in a "chapter" element.
     The "chapter" element must not directly
     contain an "intro" element).
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='co'>XML</span>.result! {
<span class='no'>2</span>     <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>sgml.xml</span><span class='dl'>'</span></span>).descendants(<span class='sy'>:chapter</span>) {|c|
<span class='no'>3</span>         <span class='r'>next</span> <span class='r'>unless</span> c.children(<span class='sy'>:intro</span>).empty?
<span class='no'>4</span>         add! c.children(<span class='sy'>:section</span>, <span class='sy'>:intro</span>, <span class='sy'>:para</span>)
<span class='no'>5</span>     }
<span class='no'>6</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;result&gt;
  {
    for $c in doc("sgml.xml")//chapter
    where empty($c/intro)
    return $c/section/intro/para
  }
&lt;/result&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='ta'>&lt;result&gt;</span><span class='ta'>&lt;para&gt;</span>The Graphic Communications Association has been
<span class='no'>2</span> instrumental in the development of SGML. GCA provides conferences,
<span class='no'>3</span> tutorials, newsletters, and publication sales for both members and
<span class='no'>4</span> non-members.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;para</span> <span class='an'>security</span>=<span class='s'><span class='dl'>'</span><span class='k'>c</span><span class='dl'>'</span></span><span class='ta'>&gt;</span>Exiled members of the former Soviet Union's secret
<span class='no'>5</span> police, the KGB, have infiltrated the upper ranks of the GCA and are
<span class='no'>6</span> planning the Final Revolution as soon as DSSSL is completed.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;/result&gt;</span></pre></div>
</div></div><div><h3><a name='sgml-q4'>SGML - Q4</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>Locate the second paragraph in the third section
     in the second chapter (the second "para" element
     occurring in the third "section" element occurring
     in the second "chapter" element occurring in
     the "report").
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='co'>XML</span>.result!(
<span class='no'>2</span>     <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>sgml.xml</span><span class='dl'>'</span></span>).descendants(<span class='sy'>:chapter</span>)[<span class='i'>1</span>].descendants(<span class='sy'>:section</span>)[<span class='i'>2</span>].descendants(<span class='sy'>:para</span>)[<span class='i'>1</span>]
<span class='no'>3</span> )
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;result&gt;
  {
    (((doc("sgml.xml")//chapter)[2]//section)[3]//para)[2]
  }
&lt;/result&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='ta'>&lt;result&gt;</span><span class='ta'>&lt;para&gt;</span>At the heart of an SGML application is a file called the DTD, or
<span class='no'>2</span> Document Type Definition. The DTD sets up the structure of a document,
<span class='no'>3</span> much like a database schema describes the types of information it
<span class='no'>4</span> handles.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;/result&gt;</span></pre></div>
</div></div><div><h3><a name='sgml-q5'>SGML - Q5</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>Locate all classified paragraphs (all "para"
     elements whose "security" attribute has the
     value "c").
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='co'>XML</span>.result!(<span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>sgml.xml</span><span class='dl'>'</span></span>).descendants(<span class='sy'>:para</span>).find_all{|p| p[<span class='sy'>:security</span>] == <span class='s'><span class='dl'>'</span><span class='k'>c</span><span class='dl'>'</span></span>})
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;result&gt;
  {
    doc("sgml.xml")//para[@security = "c"]
  }
&lt;/result&gt; 
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='ta'>&lt;result&gt;</span><span class='ta'>&lt;para</span> <span class='an'>security</span>=<span class='s'><span class='dl'>'</span><span class='k'>c</span><span class='dl'>'</span></span><span class='ta'>&gt;</span>Exiled members of the former Soviet Union's secret
<span class='no'>2</span> police, the KGB, have infiltrated the upper ranks of the GCA and are
<span class='no'>3</span> planning the Final Revolution as soon as DSSSL is completed.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;/result&gt;</span></pre></div>
</div></div><div><h3><a name='sgml-q6'>SGML - Q6</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>List the short titles of all sections (the
     values of the "shorttitle" attributes of
     all "section" elements, expressing each
     short title as the value of a new element.)
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='co'>XML</span>.result! {
<span class='no'>2</span>     <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>sgml.xml</span><span class='dl'>'</span></span>).descendants(<span class='sy'>:section</span>).each{|s|
<span class='no'>3</span>         stitle! s[<span class='sy'>:shorttitle</span>]
<span class='no'>4</span>     }
<span class='no'>5</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;result&gt;
  {
    for $s in doc("sgml.xml")//section/@shorttitle
    return &lt;stitle&gt;{ $s }&lt;/stitle&gt;
  }
&lt;/result&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='ta'>&lt;result&gt;</span><span class='ta'>&lt;stitle&gt;</span>What is markup?<span class='ta'>&lt;/stitle&gt;</span><span class='ta'>&lt;stitle&gt;</span>What is SGML?<span class='ta'>&lt;/stitle&gt;</span><span class='ta'>&lt;stitle&gt;</span>How does SGML work?<span class='ta'>&lt;/stitle&gt;</span><span class='ta'>&lt;stitle</span><span class='ta'>/&gt;</span><span class='ta'>&lt;/result&gt;</span>
</pre></div>
</div></div><div><h3><a name='sgml-q7'>SGML - Q7</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>Locate the initial letter of the initial
     paragraph of all introductions (the first
     character in the content [character content
     as well as element content] of the first
     "para" element contained in an "intro" element).
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='co'>XML</span>.result! {
<span class='no'>2</span>     <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>sgml.xml</span><span class='dl'>'</span></span>).descendants(<span class='sy'>:intro</span>) {|i|
<span class='no'>3</span>         first_letter! i.children(<span class='sy'>:para</span>)[<span class='i'>0</span>].text[<span class='i'>0</span>,<span class='i'>1</span>]
<span class='no'>4</span>     }
<span class='no'>5</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;result&gt;
  {
    for $i in doc("sgml.xml")//intro/para[1]
    return
        &lt;first_letter&gt;{ substring(string($i), 1, 1) }&lt;/first_letter&gt;
  }
&lt;/result&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='ta'>&lt;result&gt;</span><span class='ta'>&lt;first_letter&gt;</span>W<span class='ta'>&lt;/first_letter&gt;</span><span class='ta'>&lt;first_letter&gt;</span>W<span class='ta'>&lt;/first_letter&gt;</span><span class='ta'>&lt;first_letter&gt;</span>M<span class='ta'>&lt;/first_letter&gt;</span><span class='ta'>&lt;first_letter&gt;</span>S<span class='ta'>&lt;/first_letter&gt;</span><span class='ta'>&lt;first_letter&gt;</span>Y<span class='ta'>&lt;/first_letter&gt;</span><span class='ta'>&lt;first_letter&gt;</span>T<span class='ta'>&lt;/first_letter&gt;</span><span class='ta'>&lt;/result&gt;</span>
</pre></div>
</div></div><div><h3><a name='sgml-q8a'>SGML - Q8a</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>Locate all sections with a title that has
      "is SGML" in it. The string may occur anywhere
      in the descendants of the title element,
      and markup boundaries are ignored.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='co'>XML</span>.result! {
<span class='no'>2</span>     <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>sgml.xml</span><span class='dl'>'</span></span>).descendants(<span class='sy'>:section</span>) {|s|
<span class='no'>3</span>         add! s <span class='r'>if</span> s.descendants(<span class='sy'>:title</span>).any?{|t| t =~ <span class='rx'><span class='dl'>/</span><span class='k'>is SGML</span><span class='dl'>/</span></span>}
<span class='no'>4</span>     }
<span class='no'>5</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;result&gt;
   {
     doc("sgml.xml")//section[.//title[contains(., "is SGML")]]
   }
&lt;/result&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;result&gt;</span><span class='ta'>&lt;section</span> <span class='an'>shorttitle</span>=<span class='s'><span class='dl'>'</span><span class='k'>What is SGML?</span><span class='dl'>'</span></span><span class='ta'>&gt;</span>
<span class='no'> 2</span> <span class='ta'>&lt;title&gt;</span>What <span class='ta'>&lt;emph&gt;</span>is<span class='ta'>&lt;/emph&gt;</span> SGML in the grand scheme of the universe, anyway?<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 3</span> <span class='ta'>&lt;intro&gt;</span>
<span class='no'> 4</span> <span class='ta'>&lt;para&gt;</span>SGML defines a strict markup scheme with a syntax for defining
<span class='no'> 5</span> document data elements and an overall framework for marking up
<span class='no'> 6</span> documents.<span class='ta'>&lt;/para&gt;</span>
<span class='no'> 7</span> <span class='ta'>&lt;para&gt;</span>SGML can describe and create documents that are not dependent on
<span class='no'> 8</span> any hardware, software, formatter, or operating system. Since SGML documents
<span class='no'> 9</span> conform to an international standard, they are portable.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;/intro&gt;</span><span class='ta'>&lt;/section&gt;</span><span class='ta'>&lt;section</span> <span class='an'>shorttitle</span>=<span class='s'><span class='dl'>'</span><span class='k'>How does SGML work?</span><span class='dl'>'</span></span><span class='ta'>&gt;</span>
<span class='no'><strong>10</strong></span> <span class='ta'>&lt;title&gt;</span>How is SGML and would you recommend it to your grandmother?<span class='ta'>&lt;/title&gt;</span>
<span class='no'>11</span> <span class='ta'>&lt;intro&gt;</span>
<span class='no'>12</span> <span class='ta'>&lt;para&gt;</span>You can break a typical document into three layers: structure,
<span class='no'>13</span> content, and style. SGML works by separating these three aspects and
<span class='no'>14</span> deals mainly with the relationship between structure and content.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;/intro&gt;</span>
<span class='no'>15</span> <span class='ta'>&lt;topic</span> <span class='an'>topicid</span>=<span class='s'><span class='dl'>'</span><span class='k'>top4</span><span class='dl'>'</span></span><span class='ta'>&gt;</span>
<span class='no'>16</span> <span class='ta'>&lt;title&gt;</span>Structure<span class='ta'>&lt;/title&gt;</span>
<span class='no'>17</span> <span class='ta'>&lt;para&gt;</span>At the heart of an SGML application is a file called the DTD, or
<span class='no'>18</span> Document Type Definition. The DTD sets up the structure of a document,
<span class='no'>19</span> much like a database schema describes the types of information it
<span class='no'><strong>20</strong></span> handles.<span class='ta'>&lt;/para&gt;</span>
<span class='no'>21</span> <span class='ta'>&lt;para&gt;</span>A database schema also defines the relationships between the
<span class='no'>22</span> various types of data. Similarly, a DTD specifies <span class='ta'>&lt;emph&gt;</span>rules<span class='ta'>&lt;/emph&gt;</span>
<span class='no'>23</span> to help ensure documents have a consistent, logical structure.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;/topic&gt;</span>
<span class='no'>24</span> <span class='ta'>&lt;topic</span> <span class='an'>topicid</span>=<span class='s'><span class='dl'>'</span><span class='k'>top5</span><span class='dl'>'</span></span><span class='ta'>&gt;</span>
<span class='no'>25</span> <span class='ta'>&lt;title&gt;</span>Content<span class='ta'>&lt;/title&gt;</span>
<span class='no'>26</span> <span class='ta'>&lt;para&gt;</span>Content is the information itself. The method for identifying
<span class='no'>27</span> the information and its meaning within this framework is called
<span class='no'>28</span> <span class='ta'>&lt;emph&gt;</span>tagging<span class='ta'>&lt;/emph&gt;</span>. Tagging must
<span class='no'>29</span> conform to the rules established in the DTD (see <span class='ta'>&lt;xref</span> <span class='an'>xrefid</span>=<span class='s'><span class='dl'>'</span><span class='k'>top4</span><span class='dl'>'</span></span><span class='ta'>/&gt;</span>).<span class='ta'>&lt;/para&gt;</span>
<span class='no'><strong>30</strong></span> <span class='ta'>&lt;graphic</span> <span class='an'>graphname</span>=<span class='s'><span class='dl'>'</span><span class='k'>tagexamp</span><span class='dl'>'</span></span><span class='ta'>/&gt;</span><span class='ta'>&lt;/topic&gt;</span>
<span class='no'>31</span> <span class='ta'>&lt;topic</span> <span class='an'>topicid</span>=<span class='s'><span class='dl'>'</span><span class='k'>top6</span><span class='dl'>'</span></span><span class='ta'>&gt;</span>
<span class='no'>32</span> <span class='ta'>&lt;title&gt;</span>Style<span class='ta'>&lt;/title&gt;</span>
<span class='no'>33</span> <span class='ta'>&lt;para&gt;</span>SGML does not standardize style or other processing methods for
<span class='no'>34</span> information stored in SGML.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;/topic&gt;</span><span class='ta'>&lt;/section&gt;</span><span class='ta'>&lt;/result&gt;</span></pre></div>
</div></div><div><h3><a name='sgml-q8b'>SGML - Q8b</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>Same as (Q8a), but the string "is SGML" cannot
      be interrupted by sub-elements, and must
      appear in a single text node.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='co'>XML</span>.result! {
<span class='no'> 2</span>     doc = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>sgml.xml</span><span class='dl'>'</span></span>)
<span class='no'> 3</span> doc.normalize!
<span class='no'> 4</span>     doc.descendants(<span class='sy'>:section</span>) {|s|
<span class='no'> 5</span>         add! s <span class='r'>if</span> s.descendants(<span class='sy'>:title</span>).any?{|t|
<span class='no'> 6</span>             t.descendants.any?{|d| d.is_a? <span class='co'>String</span> <span class='r'>and</span> d =~ <span class='rx'><span class='dl'>/</span><span class='k'>is SGML</span><span class='dl'>/</span></span>}
<span class='no'> 7</span>         }
<span class='no'> 8</span>     }
<span class='no'> 9</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;result&gt;
   {
     doc("sgml.xml")//section[.//title/text()[contains(., "is SGML")]]
   }
&lt;/result&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;result&gt;</span><span class='ta'>&lt;section</span> <span class='an'>shorttitle</span>=<span class='s'><span class='dl'>'</span><span class='k'>How does SGML work?</span><span class='dl'>'</span></span><span class='ta'>&gt;</span>
<span class='no'> 2</span> <span class='ta'>&lt;title&gt;</span>How is SGML and would you recommend it to your grandmother?<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 3</span> <span class='ta'>&lt;intro&gt;</span>
<span class='no'> 4</span> <span class='ta'>&lt;para&gt;</span>You can break a typical document into three layers: structure,
<span class='no'> 5</span> content, and style. SGML works by separating these three aspects and
<span class='no'> 6</span> deals mainly with the relationship between structure and content.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;/intro&gt;</span>
<span class='no'> 7</span> <span class='ta'>&lt;topic</span> <span class='an'>topicid</span>=<span class='s'><span class='dl'>'</span><span class='k'>top4</span><span class='dl'>'</span></span><span class='ta'>&gt;</span>
<span class='no'> 8</span> <span class='ta'>&lt;title&gt;</span>Structure<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 9</span> <span class='ta'>&lt;para&gt;</span>At the heart of an SGML application is a file called the DTD, or
<span class='no'><strong>10</strong></span> Document Type Definition. The DTD sets up the structure of a document,
<span class='no'>11</span> much like a database schema describes the types of information it
<span class='no'>12</span> handles.<span class='ta'>&lt;/para&gt;</span>
<span class='no'>13</span> <span class='ta'>&lt;para&gt;</span>A database schema also defines the relationships between the
<span class='no'>14</span> various types of data. Similarly, a DTD specifies <span class='ta'>&lt;emph&gt;</span>rules<span class='ta'>&lt;/emph&gt;</span>
<span class='no'>15</span> to help ensure documents have a consistent, logical structure.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;/topic&gt;</span>
<span class='no'>16</span> <span class='ta'>&lt;topic</span> <span class='an'>topicid</span>=<span class='s'><span class='dl'>'</span><span class='k'>top5</span><span class='dl'>'</span></span><span class='ta'>&gt;</span>
<span class='no'>17</span> <span class='ta'>&lt;title&gt;</span>Content<span class='ta'>&lt;/title&gt;</span>
<span class='no'>18</span> <span class='ta'>&lt;para&gt;</span>Content is the information itself. The method for identifying
<span class='no'>19</span> the information and its meaning within this framework is called
<span class='no'><strong>20</strong></span> <span class='ta'>&lt;emph&gt;</span>tagging<span class='ta'>&lt;/emph&gt;</span>. Tagging must
<span class='no'>21</span> conform to the rules established in the DTD (see <span class='ta'>&lt;xref</span> <span class='an'>xrefid</span>=<span class='s'><span class='dl'>'</span><span class='k'>top4</span><span class='dl'>'</span></span><span class='ta'>/&gt;</span>).<span class='ta'>&lt;/para&gt;</span>
<span class='no'>22</span> <span class='ta'>&lt;graphic</span> <span class='an'>graphname</span>=<span class='s'><span class='dl'>'</span><span class='k'>tagexamp</span><span class='dl'>'</span></span><span class='ta'>/&gt;</span><span class='ta'>&lt;/topic&gt;</span>
<span class='no'>23</span> <span class='ta'>&lt;topic</span> <span class='an'>topicid</span>=<span class='s'><span class='dl'>'</span><span class='k'>top6</span><span class='dl'>'</span></span><span class='ta'>&gt;</span>
<span class='no'>24</span> <span class='ta'>&lt;title&gt;</span>Style<span class='ta'>&lt;/title&gt;</span>
<span class='no'>25</span> <span class='ta'>&lt;para&gt;</span>SGML does not standardize style or other processing methods for
<span class='no'>26</span> information stored in SGML.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;/topic&gt;</span><span class='ta'>&lt;/section&gt;</span><span class='ta'>&lt;/result&gt;</span></pre></div>
</div></div><div><h3><a name='sgml-q9'>SGML - Q9</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>Locate all the topics referenced by a
      cross-reference anywhere in the report
      (all the "topic" elements whose "topicid"
      attribute value is the same as an "xrefid"
      attribute value of any "xref" element).
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> doc = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>sgml.xml</span><span class='dl'>'</span></span>)
<span class='no'>2</span> 
<span class='no'>3</span> <span class='co'>XML</span>.result! {
<span class='no'>4</span>     doc.descendants(<span class='sy'>:xref</span>) {|xref|
<span class='no'>5</span>         add! doc.descendants(<span class='sy'>:topic</span>).find_all{|t| t[<span class='sy'>:topicid</span>] == xref[<span class='sy'>:xrefid</span>]}
<span class='no'>6</span>     }
<span class='no'>7</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;result&gt;
  {
    for $id in doc("sgml.xml")//xref/@xrefid
    return doc("sgml.xml")//topic[@topicid = $id]
  }
&lt;/result&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;result&gt;</span><span class='ta'>&lt;topic</span> <span class='an'>topicid</span>=<span class='s'><span class='dl'>'</span><span class='k'>top4</span><span class='dl'>'</span></span><span class='ta'>&gt;</span>
<span class='no'> 2</span> <span class='ta'>&lt;title&gt;</span>Structure<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 3</span> <span class='ta'>&lt;para&gt;</span>At the heart of an SGML application is a file called the DTD, or
<span class='no'> 4</span> Document Type Definition. The DTD sets up the structure of a document,
<span class='no'> 5</span> much like a database schema describes the types of information it
<span class='no'> 6</span> handles.<span class='ta'>&lt;/para&gt;</span>
<span class='no'> 7</span> <span class='ta'>&lt;para&gt;</span>A database schema also defines the relationships between the
<span class='no'> 8</span> various types of data. Similarly, a DTD specifies <span class='ta'>&lt;emph&gt;</span>rules<span class='ta'>&lt;/emph&gt;</span>
<span class='no'> 9</span> to help ensure documents have a consistent, logical structure.<span class='ta'>&lt;/para&gt;</span><span class='ta'>&lt;/topic&gt;</span><span class='ta'>&lt;/result&gt;</span></pre></div>
</div></div><div><h3><a name='sgml-q10'>SGML - Q10</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>Locate the closest title preceding the
      cross-reference ("xref") element whose
      "xrefid" attribute is "top4" (the "title"
      element that would be touched last before
      this "xref" element when touching each
      element in document order).
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> doc = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>sgml.xml</span><span class='dl'>'</span></span>)
<span class='no'>2</span> 
<span class='no'>3</span> <span class='co'>XML</span>.result! {
<span class='no'>4</span>     xref = doc.descendants(<span class='sy'>:xref</span>).find{|xref| xref[<span class='sy'>:xrefid</span>] == <span class='s'><span class='dl'>"</span><span class='k'>top4</span><span class='dl'>"</span></span>}
<span class='no'>5</span>     add! doc.range(<span class='pc'>nil</span>,xref).descendants(<span class='sy'>:title</span>)[<span class='i'>-1</span>]
<span class='no'>6</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;result&gt;
  {
    let $x := doc("sgml.xml")//xref[@xrefid = "top4"],
        $t := doc("sgml.xml")//title[. &lt;&lt; $x]
    return $t[last()]
  }
&lt;/result&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='ta'>&lt;result&gt;</span><span class='ta'>&lt;title&gt;</span>Content<span class='ta'>&lt;/title&gt;</span><span class='ta'>&lt;/result&gt;</span></pre></div>
</div></div><div><h3><a name='string-company-data.xml'>Input for STRING - company-data.xml</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='pp'>&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span> 
<span class='no'> 2</span> <span class='pp'>&lt;!DOCTYPE company SYSTEM "company.dtd"&gt;</span>
<span class='no'> 3</span> <span class='ta'>&lt;company&gt;</span>
<span class='no'> 4</span>    <span class='ta'>&lt;name&gt;</span>Foobar Corporation<span class='ta'>&lt;/name&gt;</span>
<span class='no'> 5</span>    <span class='ta'>&lt;ticker_symbol&gt;</span>FOO<span class='ta'>&lt;/ticker_symbol&gt;</span>
<span class='no'> 6</span> 
<span class='no'> 7</span>    <span class='ta'>&lt;description&gt;</span>Foobar Corporation is a maker of Foo(TM) and
<span class='no'> 8</span>         Foobar(TM) products and a leading software company with a 300
<span class='no'> 9</span>         Billion dollar revenue in 1999. It is located in Alaska.
<span class='no'><strong>10</strong></span>    <span class='ta'>&lt;/description&gt;</span>
<span class='no'>11</span> 
<span class='no'>12</span>    <span class='ta'>&lt;business_code&gt;</span>Software<span class='ta'>&lt;/business_code&gt;</span>
<span class='no'>13</span>    <span class='ta'>&lt;partners&gt;</span>
<span class='no'>14</span>         <span class='ta'>&lt;partner&gt;</span>YouNameItWeIntegrateIt.com<span class='ta'>&lt;/partner&gt;</span>
<span class='no'>15</span>         <span class='ta'>&lt;partner&gt;</span>TheAppCompany Inc.<span class='ta'>&lt;/partner&gt;</span>
<span class='no'>16</span>    <span class='ta'>&lt;/partners&gt;</span>
<span class='no'>17</span>    <span class='ta'>&lt;competitors&gt;</span>
<span class='no'>18</span>         <span class='ta'>&lt;competitor&gt;</span>Gorilla Corporation<span class='ta'>&lt;/competitor&gt;</span>
<span class='no'>19</span>    <span class='ta'>&lt;/competitors&gt;</span>
<span class='no'><strong>20</strong></span> <span class='ta'>&lt;/company&gt;</span>
</pre></div>
</div></div><div><h3><a name='string-string.xml'>Input for STRING - string.xml</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='pp'>&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class='no'> 2</span> <span class='ta'>&lt;news&gt;</span>
<span class='no'> 3</span> <span class='ta'>&lt;news_item&gt;</span>
<span class='no'> 4</span>    <span class='ta'>&lt;title&gt;</span> Gorilla Corporation acquires YouNameItWeIntegrateIt.com <span class='ta'>&lt;/title&gt;</span>
<span class='no'> 5</span>    <span class='ta'>&lt;content&gt;</span>
<span class='no'> 6</span>       <span class='ta'>&lt;par&gt;</span> Today, Gorilla Corporation announced that it will purchase
<span class='no'> 7</span>           YouNameItWeIntegrateIt.com. The shares of
<span class='no'> 8</span>           YouNameItWeIntegrateIt.com dropped $3.00 as a result of this
<span class='no'> 9</span>           announcement.
<span class='no'><strong>10</strong></span>       <span class='ta'>&lt;/par&gt;</span>
<span class='no'>11</span> 
<span class='no'>12</span>       <span class='ta'>&lt;par&gt;</span> As a result of this acquisition, the CEO of
<span class='no'>13</span>           YouNameItWeIntegrateIt.com Bill Smarts resigned. He did not
<span class='no'>14</span>           announce what he will do next.  Sources close to
<span class='no'>15</span>           YouNameItWeIntegrateIt.com hint that Bill Smarts might be
<span class='no'>16</span>           taking a position in Foobar Corporation.
<span class='no'>17</span>       <span class='ta'>&lt;/par&gt;</span>
<span class='no'>18</span> 
<span class='no'>19</span>       <span class='ta'>&lt;par&gt;</span>YouNameItWeIntegrateIt.com is a leading systems integrator
<span class='no'><strong>20</strong></span>           that enables <span class='ta'>&lt;quote&gt;</span>brick and mortar<span class='ta'>&lt;/quote&gt;</span> companies to
<span class='no'>21</span>           have a presence on the web.
<span class='no'>22</span>       <span class='ta'>&lt;/par&gt;</span>
<span class='no'>23</span> 
<span class='no'>24</span>    <span class='ta'>&lt;/content&gt;</span>
<span class='no'>25</span>    <span class='ta'>&lt;date&gt;</span>1-20-2000<span class='ta'>&lt;/date&gt;</span>
<span class='no'>26</span>    <span class='ta'>&lt;author&gt;</span>Mark Davis<span class='ta'>&lt;/author&gt;</span>
<span class='no'>27</span>    <span class='ta'>&lt;news_agent&gt;</span>News Online<span class='ta'>&lt;/news_agent&gt;</span>
<span class='no'>28</span> <span class='ta'>&lt;/news_item&gt;</span>
<span class='no'>29</span> 
<span class='no'><strong>30</strong></span> <span class='ta'>&lt;news_item&gt;</span>
<span class='no'>31</span>    <span class='ta'>&lt;title&gt;</span>Foobar Corporation releases its new line of Foo products
<span class='no'>32</span>    today<span class='ta'>&lt;/title&gt;</span>
<span class='no'>33</span>    <span class='ta'>&lt;content&gt;</span>
<span class='no'>34</span>       <span class='ta'>&lt;par&gt;</span> Foobar Corporation releases the 20.9 version of its Foo
<span class='no'>35</span>             products.  The new version of Foo products solve known
<span class='no'>36</span>             performance problems which existed in 20.8 line and
<span class='no'>37</span>             increases the speed of Foo based products tenfold. It also
<span class='no'>38</span>             allows wireless clients to be connected to the Foobar
<span class='no'>39</span>             servers.
<span class='no'><strong>40</strong></span>       <span class='ta'>&lt;/par&gt;</span>
<span class='no'>41</span>       <span class='ta'>&lt;par&gt;</span> The President of Foobar Corporation announced that they
<span class='no'>42</span>             were proud to release 20.9 version of Foo products and
<span class='no'>43</span>             they will upgrade existing customers <span class='ta'>&lt;footnote&gt;</span>where
<span class='no'>44</span>             service agreements exist<span class='ta'>&lt;/footnote&gt;</span>
<span class='no'>45</span>             promptly. TheAppCompany Inc. immediately announced that it
<span class='no'>46</span>             will release the new version of its products to utilize
<span class='no'>47</span>             the 20.9 architecture within the next three months.
<span class='no'>48</span>       <span class='ta'>&lt;/par&gt;</span>
<span class='no'>49</span>       <span class='ta'>&lt;figure&gt;</span>
<span class='no'><strong>50</strong></span>           <span class='ta'>&lt;title&gt;</span>Presidents of Foobar Corporation and TheAppCompany
<span class='no'>51</span>           Inc. Shake Hands<span class='ta'>&lt;/title&gt;</span> <span class='ta'>&lt;image</span> <span class='an'>source</span>=<span class='s'><span class='dl'>"</span><span class='k'>handshake.jpg</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>
<span class='no'>52</span>       <span class='ta'>&lt;/figure&gt;</span>
<span class='no'>53</span>    <span class='ta'>&lt;/content&gt;</span>
<span class='no'>54</span>    <span class='ta'>&lt;date&gt;</span>1-20-2000<span class='ta'>&lt;/date&gt;</span>
<span class='no'>55</span>    <span class='ta'>&lt;news_agent&gt;</span>Foobar Corporation<span class='ta'>&lt;/news_agent&gt;</span>
<span class='no'>56</span> <span class='ta'>&lt;/news_item&gt;</span>
<span class='no'>57</span> 
<span class='no'>58</span> <span class='ta'>&lt;news_item&gt;</span> <span class='ta'>&lt;title&gt;</span>Foobar Corporation is suing Gorilla Corporation for
<span class='no'>59</span>    patent infringement <span class='ta'>&lt;/title&gt;</span>
<span class='no'><strong>60</strong></span>    <span class='ta'>&lt;content&gt;</span>
<span class='no'>61</span>       <span class='ta'>&lt;par&gt;</span> In surprising developments today, Foobar Corporation
<span class='no'>62</span>          announced that it is suing Gorilla Corporation for patent
<span class='no'>63</span>          infringement. The patents that were mentioned as part of the
<span class='no'>64</span>          lawsuit are considered to be the basis of Foobar
<span class='no'>65</span>          Corporation's <span class='ta'>&lt;quote&gt;</span>Wireless Foo<span class='ta'>&lt;/quote&gt;</span> line of products.
<span class='no'>66</span>       <span class='ta'>&lt;/par&gt;</span>
<span class='no'>67</span>       <span class='ta'>&lt;par&gt;</span>The tension between Foobar and Gorilla Corporations has
<span class='no'>68</span>          been increasing ever since the Gorilla Corporation acquired
<span class='no'>69</span>          more than 40 engineers who have left Foobar Corporation,
<span class='no'><strong>70</strong></span>          TheAppCompany Inc. and YouNameItWeIntegrateIt.com over the
<span class='no'>71</span>          past 3 months. The engineers who have left the Foobar
<span class='no'>72</span>          corporation and its partners were rumored to be working on
<span class='no'>73</span>          the next generation of server products and applications which
<span class='no'>74</span>          will directly compete with Foobar's Foo 20.9 servers. Most of
<span class='no'>75</span>          the engineers have relocated to Hawaii where the Gorilla
<span class='no'>76</span>          Corporation's server development is located.
<span class='no'>77</span>       <span class='ta'>&lt;/par&gt;</span>
<span class='no'>78</span>    <span class='ta'>&lt;/content&gt;</span>
<span class='no'>79</span>    <span class='ta'>&lt;date&gt;</span>1-20-2000<span class='ta'>&lt;/date&gt;</span>
<span class='no'><strong>80</strong></span>    <span class='ta'>&lt;news_agent&gt;</span>Reliable News Corporation<span class='ta'>&lt;/news_agent&gt;</span>
<span class='no'>81</span> <span class='ta'>&lt;/news_item&gt;</span>
<span class='no'>82</span> <span class='ta'>&lt;/news&gt;</span>
</pre></div>
</div></div><div><h3><a name='string-q1'>STRING - Q1</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>Find the titles of all news items where
     the string "Foobar Corporation" appears
     in the title.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>string.xml</span><span class='dl'>'</span></span>).descendants(<span class='sy'>:news_item</span>, <span class='sy'>:title</span>).each{|t|
<span class='no'>2</span>     print t <span class='r'>if</span> t =~ <span class='rx'><span class='dl'>/</span><span class='k'>Foobar Corporation</span><span class='dl'>/</span></span>
<span class='no'>3</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>doc("string.xml")//news_item/title[contains(., "Foobar Corporation")]
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='ta'>&lt;title&gt;</span>Foobar Corporation releases its new line of Foo
<span class='no'>2</span> products today<span class='ta'>&lt;/title&gt;</span>
<span class='no'>3</span> <span class='ta'>&lt;title&gt;</span>Foobar Corporation is suing Gorilla Corporation for patent
<span class='no'>4</span> infringement <span class='ta'>&lt;/title&gt;</span>
</pre></div>
</div></div><div><h3><a name='string-q2'>STRING - Q2</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>Find news items where the Foobar Corporation
     and one or more of its partners are mentioned
     in the same paragraph and/or title.
     List each news item by its title and date.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> partners = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>company-data.xml</span><span class='dl'>'</span></span>).descendants(<span class='sy'>:partner</span>).map{|p| p.text}
<span class='no'>2</span> 
<span class='no'>3</span> <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>string.xml</span><span class='dl'>'</span></span>).descendants(<span class='sy'>:news_item</span>) {|item|
<span class='no'>4</span>     <span class='r'>next</span> <span class='r'>unless</span> (item.descendants(<span class='sy'>:title</span>) + item.descendants(<span class='sy'>:par</span>)).any?{|t|
<span class='no'>5</span>        t.text.include? <span class='s'><span class='dl'>"</span><span class='k'>Foobar Corporation</span><span class='dl'>"</span></span> <span class='r'>and</span> partners.any?{|p| t.text.include? p}
<span class='no'>6</span>     }
<span class='no'>7</span>     <span class='co'>XML</span>.news_item!(item.child(<span class='sy'>:title</span>), item.child(<span class='sy'>:date</span>))
<span class='no'>8</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>declare function local:partners($company as xs:string) as element()*
{
    let $c := doc("company-data.xml")//company[name = $company]
    return $c//partner
};

let $foobar_partners := local:partners("Foobar Corporation")

for $item in doc("string.xml")//news_item
where
  some $t in $item//title satisfies
    (contains($t/text(), "Foobar Corporation")
    and (some $partner in $foobar_partners satisfies
      contains($t/text(), $partner/text())))
  or (some $par in $item//par satisfies
   (contains(string($par), "Foobar Corporation")
     and (some $partner in $foobar_partners satisfies
        contains(string($par), $partner/text())))) 
return
    &lt;news_item&gt;
        { $item/title }
        { $item/date }
    &lt;/news_item&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;news_item&gt;</span>
<span class='no'> 2</span>     <span class='ta'>&lt;title&gt;</span> Gorilla Corporation acquires YouNameItWeIntegrateIt.com <span class='ta'>&lt;/title&gt;</span>
<span class='no'> 3</span>     <span class='ta'>&lt;date&gt;</span>1-20-2000<span class='ta'>&lt;/date&gt;</span>
<span class='no'> 4</span> <span class='ta'>&lt;/news_item&gt;</span>
<span class='no'> 5</span> <span class='ta'>&lt;news_item&gt;</span>
<span class='no'> 6</span>     <span class='ta'>&lt;title&gt;</span>Foobar Corporation releases its new line of Foo products today<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 7</span>     <span class='ta'>&lt;date&gt;</span>1-20-2000<span class='ta'>&lt;/date&gt;</span>
<span class='no'> 8</span> <span class='ta'>&lt;/news_item&gt;</span>
<span class='no'> 9</span> <span class='ta'>&lt;news_item&gt;</span>
<span class='no'><strong>10</strong></span>     <span class='ta'>&lt;title&gt;</span>Foobar Corporation is suing Gorilla Corporation for patent
<span class='no'>11</span>     infringement <span class='ta'>&lt;/title&gt;</span>
<span class='no'>12</span>     <span class='ta'>&lt;date&gt;</span>1-20-2000<span class='ta'>&lt;/date&gt;</span>
<span class='no'>13</span> <span class='ta'>&lt;/news_item&gt;</span>
</pre></div>
</div></div><div><h3><a name='string-q4'>STRING - Q4</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>Find news items where a company and one
     of its partners is mentioned in the same
     news item and the news item is not authored
     by the company itself.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> company_data = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>company-data.xml</span><span class='dl'>'</span></span>)
<span class='no'> 2</span> partners = company_data.descendants(<span class='sy'>:partner</span>).map{|p| p.text}
<span class='no'> 3</span> c = company_data[<span class='sy'>:@name</span>]
<span class='no'> 4</span> 
<span class='no'> 5</span> <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>string.xml</span><span class='dl'>'</span></span>).descendants(<span class='sy'>:news_item</span>) {|item|
<span class='no'> 6</span>     <span class='r'>next</span> <span class='r'>unless</span> item.text.include? c
<span class='no'> 7</span>     <span class='r'>next</span> <span class='r'>unless</span> partners.any?{|p| item.text.include? p}
<span class='no'> 8</span>     <span class='r'>next</span> <span class='r'>if</span> item[<span class='sy'>:@news_agent</span>] == c
<span class='no'> 9</span>     print item
<span class='no'><strong>10</strong></span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>declare function local:partners($company as xs:string) as element()*
{
    let $c := doc("company-data.xml")//company[name = $company]
    return $c//partner
};

for $item in doc("string.xml")//news_item,
    $c in doc("company-data.xml")//company
let $partners := local:partners($c/name)
where contains(string($item), $c/name)
  and (some $p in $partners satisfies
    contains(string($item), $p) and $item/news_agent != $c/name)
return
    $item
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;news_item&gt;</span>
<span class='no'> 2</span>    <span class='ta'>&lt;title&gt;</span> Gorilla Corporation acquires YouNameItWeIntegrateIt.com <span class='ta'>&lt;/title&gt;</span>
<span class='no'> 3</span>    <span class='ta'>&lt;content&gt;</span>
<span class='no'> 4</span>       <span class='ta'>&lt;par&gt;</span> Today, Gorilla Corporation announced that it will purchase
<span class='no'> 5</span>           YouNameItWeIntegrateIt.com. The shares of
<span class='no'> 6</span>           YouNameItWeIntegrateIt.com dropped $3.00 as a result of this
<span class='no'> 7</span>           announcement.
<span class='no'> 8</span>       <span class='ta'>&lt;/par&gt;</span>
<span class='no'> 9</span> 
<span class='no'><strong>10</strong></span>       <span class='ta'>&lt;par&gt;</span> As a result of this acquisition, the CEO of
<span class='no'>11</span>           YouNameItWeIntegrateIt.com Bill Smarts resigned. He did not
<span class='no'>12</span>           announce what he will do next.  Sources close to
<span class='no'>13</span>           YouNameItWeIntegrateIt.com hint that Bill Smarts might be
<span class='no'>14</span>           taking a position in Foobar Corporation.
<span class='no'>15</span>       <span class='ta'>&lt;/par&gt;</span>
<span class='no'>16</span> 
<span class='no'>17</span>       <span class='ta'>&lt;par&gt;</span>YouNameItWeIntegrateIt.com is a leading systems integrator
<span class='no'>18</span>           that enables <span class='ta'>&lt;quote&gt;</span>brick and mortar<span class='ta'>&lt;/quote&gt;</span> companies to
<span class='no'>19</span>           have a presence on the web.
<span class='no'><strong>20</strong></span>       <span class='ta'>&lt;/par&gt;</span>
<span class='no'>21</span> 
<span class='no'>22</span>    <span class='ta'>&lt;/content&gt;</span>
<span class='no'>23</span>    <span class='ta'>&lt;date&gt;</span>1-20-2000<span class='ta'>&lt;/date&gt;</span>
<span class='no'>24</span>    <span class='ta'>&lt;author&gt;</span>Mark Davis<span class='ta'>&lt;/author&gt;</span>
<span class='no'>25</span>    <span class='ta'>&lt;news_agent&gt;</span>News Online<span class='ta'>&lt;/news_agent&gt;</span>
<span class='no'>26</span> <span class='ta'>&lt;/news_item&gt;</span>
<span class='no'>27</span> <span class='ta'>&lt;news_item&gt;</span> <span class='ta'>&lt;title&gt;</span>Foobar Corporation is suing Gorilla Corporation for
<span class='no'>28</span>    patent infringement <span class='ta'>&lt;/title&gt;</span>
<span class='no'>29</span>    <span class='ta'>&lt;content&gt;</span>
<span class='no'><strong>30</strong></span>       <span class='ta'>&lt;par&gt;</span> In surprising developments today, Foobar Corporation
<span class='no'>31</span>          announced that it is suing Gorilla Corporation for patent
<span class='no'>32</span>          infringement. The patents that were mentioned as part of the
<span class='no'>33</span>          lawsuit are considered to be the basis of Foobar
<span class='no'>34</span>          Corporation's <span class='ta'>&lt;quote&gt;</span>Wireless Foo<span class='ta'>&lt;/quote&gt;</span> line of products.
<span class='no'>35</span>       <span class='ta'>&lt;/par&gt;</span>
<span class='no'>36</span>       <span class='ta'>&lt;par&gt;</span>The tension between Foobar and Gorilla Corporations has
<span class='no'>37</span>          been increasing ever since the Gorilla Corporation acquired
<span class='no'>38</span>          more than 40 engineers who have left Foobar Corporation,
<span class='no'>39</span>          TheAppCompany Inc. and YouNameItWeIntegrateIt.com over the
<span class='no'><strong>40</strong></span>          past 3 months. The engineers who have left the Foobar
<span class='no'>41</span>          corporation and its partners were rumored to be working on
<span class='no'>42</span>          the next generation of server products and applications which
<span class='no'>43</span>          will directly compete with Foobar's Foo 20.9 servers. Most of
<span class='no'>44</span>          the engineers have relocated to Hawaii where the Gorilla
<span class='no'>45</span>          Corporation's server development is located.
<span class='no'>46</span>       <span class='ta'>&lt;/par&gt;</span>
<span class='no'>47</span>    <span class='ta'>&lt;/content&gt;</span>
<span class='no'>48</span>    <span class='ta'>&lt;date&gt;</span>1-20-2000<span class='ta'>&lt;/date&gt;</span>
<span class='no'>49</span>    <span class='ta'>&lt;news_agent&gt;</span>Reliable News Corporation<span class='ta'>&lt;/news_agent&gt;</span>
<span class='no'><strong>50</strong></span> <span class='ta'>&lt;/news_item&gt;</span>
</pre></div>
</div></div><div><h3><a name='string-q5'>STRING - Q5</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>For each news item that is relevant to the
     Gorilla Corporation, create an "item summary"
     element. The content of the item summary is
     the content of the title, date, and first
     paragraph of the news item, separated by
     periods. A news item is relevant if the name
     of the company is mentioned anywhere within
     the content of the news item.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>string.xml</span><span class='dl'>'</span></span>).descendants(<span class='sy'>:news_item</span>) {|item|
<span class='no'> 2</span>     <span class='r'>next</span> <span class='r'>unless</span> item =~ <span class='rx'><span class='dl'>/</span><span class='k'>Gorilla Corporation</span><span class='dl'>/</span></span>
<span class='no'> 3</span>     <span class='co'>XML</span>.item_summary! {
<span class='no'> 4</span> add! item[<span class='sy'>:@title</span>].strip
<span class='no'> 5</span>         add! <span class='s'><span class='dl'>"</span><span class='k'>. </span><span class='dl'>"</span></span>
<span class='no'> 6</span>         add! item[<span class='sy'>:@date</span>]
<span class='no'> 7</span>         add! <span class='s'><span class='dl'>"</span><span class='k'>. </span><span class='dl'>"</span></span>
<span class='no'> 8</span>         add! item.descendants(<span class='sy'>:par</span>)[<span class='i'>0</span>].text
<span class='no'> 9</span>     }
<span class='no'><strong>10</strong></span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>for $item in doc("string.xml")//news_item
where contains(string($item/content), "Gorilla Corporation")
return
    &lt;item_summary&gt;
        { concat($item/title,". ") }
        { concat($item/date,". ") }
        { string(($item//par)[1]) }
    &lt;/item_summary&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;item_summary&gt;</span>Gorilla Corporation acquires
<span class='no'> 2</span> YouNameItWeIntegrateIt.com. 1-20-2000.  Today, Gorilla Corporation
<span class='no'> 3</span> announced that it will purchase YouNameItWeIntegrateIt.com. The shares
<span class='no'> 4</span> of YouNameItWeIntegrateIt.com dropped $3.00 as a result of this
<span class='no'> 5</span> announcement.<span class='ta'>&lt;/item_summary&gt;</span>
<span class='no'> 6</span> 
<span class='no'> 7</span> <span class='ta'>&lt;item_summary&gt;</span>Foobar Corporation is suing Gorilla Corporation for
<span class='no'> 8</span> patent infringement. 1-20-2000.  In surprising developments today,
<span class='no'> 9</span> Foobar Corporation announced that it is suing Gorilla Corporation for
<span class='no'><strong>10</strong></span> patent infringement. The patents that were mentioned as part of the
<span class='no'>11</span> lawsuit are considered to be the basis of Foobar Corporation's
<span class='no'>12</span> Wireless Foo line of products.<span class='ta'>&lt;/item_summary&gt;</span>
</pre></div>
</div></div><div><h3><a name='tree-book.xml'>Input for TREE - book.xml</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='pp'>&lt;?xml version="1.0"?&gt;</span>
<span class='no'> 2</span> <span class='pp'>&lt;!DOCTYPE book SYSTEM "book.dtd"&gt;</span>
<span class='no'> 3</span> <span class='ta'>&lt;book&gt;</span>
<span class='no'> 4</span>   <span class='ta'>&lt;title&gt;</span>Data on the Web<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 5</span>   <span class='ta'>&lt;author&gt;</span>Serge Abiteboul<span class='ta'>&lt;/author&gt;</span>
<span class='no'> 6</span>   <span class='ta'>&lt;author&gt;</span>Peter Buneman<span class='ta'>&lt;/author&gt;</span>
<span class='no'> 7</span>   <span class='ta'>&lt;author&gt;</span>Dan Suciu<span class='ta'>&lt;/author&gt;</span>
<span class='no'> 8</span>   <span class='ta'>&lt;section</span> <span class='an'>id</span>=<span class='s'><span class='dl'>"</span><span class='k'>intro</span><span class='dl'>"</span></span> <span class='an'>difficulty</span>=<span class='s'><span class='dl'>"</span><span class='k'>easy</span><span class='dl'>"</span></span> <span class='ta'>&gt;</span>
<span class='no'> 9</span>     <span class='ta'>&lt;title&gt;</span>Introduction<span class='ta'>&lt;/title&gt;</span>
<span class='no'><strong>10</strong></span>     <span class='ta'>&lt;p&gt;</span>Text ... <span class='ta'>&lt;/p&gt;</span>
<span class='no'>11</span>     <span class='ta'>&lt;section&gt;</span>
<span class='no'>12</span>       <span class='ta'>&lt;title&gt;</span>Audience<span class='ta'>&lt;/title&gt;</span>
<span class='no'>13</span>       <span class='ta'>&lt;p&gt;</span>Text ... <span class='ta'>&lt;/p&gt;</span>
<span class='no'>14</span>     <span class='ta'>&lt;/section&gt;</span>
<span class='no'>15</span>     <span class='ta'>&lt;section&gt;</span>
<span class='no'>16</span>       <span class='ta'>&lt;title&gt;</span>Web Data and the Two Cultures<span class='ta'>&lt;/title&gt;</span>
<span class='no'>17</span>       <span class='ta'>&lt;p&gt;</span>Text ... <span class='ta'>&lt;/p&gt;</span>
<span class='no'>18</span>       <span class='ta'>&lt;figure</span> <span class='an'>height</span>=<span class='s'><span class='dl'>"</span><span class='k'>400</span><span class='dl'>"</span></span> <span class='an'>width</span>=<span class='s'><span class='dl'>"</span><span class='k'>400</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'>19</span>         <span class='ta'>&lt;title&gt;</span>Traditional client/server architecture<span class='ta'>&lt;/title&gt;</span>
<span class='no'><strong>20</strong></span>         <span class='ta'>&lt;image</span> <span class='an'>source</span>=<span class='s'><span class='dl'>"</span><span class='k'>csarch.gif</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>
<span class='no'>21</span>       <span class='ta'>&lt;/figure&gt;</span>
<span class='no'>22</span>       <span class='ta'>&lt;p&gt;</span>Text ... <span class='ta'>&lt;/p&gt;</span>
<span class='no'>23</span>     <span class='ta'>&lt;/section&gt;</span>
<span class='no'>24</span>   <span class='ta'>&lt;/section&gt;</span>
<span class='no'>25</span>   <span class='ta'>&lt;section</span> <span class='an'>id</span>=<span class='s'><span class='dl'>"</span><span class='k'>syntax</span><span class='dl'>"</span></span> <span class='an'>difficulty</span>=<span class='s'><span class='dl'>"</span><span class='k'>medium</span><span class='dl'>"</span></span> <span class='ta'>&gt;</span>
<span class='no'>26</span>     <span class='ta'>&lt;title&gt;</span>A Syntax For Data<span class='ta'>&lt;/title&gt;</span>
<span class='no'>27</span>     <span class='ta'>&lt;p&gt;</span>Text ... <span class='ta'>&lt;/p&gt;</span>
<span class='no'>28</span>     <span class='ta'>&lt;figure</span> <span class='an'>height</span>=<span class='s'><span class='dl'>"</span><span class='k'>200</span><span class='dl'>"</span></span> <span class='an'>width</span>=<span class='s'><span class='dl'>"</span><span class='k'>500</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'>29</span>       <span class='ta'>&lt;title&gt;</span>Graph representations of structures<span class='ta'>&lt;/title&gt;</span>
<span class='no'><strong>30</strong></span>       <span class='ta'>&lt;image</span> <span class='an'>source</span>=<span class='s'><span class='dl'>"</span><span class='k'>graphs.gif</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>
<span class='no'>31</span>     <span class='ta'>&lt;/figure&gt;</span>
<span class='no'>32</span>     <span class='ta'>&lt;p&gt;</span>Text ... <span class='ta'>&lt;/p&gt;</span>
<span class='no'>33</span>     <span class='ta'>&lt;section&gt;</span>
<span class='no'>34</span>       <span class='ta'>&lt;title&gt;</span>Base Types<span class='ta'>&lt;/title&gt;</span>
<span class='no'>35</span>       <span class='ta'>&lt;p&gt;</span>Text ... <span class='ta'>&lt;/p&gt;</span>
<span class='no'>36</span>     <span class='ta'>&lt;/section&gt;</span>
<span class='no'>37</span>     <span class='ta'>&lt;section&gt;</span>
<span class='no'>38</span>       <span class='ta'>&lt;title&gt;</span>Representing Relational Databases<span class='ta'>&lt;/title&gt;</span>
<span class='no'>39</span>       <span class='ta'>&lt;p&gt;</span>Text ... <span class='ta'>&lt;/p&gt;</span>
<span class='no'><strong>40</strong></span>       <span class='ta'>&lt;figure</span> <span class='an'>height</span>=<span class='s'><span class='dl'>"</span><span class='k'>250</span><span class='dl'>"</span></span> <span class='an'>width</span>=<span class='s'><span class='dl'>"</span><span class='k'>400</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'>41</span>         <span class='ta'>&lt;title&gt;</span>Examples of Relations<span class='ta'>&lt;/title&gt;</span>
<span class='no'>42</span>         <span class='ta'>&lt;image</span> <span class='an'>source</span>=<span class='s'><span class='dl'>"</span><span class='k'>relations.gif</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>
<span class='no'>43</span>       <span class='ta'>&lt;/figure&gt;</span>
<span class='no'>44</span>     <span class='ta'>&lt;/section&gt;</span>
<span class='no'>45</span>     <span class='ta'>&lt;section&gt;</span>
<span class='no'>46</span>       <span class='ta'>&lt;title&gt;</span>Representing Object Databases<span class='ta'>&lt;/title&gt;</span>
<span class='no'>47</span>       <span class='ta'>&lt;p&gt;</span>Text ... <span class='ta'>&lt;/p&gt;</span>
<span class='no'>48</span>     <span class='ta'>&lt;/section&gt;</span>       
<span class='no'>49</span>   <span class='ta'>&lt;/section&gt;</span>
<span class='no'><strong>50</strong></span> <span class='ta'>&lt;/book&gt;</span>
</pre></div>
</div></div><div><h3><a name='tree-q1'>TREE - Q1</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>Prepare a (nested) table of contents for Book1,
     listing all the sections and their titles.
     Preserve the original attributes of each &lt;section&gt; element, if any.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='r'>def</span> <span class='fu'>local_toc</span>(node)
<span class='no'> 2</span>     node.children(<span class='sy'>:section</span>).map{|c|
<span class='no'> 3</span>         <span class='co'>XML</span>.section(c.attrs, c.child(<span class='sy'>:title</span>), local_toc(c))
<span class='no'> 4</span>     }
<span class='no'> 5</span> <span class='r'>end</span>
<span class='no'> 6</span> 
<span class='no'> 7</span> <span class='co'>XML</span>.toc! {
<span class='no'> 8</span>     add! local_toc(<span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>book.xml</span><span class='dl'>'</span></span>))
<span class='no'> 9</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>declare function local:toc($book-or-section as element()) as element()*
{
    for $section in $book-or-section/section
    return
      &lt;section&gt;
         { $section/@* , $section/title , local:toc($section) }                 
      &lt;/section&gt;
};

&lt;toc&gt;
   {
     for $s in doc("book.xml")/book return local:toc($s)
   }
&lt;/toc&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;toc&gt;</span>
<span class='no'> 2</span>     <span class='ta'>&lt;section</span> <span class='an'>id</span>=<span class='s'><span class='dl'>"</span><span class='k'>intro</span><span class='dl'>"</span></span> <span class='an'>difficulty</span>=<span class='s'><span class='dl'>"</span><span class='k'>easy</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'> 3</span>         <span class='ta'>&lt;title&gt;</span>Introduction<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 4</span>         <span class='ta'>&lt;section&gt;</span>
<span class='no'> 5</span>             <span class='ta'>&lt;title&gt;</span>Audience<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 6</span>         <span class='ta'>&lt;/section&gt;</span>
<span class='no'> 7</span>         <span class='ta'>&lt;section&gt;</span>
<span class='no'> 8</span>             <span class='ta'>&lt;title&gt;</span>Web Data and the Two Cultures<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 9</span>         <span class='ta'>&lt;/section&gt;</span>
<span class='no'><strong>10</strong></span>     <span class='ta'>&lt;/section&gt;</span>
<span class='no'>11</span>     <span class='ta'>&lt;section</span> <span class='an'>id</span>=<span class='s'><span class='dl'>"</span><span class='k'>syntax</span><span class='dl'>"</span></span> <span class='an'>difficulty</span>=<span class='s'><span class='dl'>"</span><span class='k'>medium</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'>12</span>         <span class='ta'>&lt;title&gt;</span>A Syntax For Data<span class='ta'>&lt;/title&gt;</span>
<span class='no'>13</span>         <span class='ta'>&lt;section&gt;</span>
<span class='no'>14</span>             <span class='ta'>&lt;title&gt;</span>Base Types<span class='ta'>&lt;/title&gt;</span>
<span class='no'>15</span>         <span class='ta'>&lt;/section&gt;</span>
<span class='no'>16</span>         <span class='ta'>&lt;section&gt;</span>
<span class='no'>17</span>             <span class='ta'>&lt;title&gt;</span>Representing Relational Databases<span class='ta'>&lt;/title&gt;</span>
<span class='no'>18</span>         <span class='ta'>&lt;/section&gt;</span>
<span class='no'>19</span>         <span class='ta'>&lt;section&gt;</span>
<span class='no'><strong>20</strong></span>             <span class='ta'>&lt;title&gt;</span>Representing Object Databases<span class='ta'>&lt;/title&gt;</span>
<span class='no'>21</span>         <span class='ta'>&lt;/section&gt;</span>
<span class='no'>22</span>     <span class='ta'>&lt;/section&gt;</span>
<span class='no'>23</span> <span class='ta'>&lt;/toc&gt;</span>
</pre></div>
</div></div><div><h3><a name='tree-q2'>TREE - Q2</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>Prepare a (flat) figure list for Book1,
     listing all the figures and their titles.
     Preserve the original attributes of each &lt;figure&gt; element, if any.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='co'>XML</span>.figlist! {
<span class='no'>2</span>     <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>book.xml</span><span class='dl'>'</span></span>).descendants(<span class='sy'>:figure</span>) {|f|
<span class='no'>3</span>         figure!(f.attrs, f.children(<span class='sy'>:title</span>))
<span class='no'>4</span>     }
<span class='no'>5</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;figlist&gt;
  {
    for $f in doc("book.xml")//figure
    return
        &lt;figure&gt;
            { $f/@* }
            { $f/title }
        &lt;/figure&gt;
  }
&lt;/figlist&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;figlist&gt;</span>
<span class='no'> 2</span>     <span class='ta'>&lt;figure</span>  <span class='an'>height</span>=<span class='s'><span class='dl'>"</span><span class='k'>400</span><span class='dl'>"</span></span> <span class='an'>width</span>=<span class='s'><span class='dl'>"</span><span class='k'>400</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'> 3</span>         <span class='ta'>&lt;title&gt;</span>Traditional client/server architecture<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 4</span>     <span class='ta'>&lt;/figure&gt;</span>
<span class='no'> 5</span>     <span class='ta'>&lt;figure</span>  <span class='an'>height</span>=<span class='s'><span class='dl'>"</span><span class='k'>200</span><span class='dl'>"</span></span> <span class='an'>width</span>=<span class='s'><span class='dl'>"</span><span class='k'>500</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'> 6</span>         <span class='ta'>&lt;title&gt;</span>Graph representations of structures<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 7</span>     <span class='ta'>&lt;/figure&gt;</span>
<span class='no'> 8</span>     <span class='ta'>&lt;figure</span>  <span class='an'>height</span>=<span class='s'><span class='dl'>"</span><span class='k'>250</span><span class='dl'>"</span></span> <span class='an'>width</span> =<span class='s'><span class='dl'>"</span><span class='k'>400</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'> 9</span>         <span class='ta'>&lt;title&gt;</span>Examples of Relations<span class='ta'>&lt;/title&gt;</span>
<span class='no'><strong>10</strong></span>     <span class='ta'>&lt;/figure&gt;</span>
<span class='no'>11</span> <span class='ta'>&lt;/figlist&gt;</span>
</pre></div>
</div></div><div><h3><a name='tree-q3'>TREE - Q3</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>How many sections are in Book1, and how many figures?
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> doc = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>book.xml</span><span class='dl'>'</span></span>)
<span class='no'>2</span> 
<span class='no'>3</span> <span class='co'>XML</span>.section_count!(doc.descendants(<span class='sy'>:section</span>).size)
<span class='no'>4</span> <span class='co'>XML</span>.figure_count!(doc.descendants(<span class='sy'>:figure</span>).size)
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;section_count&gt;{ count(doc("book.xml")//section) }&lt;/section_count&gt;, 
&lt;figure_count&gt;{ count(doc("book.xml")//figure) }&lt;/figure_count&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='ta'>&lt;section_count&gt;</span>7<span class='ta'>&lt;/section_count&gt;</span>
<span class='no'>2</span> <span class='ta'>&lt;figure_count&gt;</span>3<span class='ta'>&lt;/figure_count&gt;</span>
</pre></div>
</div></div><div><h3><a name='tree-q4'>TREE - Q4</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>How many top-level sections are in Book1?
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='co'>XML</span>.top_section_count!(<span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>book.xml</span><span class='dl'>'</span></span>).children(<span class='sy'>:section</span>).size)
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;top_section_count&gt;
 { 
   count(doc("book.xml")/book/section) 
 }
&lt;/top_section_count&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='ta'>&lt;top_section_count&gt;</span>2<span class='ta'>&lt;/top_section_count&gt;</span>
</pre></div>
</div></div><div><h3><a name='tree-q5'>TREE - Q5</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>Make a flat list of the section elements in Book1.
     In place of its original attributes, each section
     element should have two attributes, containing the
     title of the section and the number of figures
     immediately contained in the section.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='co'>XML</span>.section_list! {
<span class='no'>2</span>     <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>book.xml</span><span class='dl'>'</span></span>).descendants(<span class='sy'>:section</span>) {|s|
<span class='no'>3</span>         section!({
<span class='no'>4</span>             <span class='sy'>:title</span> =&gt; s[<span class='sy'>:@title</span>],
<span class='no'>5</span>             <span class='sy'>:figcount</span> =&gt; s.children(<span class='sy'>:figure</span>).size,
<span class='no'>6</span>         })
<span class='no'>7</span>     }
<span class='no'>8</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;section_list&gt;
  {
    for $s in doc("book.xml")//section
    let $f := $s/figure
    return
        &lt;section title="{ $s/title/text() }" figcount="{ count($f) }"/&gt;
  }
&lt;/section_list&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;section_list&gt;</span>
<span class='no'> 2</span>     <span class='ta'>&lt;section</span> <span class='an'>title</span>=<span class='s'><span class='dl'>"</span><span class='k'>Introduction</span><span class='dl'>"</span></span> <span class='an'>figcount</span>=<span class='s'><span class='dl'>"</span><span class='k'>0</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>
<span class='no'> 3</span>     <span class='ta'>&lt;section</span> <span class='an'>title</span>=<span class='s'><span class='dl'>"</span><span class='k'>Audience</span><span class='dl'>"</span></span> <span class='an'>figcount</span>=<span class='s'><span class='dl'>"</span><span class='k'>0</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>
<span class='no'> 4</span>     <span class='ta'>&lt;section</span> <span class='an'>title</span>=<span class='s'><span class='dl'>"</span><span class='k'>Web Data and the Two Cultures</span><span class='dl'>"</span></span> <span class='an'>figcount</span>=<span class='s'><span class='dl'>"</span><span class='k'>1</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>
<span class='no'> 5</span>     <span class='ta'>&lt;section</span> <span class='an'>title</span>=<span class='s'><span class='dl'>"</span><span class='k'>A Syntax For Data</span><span class='dl'>"</span></span> <span class='an'>figcount</span>=<span class='s'><span class='dl'>"</span><span class='k'>1</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>
<span class='no'> 6</span>     <span class='ta'>&lt;section</span> <span class='an'>title</span>=<span class='s'><span class='dl'>"</span><span class='k'>Base Types</span><span class='dl'>"</span></span> <span class='an'>figcount</span>=<span class='s'><span class='dl'>"</span><span class='k'>0</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>
<span class='no'> 7</span>     <span class='ta'>&lt;section</span> <span class='an'>title</span>=<span class='s'><span class='dl'>"</span><span class='k'>Representing Relational Databases</span><span class='dl'>"</span></span> <span class='an'>figcount</span>=<span class='s'><span class='dl'>"</span><span class='k'>1</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>
<span class='no'> 8</span>     <span class='ta'>&lt;section</span> <span class='an'>title</span>=<span class='s'><span class='dl'>"</span><span class='k'>Representing Object Databases</span><span class='dl'>"</span></span> <span class='an'>figcount</span>=<span class='s'><span class='dl'>"</span><span class='k'>0</span><span class='dl'>"</span></span><span class='ta'>/&gt;</span>
<span class='no'> 9</span> <span class='ta'>&lt;/section_list&gt;</span>
</pre></div>
</div></div><div><h3><a name='tree-q6'>TREE - Q6</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>Make a nested list of the section elements in Book1,
     preserving their original attributes and hierarchy.
     Inside each section element, include the title of the
     section and an element that includes the number of
     figures immediately contained in the section.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='r'>def</span> <span class='fu'>section_summary</span>(s)
<span class='no'> 2</span>     <span class='co'>XML</span>.section(s.attrs) {
<span class='no'> 3</span>         add! s.child(<span class='sy'>:title</span>)
<span class='no'> 4</span>         figcount! s.children(<span class='sy'>:figure</span>).size
<span class='no'> 5</span>         add! s.children(<span class='sy'>:section</span>).map{|c| section_summary(c)}
<span class='no'> 6</span>     }
<span class='no'> 7</span> <span class='r'>end</span>
<span class='no'> 8</span> 
<span class='no'> 9</span> <span class='co'>XML</span>.toc! {
<span class='no'><strong>10</strong></span>     <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>book.xml</span><span class='dl'>'</span></span>).children(<span class='sy'>:section</span>) {|s|
<span class='no'>11</span>         add! section_summary(s)
<span class='no'>12</span>     }
<span class='no'>13</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>declare function local:section-summary($book-or-section as element()*)
  as element()*
{
  for $section in $book-or-section
  return
    &lt;section&gt;
       { $section/@* }
       { $section/title }       
       &lt;figcount&gt;         
         { count($section/figure) }
       &lt;/figcount&gt;                
       { local:section-summary($section/section) }                      
    &lt;/section&gt;
};

&lt;toc&gt;
  {
    for $s in doc("book.xml")/book/section
    return local:section-summary($s)
  }
&lt;/toc&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;toc&gt;</span>
<span class='no'> 2</span>     <span class='ta'>&lt;section</span> <span class='an'>id</span>=<span class='s'><span class='dl'>"</span><span class='k'>intro</span><span class='dl'>"</span></span> <span class='an'>difficulty</span>=<span class='s'><span class='dl'>"</span><span class='k'>easy</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'> 3</span>         <span class='ta'>&lt;title&gt;</span>Introduction<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 4</span>         <span class='ta'>&lt;figcount&gt;</span>0<span class='ta'>&lt;/figcount&gt;</span>
<span class='no'> 5</span>         <span class='ta'>&lt;section&gt;</span>
<span class='no'> 6</span>             <span class='ta'>&lt;title&gt;</span>Audience<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 7</span>             <span class='ta'>&lt;figcount&gt;</span>0<span class='ta'>&lt;/figcount&gt;</span>
<span class='no'> 8</span>         <span class='ta'>&lt;/section&gt;</span>
<span class='no'> 9</span>         <span class='ta'>&lt;section&gt;</span>
<span class='no'><strong>10</strong></span>             <span class='ta'>&lt;title&gt;</span>Web Data and the Two Cultures<span class='ta'>&lt;/title&gt;</span>
<span class='no'>11</span>             <span class='ta'>&lt;figcount&gt;</span>1<span class='ta'>&lt;/figcount&gt;</span>
<span class='no'>12</span>         <span class='ta'>&lt;/section&gt;</span>
<span class='no'>13</span>     <span class='ta'>&lt;/section&gt;</span>
<span class='no'>14</span>     <span class='ta'>&lt;section</span> <span class='an'>id</span>=<span class='s'><span class='dl'>"</span><span class='k'>syntax</span><span class='dl'>"</span></span> <span class='an'>difficulty</span>=<span class='s'><span class='dl'>"</span><span class='k'>medium</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'>15</span>         <span class='ta'>&lt;title&gt;</span>A Syntax For Data<span class='ta'>&lt;/title&gt;</span>
<span class='no'>16</span>         <span class='ta'>&lt;figcount&gt;</span>1<span class='ta'>&lt;/figcount&gt;</span>
<span class='no'>17</span>         <span class='ta'>&lt;section&gt;</span>
<span class='no'>18</span>             <span class='ta'>&lt;title&gt;</span>Base Types<span class='ta'>&lt;/title&gt;</span>
<span class='no'>19</span>             <span class='ta'>&lt;figcount&gt;</span>0<span class='ta'>&lt;/figcount&gt;</span>
<span class='no'><strong>20</strong></span>         <span class='ta'>&lt;/section&gt;</span>
<span class='no'>21</span>         <span class='ta'>&lt;section&gt;</span>
<span class='no'>22</span>             <span class='ta'>&lt;title&gt;</span>Representing Relational Databases<span class='ta'>&lt;/title&gt;</span>
<span class='no'>23</span>             <span class='ta'>&lt;figcount&gt;</span>1<span class='ta'>&lt;/figcount&gt;</span>
<span class='no'>24</span>         <span class='ta'>&lt;/section&gt;</span>
<span class='no'>25</span>         <span class='ta'>&lt;section&gt;</span>
<span class='no'>26</span>             <span class='ta'>&lt;title&gt;</span>Representing Object Databases<span class='ta'>&lt;/title&gt;</span>
<span class='no'>27</span>             <span class='ta'>&lt;figcount&gt;</span>0<span class='ta'>&lt;/figcount&gt;</span>
<span class='no'>28</span>         <span class='ta'>&lt;/section&gt;</span>
<span class='no'>29</span>     <span class='ta'>&lt;/section&gt;</span>
<span class='no'><strong>30</strong></span> <span class='ta'>&lt;/toc&gt;</span>
</pre></div>
</div></div><div><h3><a name='xmp-bib.xml'>Input for XMP - bib.xml</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;bib&gt;</span>
<span class='no'> 2</span>     <span class='ta'>&lt;book</span> <span class='an'>year</span>=<span class='s'><span class='dl'>"</span><span class='k'>1994</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'> 3</span>         <span class='ta'>&lt;title&gt;</span>TCP/IP Illustrated<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 4</span>         <span class='ta'>&lt;author&gt;</span><span class='ta'>&lt;last&gt;</span>Stevens<span class='ta'>&lt;/last&gt;</span><span class='ta'>&lt;first&gt;</span>W.<span class='ta'>&lt;/first&gt;</span><span class='ta'>&lt;/author&gt;</span>
<span class='no'> 5</span>         <span class='ta'>&lt;publisher&gt;</span>Addison-Wesley<span class='ta'>&lt;/publisher&gt;</span>
<span class='no'> 6</span>         <span class='ta'>&lt;price&gt;</span>65.95<span class='ta'>&lt;/price&gt;</span>
<span class='no'> 7</span>     <span class='ta'>&lt;/book&gt;</span>
<span class='no'> 8</span>  
<span class='no'> 9</span>     <span class='ta'>&lt;book</span> <span class='an'>year</span>=<span class='s'><span class='dl'>"</span><span class='k'>1992</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'><strong>10</strong></span>         <span class='ta'>&lt;title&gt;</span>Advanced Programming in the Unix environment<span class='ta'>&lt;/title&gt;</span>
<span class='no'>11</span>         <span class='ta'>&lt;author&gt;</span><span class='ta'>&lt;last&gt;</span>Stevens<span class='ta'>&lt;/last&gt;</span><span class='ta'>&lt;first&gt;</span>W.<span class='ta'>&lt;/first&gt;</span><span class='ta'>&lt;/author&gt;</span>
<span class='no'>12</span>         <span class='ta'>&lt;publisher&gt;</span>Addison-Wesley<span class='ta'>&lt;/publisher&gt;</span>
<span class='no'>13</span>         <span class='ta'>&lt;price&gt;</span>65.95<span class='ta'>&lt;/price&gt;</span>
<span class='no'>14</span>     <span class='ta'>&lt;/book&gt;</span>
<span class='no'>15</span>  
<span class='no'>16</span>     <span class='ta'>&lt;book</span> <span class='an'>year</span>=<span class='s'><span class='dl'>"</span><span class='k'>2000</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'>17</span>         <span class='ta'>&lt;title&gt;</span>Data on the Web<span class='ta'>&lt;/title&gt;</span>
<span class='no'>18</span>         <span class='ta'>&lt;author&gt;</span><span class='ta'>&lt;last&gt;</span>Abiteboul<span class='ta'>&lt;/last&gt;</span><span class='ta'>&lt;first&gt;</span>Serge<span class='ta'>&lt;/first&gt;</span><span class='ta'>&lt;/author&gt;</span>
<span class='no'>19</span>         <span class='ta'>&lt;author&gt;</span><span class='ta'>&lt;last&gt;</span>Buneman<span class='ta'>&lt;/last&gt;</span><span class='ta'>&lt;first&gt;</span>Peter<span class='ta'>&lt;/first&gt;</span><span class='ta'>&lt;/author&gt;</span>
<span class='no'><strong>20</strong></span>         <span class='ta'>&lt;author&gt;</span><span class='ta'>&lt;last&gt;</span>Suciu<span class='ta'>&lt;/last&gt;</span><span class='ta'>&lt;first&gt;</span>Dan<span class='ta'>&lt;/first&gt;</span><span class='ta'>&lt;/author&gt;</span>
<span class='no'>21</span>         <span class='ta'>&lt;publisher&gt;</span>Morgan Kaufmann Publishers<span class='ta'>&lt;/publisher&gt;</span>
<span class='no'>22</span>         <span class='ta'>&lt;price&gt;</span>39.95<span class='ta'>&lt;/price&gt;</span>
<span class='no'>23</span>     <span class='ta'>&lt;/book&gt;</span>
<span class='no'>24</span>  
<span class='no'>25</span>     <span class='ta'>&lt;book</span> <span class='an'>year</span>=<span class='s'><span class='dl'>"</span><span class='k'>1999</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'>26</span>         <span class='ta'>&lt;title&gt;</span>The Economics of Technology and Content for Digital TV<span class='ta'>&lt;/title&gt;</span>
<span class='no'>27</span>         <span class='ta'>&lt;editor&gt;</span>
<span class='no'>28</span>                <span class='ta'>&lt;last&gt;</span>Gerbarg<span class='ta'>&lt;/last&gt;</span><span class='ta'>&lt;first&gt;</span>Darcy<span class='ta'>&lt;/first&gt;</span>
<span class='no'>29</span>                 <span class='ta'>&lt;affiliation&gt;</span>CITI<span class='ta'>&lt;/affiliation&gt;</span>
<span class='no'><strong>30</strong></span>         <span class='ta'>&lt;/editor&gt;</span>
<span class='no'>31</span>             <span class='ta'>&lt;publisher&gt;</span>Kluwer Academic Publishers<span class='ta'>&lt;/publisher&gt;</span>
<span class='no'>32</span>         <span class='ta'>&lt;price&gt;</span>129.95<span class='ta'>&lt;/price&gt;</span>
<span class='no'>33</span>     <span class='ta'>&lt;/book&gt;</span>
<span class='no'>34</span>  
<span class='no'>35</span> <span class='ta'>&lt;/bib&gt;</span>
</pre></div>
</div></div><div><h3><a name='xmp-books.xml'>Input for XMP - books.xml</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;chapter&gt;</span>
<span class='no'> 2</span>     <span class='ta'>&lt;title&gt;</span>Data Model<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 3</span>     <span class='ta'>&lt;section&gt;</span>
<span class='no'> 4</span>         <span class='ta'>&lt;title&gt;</span>Syntax For Data Model<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 5</span>     <span class='ta'>&lt;/section&gt;</span>
<span class='no'> 6</span>     <span class='ta'>&lt;section&gt;</span>
<span class='no'> 7</span>         <span class='ta'>&lt;title&gt;</span>XML<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 8</span>         <span class='ta'>&lt;section&gt;</span>
<span class='no'> 9</span>             <span class='ta'>&lt;title&gt;</span>Basic Syntax<span class='ta'>&lt;/title&gt;</span>
<span class='no'><strong>10</strong></span>         <span class='ta'>&lt;/section&gt;</span>
<span class='no'>11</span>         <span class='ta'>&lt;section&gt;</span>
<span class='no'>12</span>             <span class='ta'>&lt;title&gt;</span>XML and Semistructured Data<span class='ta'>&lt;/title&gt;</span>
<span class='no'>13</span>         <span class='ta'>&lt;/section&gt;</span>
<span class='no'>14</span>     <span class='ta'>&lt;/section&gt;</span>
<span class='no'>15</span> <span class='ta'>&lt;/chapter&gt;</span>
</pre></div>
</div></div><div><h3><a name='xmp-prices.xml'>Input for XMP - prices.xml</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;prices&gt;</span>
<span class='no'> 2</span>     <span class='ta'>&lt;book&gt;</span>
<span class='no'> 3</span>         <span class='ta'>&lt;title&gt;</span>Advanced Programming in the Unix environment<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 4</span>         <span class='ta'>&lt;source&gt;</span>bstore2.example.com<span class='ta'>&lt;/source&gt;</span>
<span class='no'> 5</span>         <span class='ta'>&lt;price&gt;</span>65.95<span class='ta'>&lt;/price&gt;</span>
<span class='no'> 6</span>     <span class='ta'>&lt;/book&gt;</span>
<span class='no'> 7</span>     <span class='ta'>&lt;book&gt;</span>
<span class='no'> 8</span>         <span class='ta'>&lt;title&gt;</span>Advanced Programming in the Unix environment<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 9</span>         <span class='ta'>&lt;source&gt;</span>bstore1.example.com<span class='ta'>&lt;/source&gt;</span>
<span class='no'><strong>10</strong></span>         <span class='ta'>&lt;price&gt;</span>65.95<span class='ta'>&lt;/price&gt;</span>
<span class='no'>11</span>     <span class='ta'>&lt;/book&gt;</span>
<span class='no'>12</span>     <span class='ta'>&lt;book&gt;</span>
<span class='no'>13</span>         <span class='ta'>&lt;title&gt;</span>TCP/IP Illustrated<span class='ta'>&lt;/title&gt;</span>
<span class='no'>14</span>         <span class='ta'>&lt;source&gt;</span>bstore2.example.com<span class='ta'>&lt;/source&gt;</span>
<span class='no'>15</span>         <span class='ta'>&lt;price&gt;</span>65.95<span class='ta'>&lt;/price&gt;</span>
<span class='no'>16</span>     <span class='ta'>&lt;/book&gt;</span>
<span class='no'>17</span>     <span class='ta'>&lt;book&gt;</span>
<span class='no'>18</span>         <span class='ta'>&lt;title&gt;</span>TCP/IP Illustrated<span class='ta'>&lt;/title&gt;</span>
<span class='no'>19</span>         <span class='ta'>&lt;source&gt;</span>bstore1.example.com<span class='ta'>&lt;/source&gt;</span>
<span class='no'><strong>20</strong></span>         <span class='ta'>&lt;price&gt;</span>65.95<span class='ta'>&lt;/price&gt;</span>
<span class='no'>21</span>     <span class='ta'>&lt;/book&gt;</span>
<span class='no'>22</span>     <span class='ta'>&lt;book&gt;</span>
<span class='no'>23</span>         <span class='ta'>&lt;title&gt;</span>Data on the Web<span class='ta'>&lt;/title&gt;</span>
<span class='no'>24</span>         <span class='ta'>&lt;source&gt;</span>bstore2.example.com<span class='ta'>&lt;/source&gt;</span>
<span class='no'>25</span>         <span class='ta'>&lt;price&gt;</span>34.95<span class='ta'>&lt;/price&gt;</span>
<span class='no'>26</span>     <span class='ta'>&lt;/book&gt;</span>
<span class='no'>27</span>     <span class='ta'>&lt;book&gt;</span>
<span class='no'>28</span>         <span class='ta'>&lt;title&gt;</span>Data on the Web<span class='ta'>&lt;/title&gt;</span>
<span class='no'>29</span>         <span class='ta'>&lt;source&gt;</span>bstore1.example.com<span class='ta'>&lt;/source&gt;</span>
<span class='no'><strong>30</strong></span>         <span class='ta'>&lt;price&gt;</span>39.95<span class='ta'>&lt;/price&gt;</span>
<span class='no'>31</span>     <span class='ta'>&lt;/book&gt;</span>
<span class='no'>32</span> <span class='ta'>&lt;/prices&gt;</span>
</pre></div>
</div></div><div><h3><a name='xmp-reviews.xml'>Input for XMP - reviews.xml</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;reviews&gt;</span>
<span class='no'> 2</span>     <span class='ta'>&lt;entry&gt;</span>
<span class='no'> 3</span>         <span class='ta'>&lt;title&gt;</span>Data on the Web<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 4</span>         <span class='ta'>&lt;price&gt;</span>34.95<span class='ta'>&lt;/price&gt;</span>
<span class='no'> 5</span>         <span class='ta'>&lt;review&gt;</span>
<span class='no'> 6</span>                A very good discussion of semi-structured database
<span class='no'> 7</span>                systems and XML.
<span class='no'> 8</span>         <span class='ta'>&lt;/review&gt;</span>
<span class='no'> 9</span>     <span class='ta'>&lt;/entry&gt;</span>
<span class='no'><strong>10</strong></span>     <span class='ta'>&lt;entry&gt;</span>
<span class='no'>11</span>         <span class='ta'>&lt;title&gt;</span>Advanced Programming in the Unix environment<span class='ta'>&lt;/title&gt;</span>
<span class='no'>12</span>         <span class='ta'>&lt;price&gt;</span>65.95<span class='ta'>&lt;/price&gt;</span>
<span class='no'>13</span>         <span class='ta'>&lt;review&gt;</span>
<span class='no'>14</span>                A clear and detailed discussion of UNIX programming.
<span class='no'>15</span>         <span class='ta'>&lt;/review&gt;</span>
<span class='no'>16</span>     <span class='ta'>&lt;/entry&gt;</span>
<span class='no'>17</span>     <span class='ta'>&lt;entry&gt;</span>
<span class='no'>18</span>         <span class='ta'>&lt;title&gt;</span>TCP/IP Illustrated<span class='ta'>&lt;/title&gt;</span>
<span class='no'>19</span>         <span class='ta'>&lt;price&gt;</span>65.95<span class='ta'>&lt;/price&gt;</span>
<span class='no'><strong>20</strong></span>         <span class='ta'>&lt;review&gt;</span>
<span class='no'>21</span>                One of the best books on TCP/IP.
<span class='no'>22</span>         <span class='ta'>&lt;/review&gt;</span>
<span class='no'>23</span>     <span class='ta'>&lt;/entry&gt;</span>
<span class='no'>24</span> <span class='ta'>&lt;/reviews&gt;</span>
</pre></div>
</div></div><div><h3><a name='xmp-q1'>XMP - Q1</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>List books published by Addison-Wesley after 1991,
     including their year and title.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='co'>XML</span>.bib! {
<span class='no'>2</span>     <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>bib.xml</span><span class='dl'>'</span></span>).children(<span class='sy'>:book</span>) {|b|
<span class='no'>3</span>         <span class='r'>if</span> b[<span class='sy'>:@publisher</span>] == <span class='s'><span class='dl'>"</span><span class='k'>Addison-Wesley</span><span class='dl'>"</span></span> <span class='r'>and</span> b[<span class='sy'>:year</span>].to_i &gt; <span class='i'>1991</span>
<span class='no'>4</span>             book!({<span class='sy'>:year</span> =&gt; b[<span class='sy'>:year</span>]}, b.child(<span class='sy'>:title</span>))
<span class='no'>5</span>         <span class='r'>end</span>
<span class='no'>6</span>     }
<span class='no'>7</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;bib&gt;
 {
  for $b in doc("http://bstore1.example.com/bib.xml")/bib/book
  where $b/publisher = "Addison-Wesley" and $b/@year &gt; 1991
  return
    &lt;book year="{ $b/@year }"&gt;
     { $b/title }
    &lt;/book&gt;
 }
&lt;/bib&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='ta'>&lt;bib&gt;</span>
<span class='no'>2</span>     <span class='ta'>&lt;book</span> <span class='an'>year</span>=<span class='s'><span class='dl'>"</span><span class='k'>1994</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'>3</span>         <span class='ta'>&lt;title&gt;</span>TCP/IP Illustrated<span class='ta'>&lt;/title&gt;</span>
<span class='no'>4</span>     <span class='ta'>&lt;/book&gt;</span>
<span class='no'>5</span>     <span class='ta'>&lt;book</span> <span class='an'>year</span>=<span class='s'><span class='dl'>"</span><span class='k'>1992</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'>6</span>         <span class='ta'>&lt;title&gt;</span>Advanced Programming in the Unix environment<span class='ta'>&lt;/title&gt;</span>
<span class='no'>7</span>     <span class='ta'>&lt;/book&gt;</span>
<span class='no'>8</span> <span class='ta'>&lt;/bib&gt;</span>
</pre></div>
</div></div><div><h3><a name='xmp-q2'>XMP - Q2</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>Create a flat list of all the title-author pairs,
     with each pair enclosed in a "result" element.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='co'>XML</span>.results! {
<span class='no'>2</span>     <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>bib.xml</span><span class='dl'>'</span></span>).children(<span class='sy'>:book</span>) {|b|
<span class='no'>3</span>         t = b.child(<span class='sy'>:title</span>)
<span class='no'>4</span>         b.children(<span class='sy'>:author</span>) {|a|
<span class='no'>5</span>             result!(t,a)
<span class='no'>6</span>         }
<span class='no'>7</span>     }
<span class='no'>8</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;results&gt;
  {
    for $b in doc("http://bstore1.example.com/bib.xml")/bib/book,
        $t in $b/title,
        $a in $b/author
    return
        &lt;result&gt;
            { $t }    
            { $a }
        &lt;/result&gt;
  }
&lt;/results&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;results&gt;</span>
<span class='no'> 2</span>     <span class='ta'>&lt;result&gt;</span>
<span class='no'> 3</span>         <span class='ta'>&lt;title&gt;</span>TCP/IP Illustrated<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 4</span>         <span class='ta'>&lt;author&gt;</span>
<span class='no'> 5</span>             <span class='ta'>&lt;last&gt;</span>Stevens<span class='ta'>&lt;/last&gt;</span>
<span class='no'> 6</span>             <span class='ta'>&lt;first&gt;</span>W.<span class='ta'>&lt;/first&gt;</span>
<span class='no'> 7</span>         <span class='ta'>&lt;/author&gt;</span>
<span class='no'> 8</span>     <span class='ta'>&lt;/result&gt;</span>
<span class='no'> 9</span>     <span class='ta'>&lt;result&gt;</span>
<span class='no'><strong>10</strong></span>         <span class='ta'>&lt;title&gt;</span>Advanced Programming in the Unix environment<span class='ta'>&lt;/title&gt;</span>
<span class='no'>11</span>         <span class='ta'>&lt;author&gt;</span>
<span class='no'>12</span>             <span class='ta'>&lt;last&gt;</span>Stevens<span class='ta'>&lt;/last&gt;</span>
<span class='no'>13</span>             <span class='ta'>&lt;first&gt;</span>W.<span class='ta'>&lt;/first&gt;</span>
<span class='no'>14</span>         <span class='ta'>&lt;/author&gt;</span>
<span class='no'>15</span>     <span class='ta'>&lt;/result&gt;</span>
<span class='no'>16</span>     <span class='ta'>&lt;result&gt;</span>
<span class='no'>17</span>         <span class='ta'>&lt;title&gt;</span>Data on the Web<span class='ta'>&lt;/title&gt;</span>
<span class='no'>18</span>         <span class='ta'>&lt;author&gt;</span>
<span class='no'>19</span>             <span class='ta'>&lt;last&gt;</span>Abiteboul<span class='ta'>&lt;/last&gt;</span>
<span class='no'><strong>20</strong></span>             <span class='ta'>&lt;first&gt;</span>Serge<span class='ta'>&lt;/first&gt;</span>
<span class='no'>21</span>         <span class='ta'>&lt;/author&gt;</span>
<span class='no'>22</span>     <span class='ta'>&lt;/result&gt;</span>
<span class='no'>23</span>     <span class='ta'>&lt;result&gt;</span>
<span class='no'>24</span>         <span class='ta'>&lt;title&gt;</span>Data on the Web<span class='ta'>&lt;/title&gt;</span>
<span class='no'>25</span>         <span class='ta'>&lt;author&gt;</span>
<span class='no'>26</span>             <span class='ta'>&lt;last&gt;</span>Buneman<span class='ta'>&lt;/last&gt;</span>
<span class='no'>27</span>             <span class='ta'>&lt;first&gt;</span>Peter<span class='ta'>&lt;/first&gt;</span>
<span class='no'>28</span>         <span class='ta'>&lt;/author&gt;</span>
<span class='no'>29</span>     <span class='ta'>&lt;/result&gt;</span>
<span class='no'><strong>30</strong></span>     <span class='ta'>&lt;result&gt;</span>
<span class='no'>31</span>         <span class='ta'>&lt;title&gt;</span>Data on the Web<span class='ta'>&lt;/title&gt;</span>
<span class='no'>32</span>         <span class='ta'>&lt;author&gt;</span>
<span class='no'>33</span>             <span class='ta'>&lt;last&gt;</span>Suciu<span class='ta'>&lt;/last&gt;</span>
<span class='no'>34</span>             <span class='ta'>&lt;first&gt;</span>Dan<span class='ta'>&lt;/first&gt;</span>
<span class='no'>35</span>         <span class='ta'>&lt;/author&gt;</span>
<span class='no'>36</span>     <span class='ta'>&lt;/result&gt;</span>
<span class='no'>37</span> <span class='ta'>&lt;/results&gt;</span>
</pre></div>
</div></div><div><h3><a name='xmp-q3'>XMP - Q3</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>For each book in the bibliography, list the title and
     authors, grouped inside a "result" element.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='co'>XML</span>.results! {
<span class='no'>2</span>     <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>bib.xml</span><span class='dl'>'</span></span>).children(<span class='sy'>:book</span>) {|b|
<span class='no'>3</span>         result!(b.children(<span class='sy'>:title</span>), b.children(<span class='sy'>:author</span>))
<span class='no'>4</span>     }
<span class='no'>5</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;results&gt;
{
    for $b in doc("http://bstore1.example.com/bib.xml")/bib/book
    return
        &lt;result&gt;
            { $b/title }
            { $b/author  }
        &lt;/result&gt;
}
&lt;/results&gt; 
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;results&gt;</span>
<span class='no'> 2</span>     <span class='ta'>&lt;result&gt;</span>
<span class='no'> 3</span>         <span class='ta'>&lt;title&gt;</span>TCP/IP Illustrated<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 4</span>         <span class='ta'>&lt;author&gt;</span>
<span class='no'> 5</span>             <span class='ta'>&lt;last&gt;</span>Stevens<span class='ta'>&lt;/last&gt;</span>
<span class='no'> 6</span>             <span class='ta'>&lt;first&gt;</span>W.<span class='ta'>&lt;/first&gt;</span>
<span class='no'> 7</span>         <span class='ta'>&lt;/author&gt;</span>
<span class='no'> 8</span>     <span class='ta'>&lt;/result&gt;</span>
<span class='no'> 9</span>     <span class='ta'>&lt;result&gt;</span>
<span class='no'><strong>10</strong></span>         <span class='ta'>&lt;title&gt;</span>Advanced Programming in the Unix environment<span class='ta'>&lt;/title&gt;</span>
<span class='no'>11</span>         <span class='ta'>&lt;author&gt;</span>
<span class='no'>12</span>             <span class='ta'>&lt;last&gt;</span>Stevens<span class='ta'>&lt;/last&gt;</span>
<span class='no'>13</span>             <span class='ta'>&lt;first&gt;</span>W.<span class='ta'>&lt;/first&gt;</span>
<span class='no'>14</span>         <span class='ta'>&lt;/author&gt;</span>
<span class='no'>15</span>     <span class='ta'>&lt;/result&gt;</span>
<span class='no'>16</span>     <span class='ta'>&lt;result&gt;</span>
<span class='no'>17</span>         <span class='ta'>&lt;title&gt;</span>Data on the Web<span class='ta'>&lt;/title&gt;</span>
<span class='no'>18</span>         <span class='ta'>&lt;author&gt;</span>
<span class='no'>19</span>             <span class='ta'>&lt;last&gt;</span>Abiteboul<span class='ta'>&lt;/last&gt;</span>
<span class='no'><strong>20</strong></span>             <span class='ta'>&lt;first&gt;</span>Serge<span class='ta'>&lt;/first&gt;</span>
<span class='no'>21</span>         <span class='ta'>&lt;/author&gt;</span>
<span class='no'>22</span>         <span class='ta'>&lt;author&gt;</span>
<span class='no'>23</span>             <span class='ta'>&lt;last&gt;</span>Buneman<span class='ta'>&lt;/last&gt;</span>
<span class='no'>24</span>             <span class='ta'>&lt;first&gt;</span>Peter<span class='ta'>&lt;/first&gt;</span>
<span class='no'>25</span>         <span class='ta'>&lt;/author&gt;</span>
<span class='no'>26</span>         <span class='ta'>&lt;author&gt;</span>
<span class='no'>27</span>             <span class='ta'>&lt;last&gt;</span>Suciu<span class='ta'>&lt;/last&gt;</span>
<span class='no'>28</span>             <span class='ta'>&lt;first&gt;</span>Dan<span class='ta'>&lt;/first&gt;</span>
<span class='no'>29</span>         <span class='ta'>&lt;/author&gt;</span>
<span class='no'><strong>30</strong></span>     <span class='ta'>&lt;/result&gt;</span>
<span class='no'>31</span>     <span class='ta'>&lt;result&gt;</span>
<span class='no'>32</span>         <span class='ta'>&lt;title&gt;</span>The Economics of Technology and Content for Digital TV<span class='ta'>&lt;/title&gt;</span>
<span class='no'>33</span>     <span class='ta'>&lt;/result&gt;</span>
<span class='no'>34</span> <span class='ta'>&lt;/results&gt;</span>
</pre></div>
</div></div><div><h3><a name='xmp-q4'>XMP - Q4</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>For each author in the bibliography, list the author's
     name and the titles of all books by that author,
     grouped inside a "result" element.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='co'>XML</span>.results! {
<span class='no'> 2</span>     doc = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>bib.xml</span><span class='dl'>'</span></span>)
<span class='no'> 3</span>     a = doc.descendants(<span class='sy'>:author</span>)
<span class='no'> 4</span>     books = doc.children(<span class='sy'>:book</span>)
<span class='no'> 5</span> 
<span class='no'> 6</span>     a.map{|node| 
<span class='no'> 7</span>         [node[<span class='sy'>:@last</span>], node[<span class='sy'>:@first</span>]]
<span class='no'> 8</span>     }.uniq.sort.each {|last, first|
<span class='no'> 9</span>         result! {
<span class='no'><strong>10</strong></span>             author! {
<span class='no'>11</span>                 last! last
<span class='no'>12</span>                 first! first
<span class='no'>13</span>             }
<span class='no'>14</span>             books.each{|b|
<span class='no'>15</span>                 <span class='r'>next</span> <span class='r'>unless</span> b.children(<span class='sy'>:author</span>).any?{|ba|
<span class='no'>16</span>                     ba[<span class='sy'>:@last</span>] == last <span class='r'>and</span> ba[<span class='sy'>:@first</span>] == first
<span class='no'>17</span>                 }
<span class='no'>18</span>                 add! b.children(<span class='sy'>:title</span>)
<span class='no'>19</span>             }
<span class='no'><strong>20</strong></span>         }
<span class='no'>21</span>     }
<span class='no'>22</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;results&gt;
  {
    let $a := doc("http://bstore1.example.com/bib/bib.xml")//author
    for $last in distinct-values($a/last),
        $first in distinct-values($a[last=$last]/first)
    order by $last, $first
    return
        &lt;result&gt;
            &lt;author&gt;
               &lt;last&gt;{ $last }&lt;/last&gt;
               &lt;first&gt;{ $first }&lt;/first&gt;
            &lt;/author&gt;
            {
                for $b in doc("http://bstore1.example.com/bib.xml")/bib/book
                where some $ba in $b/author 
                      satisfies ($ba/last = $last and $ba/first=$first)
                return $b/title
            }
        &lt;/result&gt;
  }
&lt;/results&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;results&gt;</span>
<span class='no'> 2</span>     <span class='ta'>&lt;result&gt;</span>
<span class='no'> 3</span>         <span class='ta'>&lt;author&gt;</span>
<span class='no'> 4</span>             <span class='ta'>&lt;last&gt;</span>Abiteboul<span class='ta'>&lt;/last&gt;</span>
<span class='no'> 5</span>             <span class='ta'>&lt;first&gt;</span>Serge<span class='ta'>&lt;/first&gt;</span>
<span class='no'> 6</span>         <span class='ta'>&lt;/author&gt;</span>
<span class='no'> 7</span>         <span class='ta'>&lt;title&gt;</span>Data on the Web<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 8</span>     <span class='ta'>&lt;/result&gt;</span>
<span class='no'> 9</span>     <span class='ta'>&lt;result&gt;</span>
<span class='no'><strong>10</strong></span>         <span class='ta'>&lt;author&gt;</span>
<span class='no'>11</span>             <span class='ta'>&lt;last&gt;</span>Buneman<span class='ta'>&lt;/last&gt;</span>
<span class='no'>12</span>             <span class='ta'>&lt;first&gt;</span>Peter<span class='ta'>&lt;/first&gt;</span>
<span class='no'>13</span>         <span class='ta'>&lt;/author&gt;</span>
<span class='no'>14</span>         <span class='ta'>&lt;title&gt;</span>Data on the Web<span class='ta'>&lt;/title&gt;</span>
<span class='no'>15</span>     <span class='ta'>&lt;/result&gt;</span>
<span class='no'>16</span>     <span class='ta'>&lt;result&gt;</span>
<span class='no'>17</span>         <span class='ta'>&lt;author&gt;</span>
<span class='no'>18</span>             <span class='ta'>&lt;last&gt;</span>Stevens<span class='ta'>&lt;/last&gt;</span>
<span class='no'>19</span>             <span class='ta'>&lt;first&gt;</span>W.<span class='ta'>&lt;/first&gt;</span>
<span class='no'><strong>20</strong></span>         <span class='ta'>&lt;/author&gt;</span>
<span class='no'>21</span>         <span class='ta'>&lt;title&gt;</span>TCP/IP Illustrated<span class='ta'>&lt;/title&gt;</span>
<span class='no'>22</span>         <span class='ta'>&lt;title&gt;</span>Advanced Programming in the Unix environment<span class='ta'>&lt;/title&gt;</span>
<span class='no'>23</span>     <span class='ta'>&lt;/result&gt;</span>
<span class='no'>24</span>     <span class='ta'>&lt;result&gt;</span>
<span class='no'>25</span>         <span class='ta'>&lt;author&gt;</span>
<span class='no'>26</span>             <span class='ta'>&lt;last&gt;</span>Suciu<span class='ta'>&lt;/last&gt;</span>
<span class='no'>27</span>             <span class='ta'>&lt;first&gt;</span>Dan<span class='ta'>&lt;/first&gt;</span>
<span class='no'>28</span>         <span class='ta'>&lt;/author&gt;</span>
<span class='no'>29</span>         <span class='ta'>&lt;title&gt;</span>Data on the Web<span class='ta'>&lt;/title&gt;</span>
<span class='no'><strong>30</strong></span>     <span class='ta'>&lt;/result&gt;</span>
<span class='no'>31</span> <span class='ta'>&lt;/results&gt;</span>
</pre></div>
</div></div><div><h3><a name='xmp-q5'>XMP - Q5</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>For each book found at both bstore1.example.com and
     bstore2.example.com, list the title of the book and
     its price from each source.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> xml!(<span class='sy'><span class='sy'>:</span><span class='dl'>"</span><span class='k'>books-with-prices</span><span class='dl'>"</span></span>) {
<span class='no'> 2</span>     books = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>"</span><span class='k'>bib.xml</span><span class='dl'>"</span></span>).descendants(<span class='sy'>:book</span>)
<span class='no'> 3</span>     entries = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>"</span><span class='k'>reviews.xml</span><span class='dl'>"</span></span>).descendants(<span class='sy'>:entry</span>)
<span class='no'> 4</span>     books.each{|b|
<span class='no'> 5</span>         entries.each{|a|
<span class='no'> 6</span>             <span class='r'>next</span> <span class='r'>unless</span> a[<span class='sy'>:@title</span>] == b[<span class='sy'>:@title</span>]
<span class='no'> 7</span>             xml!(<span class='sy'><span class='sy'>:</span><span class='dl'>"</span><span class='k'>book-with-prices</span><span class='dl'>"</span></span>) {
<span class='no'> 8</span>                 add! b.child(<span class='sy'>:title</span>)
<span class='no'> 9</span>                 xml!(<span class='sy'><span class='sy'>:</span><span class='dl'>"</span><span class='k'>price-bstore2</span><span class='dl'>"</span></span>, a[<span class='sy'>:@price</span>])
<span class='no'><strong>10</strong></span>                 xml!(<span class='sy'><span class='sy'>:</span><span class='dl'>"</span><span class='k'>price-bstore1</span><span class='dl'>"</span></span>, b[<span class='sy'>:@price</span>])
<span class='no'>11</span>             }
<span class='no'>12</span>         }
<span class='no'>13</span>     }
<span class='no'>14</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;books-with-prices&gt;
  {
    for $b in doc("http://bstore1.example.com/bib.xml")//book,
        $a in doc("http://bstore2.example.com/reviews.xml")//entry
    where $b/title = $a/title
    return
        &lt;book-with-prices&gt;
            { $b/title }
            &lt;price-bstore2&gt;{ $a/price/text() }&lt;/price-bstore2&gt;
            &lt;price-bstore1&gt;{ $b/price/text() }&lt;/price-bstore1&gt;
        &lt;/book-with-prices&gt;
  }
&lt;/books-with-prices&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;books-with-prices&gt;</span>
<span class='no'> 2</span>     <span class='ta'>&lt;book-with-prices&gt;</span>
<span class='no'> 3</span>         <span class='ta'>&lt;title&gt;</span>TCP/IP Illustrated<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 4</span>         <span class='ta'>&lt;price-bstore2&gt;</span>65.95<span class='ta'>&lt;/price-bstore2&gt;</span>
<span class='no'> 5</span>         <span class='ta'>&lt;price-bstore1&gt;</span>65.95<span class='ta'>&lt;/price-bstore1&gt;</span>
<span class='no'> 6</span>     <span class='ta'>&lt;/book-with-prices&gt;</span>
<span class='no'> 7</span>     <span class='ta'>&lt;book-with-prices&gt;</span>
<span class='no'> 8</span>         <span class='ta'>&lt;title&gt;</span>Advanced Programming in the Unix environment<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 9</span>         <span class='ta'>&lt;price-bstore2&gt;</span>65.95<span class='ta'>&lt;/price-bstore2&gt;</span>
<span class='no'><strong>10</strong></span>         <span class='ta'>&lt;price-bstore1&gt;</span>65.95<span class='ta'>&lt;/price-bstore1&gt;</span>
<span class='no'>11</span>     <span class='ta'>&lt;/book-with-prices&gt;</span>
<span class='no'>12</span>     <span class='ta'>&lt;book-with-prices&gt;</span>
<span class='no'>13</span>         <span class='ta'>&lt;title&gt;</span>Data on the Web<span class='ta'>&lt;/title&gt;</span>
<span class='no'>14</span>         <span class='ta'>&lt;price-bstore2&gt;</span>34.95<span class='ta'>&lt;/price-bstore2&gt;</span>
<span class='no'>15</span>         <span class='ta'>&lt;price-bstore1&gt;</span>39.95<span class='ta'>&lt;/price-bstore1&gt;</span>
<span class='no'>16</span>     <span class='ta'>&lt;/book-with-prices&gt;</span>
<span class='no'>17</span> <span class='ta'>&lt;/books-with-prices&gt;</span>
</pre></div>
</div></div><div><h3><a name='xmp-q6'>XMP - Q6</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>For each book that has at least one author, list the
     title and first two authors, and an empty "et-al"
     element if the book has additional authors.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='co'>XML</span>.bib! {
<span class='no'> 2</span>     <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>bib.xml</span><span class='dl'>'</span></span>).children(<span class='sy'>:book</span>) {|b|
<span class='no'> 3</span>         <span class='r'>next</span> <span class='r'>unless</span> b.children(<span class='sy'>:author</span>).size &gt; <span class='i'>0</span>
<span class='no'> 4</span>         book! {
<span class='no'> 5</span>             add! b.children(<span class='sy'>:title</span>)
<span class='no'> 6</span>             authors = b.children(<span class='sy'>:author</span>)
<span class='no'> 7</span>             add! authors[<span class='i'>0</span>,<span class='i'>2</span>]
<span class='no'> 8</span>             xml!(<span class='sy'><span class='sy'>:</span><span class='dl'>"</span><span class='k'>et-al</span><span class='dl'>"</span></span>) <span class='r'>if</span> authors.size &gt; <span class='i'>2</span>
<span class='no'> 9</span>         }
<span class='no'><strong>10</strong></span>     }
<span class='no'>11</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;bib&gt;
  {
    for $b in doc("http://bstore1.example.com/bib.xml")//book
    where count($b/author) &gt; 0
    return
        &lt;book&gt;
            { $b/title }
            {
                for $a in $b/author[position()&lt;=2]  
                return $a
            }
            {
                if (count($b/author) &gt; 2)
                 then &lt;et-al/&gt;
                 else ()
            }
        &lt;/book&gt;
  }
&lt;/bib&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;bib&gt;</span>
<span class='no'> 2</span>     <span class='ta'>&lt;book&gt;</span>
<span class='no'> 3</span>         <span class='ta'>&lt;title&gt;</span>TCP/IP Illustrated<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 4</span>         <span class='ta'>&lt;author&gt;</span>
<span class='no'> 5</span>             <span class='ta'>&lt;last&gt;</span>Stevens<span class='ta'>&lt;/last&gt;</span>
<span class='no'> 6</span>             <span class='ta'>&lt;first&gt;</span>W.<span class='ta'>&lt;/first&gt;</span>
<span class='no'> 7</span>         <span class='ta'>&lt;/author&gt;</span>
<span class='no'> 8</span>     <span class='ta'>&lt;/book&gt;</span>
<span class='no'> 9</span>     <span class='ta'>&lt;book&gt;</span>
<span class='no'><strong>10</strong></span>         <span class='ta'>&lt;title&gt;</span>Advanced Programming in the Unix environment<span class='ta'>&lt;/title&gt;</span>
<span class='no'>11</span>         <span class='ta'>&lt;author&gt;</span>
<span class='no'>12</span>             <span class='ta'>&lt;last&gt;</span>Stevens<span class='ta'>&lt;/last&gt;</span>
<span class='no'>13</span>             <span class='ta'>&lt;first&gt;</span>W.<span class='ta'>&lt;/first&gt;</span>
<span class='no'>14</span>         <span class='ta'>&lt;/author&gt;</span>
<span class='no'>15</span>     <span class='ta'>&lt;/book&gt;</span>
<span class='no'>16</span>     <span class='ta'>&lt;book&gt;</span>
<span class='no'>17</span>         <span class='ta'>&lt;title&gt;</span>Data on the Web<span class='ta'>&lt;/title&gt;</span>
<span class='no'>18</span>         <span class='ta'>&lt;author&gt;</span>
<span class='no'>19</span>             <span class='ta'>&lt;last&gt;</span>Abiteboul<span class='ta'>&lt;/last&gt;</span>
<span class='no'><strong>20</strong></span>             <span class='ta'>&lt;first&gt;</span>Serge<span class='ta'>&lt;/first&gt;</span>
<span class='no'>21</span>         <span class='ta'>&lt;/author&gt;</span>
<span class='no'>22</span>         <span class='ta'>&lt;author&gt;</span>
<span class='no'>23</span>             <span class='ta'>&lt;last&gt;</span>Buneman<span class='ta'>&lt;/last&gt;</span>
<span class='no'>24</span>             <span class='ta'>&lt;first&gt;</span>Peter<span class='ta'>&lt;/first&gt;</span>
<span class='no'>25</span>         <span class='ta'>&lt;/author&gt;</span>
<span class='no'>26</span>         <span class='ta'>&lt;et-al</span><span class='ta'>/&gt;</span>
<span class='no'>27</span>     <span class='ta'>&lt;/book&gt;</span>
<span class='no'>28</span> <span class='ta'>&lt;/bib&gt;</span>
</pre></div>
</div></div><div><h3><a name='xmp-q7'>XMP - Q7</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>List the titles and years of all books published
     by Addison-Wesley after 1991, in alphabetic order.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='co'>XML</span>.bib! {
<span class='no'>2</span>     <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>bib.xml</span><span class='dl'>'</span></span>).children(<span class='sy'>:book</span>).find_all{|b|
<span class='no'>3</span>         b[<span class='sy'>:@publisher</span>] == <span class='s'><span class='dl'>"</span><span class='k'>Addison-Wesley</span><span class='dl'>"</span></span> <span class='r'>and</span>
<span class='no'>4</span>         b[<span class='sy'>:year</span>].to_i &gt; <span class='i'>1991</span>
<span class='no'>5</span>     }.sort_by{|b| b[<span class='sy'>:@title</span>] }.each {|b|
<span class='no'>6</span>         book!({<span class='sy'>:year</span> =&gt; b[<span class='sy'>:year</span>]}, b.child(<span class='sy'>:title</span>))
<span class='no'>7</span>     }
<span class='no'>8</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;bib&gt;
  {
    for $b in doc("http://bstore1.example.com/bib.xml")//book
    where $b/publisher = "Addison-Wesley" and $b/@year &gt; 1991
    order by $b/title
    return
        &lt;book&gt;
            { $b/@year }
            { $b/title }
        &lt;/book&gt;
  }
&lt;/bib&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='ta'>&lt;bib&gt;</span>
<span class='no'>2</span>     <span class='ta'>&lt;book</span> <span class='an'>year</span>=<span class='s'><span class='dl'>"</span><span class='k'>1992</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'>3</span>         <span class='ta'>&lt;title&gt;</span>Advanced Programming in the Unix environment<span class='ta'>&lt;/title&gt;</span>
<span class='no'>4</span>     <span class='ta'>&lt;/book&gt;</span>
<span class='no'>5</span>     <span class='ta'>&lt;book</span> <span class='an'>year</span>=<span class='s'><span class='dl'>"</span><span class='k'>1994</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'>6</span>         <span class='ta'>&lt;title&gt;</span>TCP/IP Illustrated<span class='ta'>&lt;/title&gt;</span>
<span class='no'>7</span>     <span class='ta'>&lt;/book&gt;</span>
<span class='no'>8</span> <span class='ta'>&lt;/bib&gt;</span>
</pre></div>
</div></div><div><h3><a name='xmp-q8'>XMP - Q8</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>Find books in which the name of some element ends
     with the string "or" and the same element contains
     the string "Suciu" somewhere in its content.
     For each such book, return the title and the qualifying element.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>bib.xml</span><span class='dl'>'</span></span>).children(<span class='sy'>:book</span>) {|b|
<span class='no'>2</span>     b.descendants {|e|
<span class='no'>3</span>         <span class='r'>if</span> e.is_a? <span class='co'>XML</span> <span class='r'>and</span> e =~ <span class='rx'><span class='dl'>/</span><span class='k'>Suciu</span><span class='dl'>/</span></span> <span class='r'>and</span> e.name.to_s =~ <span class='rx'><span class='dl'>/</span><span class='k'>or$</span><span class='dl'>/</span></span>
<span class='no'>4</span>             <span class='co'>XML</span>.book!(b.child(<span class='sy'>:title</span>), e)
<span class='no'>5</span>         <span class='r'>end</span>
<span class='no'>6</span>     }
<span class='no'>7</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>for $b in doc("http://bstore1.example.com/bib.xml")//book
let $e := $b/*[contains(string(.), "Suciu") 
               and ends-with(local-name(.), "or")]
where exists($e)
return
    &lt;book&gt;
        { $b/title }
        { $e }
    &lt;/book&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='ta'>&lt;book&gt;</span>
<span class='no'>2</span>         <span class='ta'>&lt;title&gt;</span>Data on the Web<span class='ta'>&lt;/title&gt;</span>
<span class='no'>3</span>         <span class='ta'>&lt;author&gt;</span>
<span class='no'>4</span>             <span class='ta'>&lt;last&gt;</span>Suciu<span class='ta'>&lt;/last&gt;</span>
<span class='no'>5</span>             <span class='ta'>&lt;first&gt;</span>Dan<span class='ta'>&lt;/first&gt;</span>
<span class='no'>6</span>         <span class='ta'>&lt;/author&gt;</span>
<span class='no'>7</span>  <span class='ta'>&lt;/book&gt;</span>
</pre></div>
</div></div><div><h3><a name='xmp-q9'>XMP - Q9</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>In the document "books.xml", find all section or chapter
     titles that contain the word "XML", regardless of the
     level of nesting.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='co'>XML</span>.results! {
<span class='no'>2</span>     <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>books.xml</span><span class='dl'>'</span></span>).descendants {|d|
<span class='no'>3</span>         <span class='r'>if</span> d.is_a? <span class='co'>XML</span> <span class='r'>and</span> (d.name == <span class='sy'>:chapter</span> <span class='r'>or</span> d.name == <span class='sy'>:section</span>)
<span class='no'>4</span>             t = d.child(<span class='sy'>:title</span>)
<span class='no'>5</span>             add! t  <span class='r'>if</span> t =~ <span class='rx'><span class='dl'>/</span><span class='k'>XML</span><span class='dl'>/</span></span>
<span class='no'>6</span>         <span class='r'>end</span>
<span class='no'>7</span>     }
<span class='no'>8</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;results&gt;
  {
    for $t in doc("books.xml")//(chapter | section)/title
    where contains($t/text(), "XML")
    return $t
  }
&lt;/results&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='ta'>&lt;results&gt;</span>
<span class='no'>2</span>     <span class='ta'>&lt;title&gt;</span>XML<span class='ta'>&lt;/title&gt;</span>
<span class='no'>3</span>     <span class='ta'>&lt;title&gt;</span>XML and Semistructured Data<span class='ta'>&lt;/title&gt;</span>
<span class='no'>4</span> <span class='ta'>&lt;/results&gt;</span>
</pre></div>
</div></div><div><h3><a name='xmp-q10'>XMP - Q10</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>In the document "prices.xml", find the minimum price
      for each book, in the form of a "minprice" element
      with the book title as its title attribute.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='co'>XML</span>.results! {
<span class='no'> 2</span>     doc = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>prices.xml</span><span class='dl'>'</span></span>)
<span class='no'> 3</span>     doc.children(<span class='sy'>:book</span>).children(<span class='sy'>:title</span>).map{|node| node.text}.uniq.each{|title|
<span class='no'> 4</span>         minprice!({<span class='sy'>:title</span> =&gt; title}) {
<span class='no'> 5</span>             price! {
<span class='no'> 6</span>                 text! doc.children(<span class='sy'>:book</span>).find_all{|book|
<span class='no'> 7</span>                           book[<span class='sy'>:@title</span>] == title
<span class='no'> 8</span>                       }.map{|book|
<span class='no'> 9</span>                           book[<span class='sy'>:@price</span>].to_f 
<span class='no'><strong>10</strong></span>                       }.min
<span class='no'>11</span>             }
<span class='no'>12</span>         }
<span class='no'>13</span>     }
<span class='no'>14</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;results&gt;
  {
    let $doc := doc("prices.xml")
    for $t in distinct-values($doc//book/title)
    let $p := $doc//book[title = $t]/price
    return
      &lt;minprice title="{ $t }"&gt;
        &lt;price&gt;{ min($p) }&lt;/price&gt;
      &lt;/minprice&gt;
  }
&lt;/results&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;results&gt;</span>
<span class='no'> 2</span>     <span class='ta'>&lt;minprice</span> <span class='an'>title</span>=<span class='s'><span class='dl'>"</span><span class='k'>Advanced Programming in the Unix environment</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'> 3</span>         <span class='ta'>&lt;price&gt;</span>65.95<span class='ta'>&lt;/price&gt;</span>
<span class='no'> 4</span>     <span class='ta'>&lt;/minprice&gt;</span>
<span class='no'> 5</span>     <span class='ta'>&lt;minprice</span> <span class='an'>title</span>=<span class='s'><span class='dl'>"</span><span class='k'>TCP/IP Illustrated</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'> 6</span>         <span class='ta'>&lt;price&gt;</span>65.95<span class='ta'>&lt;/price&gt;</span>
<span class='no'> 7</span>     <span class='ta'>&lt;/minprice&gt;</span>
<span class='no'> 8</span>     <span class='ta'>&lt;minprice</span> <span class='an'>title</span>=<span class='s'><span class='dl'>"</span><span class='k'>Data on the Web</span><span class='dl'>"</span></span><span class='ta'>&gt;</span>
<span class='no'> 9</span>         <span class='ta'>&lt;price&gt;</span>34.95<span class='ta'>&lt;/price&gt;</span>
<span class='no'><strong>10</strong></span>     <span class='ta'>&lt;/minprice&gt;</span>
<span class='no'>11</span> <span class='ta'>&lt;/results&gt;</span>
</pre></div>
</div></div><div><h3><a name='xmp-q11'>XMP - Q11</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>For each book with an author, return the book with
      its title and authors. For each book with an editor,
      return a reference with the book title and the editor's affiliation.
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='co'>XML</span>.bib! {
<span class='no'> 2</span>     doc = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>bib.xml</span><span class='dl'>'</span></span>)
<span class='no'> 3</span> 
<span class='no'> 4</span>     doc.children(<span class='sy'>:book</span>) {|b|
<span class='no'> 5</span>         <span class='r'>if</span> b.children(<span class='sy'>:author</span>).size != <span class='i'>0</span>
<span class='no'> 6</span>             book!(b.children(<span class='sy'>:title</span>), b.children(<span class='sy'>:author</span>))
<span class='no'> 7</span>         <span class='r'>end</span>
<span class='no'> 8</span>     }
<span class='no'> 9</span> 
<span class='no'><strong>10</strong></span>     doc.children(<span class='sy'>:book</span>) {|b|
<span class='no'>11</span>         <span class='r'>if</span> b.children(<span class='sy'>:editor</span>).size != <span class='i'>0</span>
<span class='no'>12</span>             reference!(b.children(<span class='sy'>:title</span>), b.children(<span class='sy'>:editor</span>).children(<span class='sy'>:affiliation</span>))
<span class='no'>13</span>         <span class='r'>end</span>
<span class='no'>14</span>     }
<span class='no'>15</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;bib&gt;
{
        for $b in doc("http://bstore1.example.com/bib.xml")//book[author]
        return
            &lt;book&gt;
                { $b/title }
                { $b/author }
            &lt;/book&gt;
}
{
        for $b in doc("http://bstore1.example.com/bib.xml")//book[editor]
        return
          &lt;reference&gt;
            { $b/title }
            {$b/editor/affiliation}
          &lt;/reference&gt;
}
&lt;/bib&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='ta'>&lt;bib&gt;</span>
<span class='no'> 2</span>     <span class='ta'>&lt;book&gt;</span>
<span class='no'> 3</span>         <span class='ta'>&lt;title&gt;</span>TCP/IP Illustrated<span class='ta'>&lt;/title&gt;</span>
<span class='no'> 4</span>         <span class='ta'>&lt;author&gt;</span>
<span class='no'> 5</span>             <span class='ta'>&lt;last&gt;</span>Stevens<span class='ta'>&lt;/last&gt;</span>
<span class='no'> 6</span>             <span class='ta'>&lt;first&gt;</span>W.<span class='ta'>&lt;/first&gt;</span>
<span class='no'> 7</span>         <span class='ta'>&lt;/author&gt;</span>
<span class='no'> 8</span>     <span class='ta'>&lt;/book&gt;</span>
<span class='no'> 9</span>     <span class='ta'>&lt;book&gt;</span>
<span class='no'><strong>10</strong></span>         <span class='ta'>&lt;title&gt;</span>Advanced Programming in the Unix environment<span class='ta'>&lt;/title&gt;</span>
<span class='no'>11</span>         <span class='ta'>&lt;author&gt;</span>
<span class='no'>12</span>             <span class='ta'>&lt;last&gt;</span>Stevens<span class='ta'>&lt;/last&gt;</span>
<span class='no'>13</span>             <span class='ta'>&lt;first&gt;</span>W.<span class='ta'>&lt;/first&gt;</span>
<span class='no'>14</span>         <span class='ta'>&lt;/author&gt;</span>
<span class='no'>15</span>     <span class='ta'>&lt;/book&gt;</span>
<span class='no'>16</span>     <span class='ta'>&lt;book&gt;</span>
<span class='no'>17</span>         <span class='ta'>&lt;title&gt;</span>Data on the Web<span class='ta'>&lt;/title&gt;</span>
<span class='no'>18</span>         <span class='ta'>&lt;author&gt;</span>
<span class='no'>19</span>             <span class='ta'>&lt;last&gt;</span>Abiteboul<span class='ta'>&lt;/last&gt;</span>
<span class='no'><strong>20</strong></span>             <span class='ta'>&lt;first&gt;</span>Serge<span class='ta'>&lt;/first&gt;</span>
<span class='no'>21</span>         <span class='ta'>&lt;/author&gt;</span>
<span class='no'>22</span>         <span class='ta'>&lt;author&gt;</span>
<span class='no'>23</span>             <span class='ta'>&lt;last&gt;</span>Buneman<span class='ta'>&lt;/last&gt;</span>
<span class='no'>24</span>             <span class='ta'>&lt;first&gt;</span>Peter<span class='ta'>&lt;/first&gt;</span>
<span class='no'>25</span>         <span class='ta'>&lt;/author&gt;</span>
<span class='no'>26</span>         <span class='ta'>&lt;author&gt;</span>
<span class='no'>27</span>             <span class='ta'>&lt;last&gt;</span>Suciu<span class='ta'>&lt;/last&gt;</span>
<span class='no'>28</span>             <span class='ta'>&lt;first&gt;</span>Dan<span class='ta'>&lt;/first&gt;</span>
<span class='no'>29</span>         <span class='ta'>&lt;/author&gt;</span>
<span class='no'><strong>30</strong></span>     <span class='ta'>&lt;/book&gt;</span>
<span class='no'>31</span>     <span class='ta'>&lt;reference&gt;</span>
<span class='no'>32</span>         <span class='ta'>&lt;title&gt;</span>The Economics of Technology and Content for Digital TV<span class='ta'>&lt;/title&gt;</span>
<span class='no'>33</span>         <span class='ta'>&lt;affiliation&gt;</span>CITI<span class='ta'>&lt;/affiliation&gt;</span>
<span class='no'>34</span>     <span class='ta'>&lt;/reference&gt;</span>
<span class='no'>35</span> <span class='ta'>&lt;/bib&gt;</span>
</pre></div>
</div></div><div><h3><a name='xmp-q12'>XMP - Q12</a></h3><a href='#toc' style='font-family: small'>[Table of contents]</a><a href='index.html' style='font-family: small'>[Back to home page]</a><p>Find pairs of books that have different titles but
      the same set of authors (possibly in a different order).
</p><h4>magic/xml solution</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'> 1</span> <span class='co'>XML</span>.bib! {
<span class='no'> 2</span>     books = <span class='co'>XML</span>.load(<span class='s'><span class='dl'>'</span><span class='k'>bib.xml</span><span class='dl'>'</span></span>).children(<span class='sy'>:book</span>)
<span class='no'> 3</span>     books.each_with_index{|book1, i|
<span class='no'> 4</span>         aut1 = book1.children(<span class='sy'>:author</span>).map{|a| [a[<span class='sy'>:@last</span>], a[<span class='sy'>:@first</span>]]}.sort
<span class='no'> 5</span> 
<span class='no'> 6</span>         books.each_with_index{|book2, j|
<span class='no'> 7</span>             <span class='r'>next</span> <span class='r'>unless</span> i &lt; j <span class='r'>and</span> book1[<span class='sy'>:@title</span>] != book2[<span class='sy'>:@title</span>]
<span class='no'> 8</span>             aut2 = book2.children(<span class='sy'>:author</span>).map{|a| [a[<span class='sy'>:@last</span>], a[<span class='sy'>:@first</span>]]}.sort
<span class='no'> 9</span> 
<span class='no'><strong>10</strong></span>             xml!(<span class='sy'><span class='sy'>:</span><span class='dl'>"</span><span class='k'>book-pair</span><span class='dl'>"</span></span>, book1.child(<span class='sy'>:title</span>), book2.child(<span class='sy'>:title</span>)) <span class='r'>if</span> aut1 == aut2
<span class='no'>11</span>         }
<span class='no'>12</span>     }
<span class='no'>13</span> }
</pre></div>
</div><h4>XQuery solution</h4><pre class='xquery_solution'>&lt;bib&gt;
{
    for $book1 in doc("http://bstore1.example.com/bib.xml")//book,
        $book2 in doc("http://bstore1.example.com/bib.xml")//book
    let $aut1 := for $a in $book1/author 
                 order by $a/last, $a/first
                 return $a
    let $aut2 := for $a in $book2/author 
                 order by $a/last, $a/first
                 return $a
    where $book1 &lt;&lt; $book2
    and not($book1/title = $book2/title)
    and deep-equal($aut1, $aut2) 
    return
        &lt;book-pair&gt;
            { $book1/title }
            { $book2/title }
        &lt;/book-pair&gt;
}
&lt;/bib&gt;
</pre><h4>Expected output</h4><div class='CodeRay'>
  <div class='code'><pre><span class='no'>1</span> <span class='ta'>&lt;bib&gt;</span>
<span class='no'>2</span>     <span class='ta'>&lt;book-pair&gt;</span>
<span class='no'>3</span>         <span class='ta'>&lt;title&gt;</span>TCP/IP Illustrated<span class='ta'>&lt;/title&gt;</span>
<span class='no'>4</span>         <span class='ta'>&lt;title&gt;</span>Advanced Programming in the Unix environment<span class='ta'>&lt;/title&gt;</span>
<span class='no'>5</span>     <span class='ta'>&lt;/book-pair&gt;</span>
<span class='no'>6</span> <span class='ta'>&lt;/bib&gt;</span>
</pre></div>
</div></div></body></html>
